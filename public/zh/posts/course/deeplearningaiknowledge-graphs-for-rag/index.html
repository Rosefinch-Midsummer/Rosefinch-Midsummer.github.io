<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DeeplearningAI„ÄäKnowledge-Graphs-for-RAG„Äã | Â§©Êº¢Â∏ùÂúãÂæ©ËààÈåÑ</title>
<meta name="keywords" content="AI, LLM, RAG">
<meta name="description" content="Knowledge Graphs for RAG
Preface
This article is a study note for the course https://www.deeplearning.ai/short-courses/knowledge-graphs-rag/.

What you‚Äôll learn in this course
Knowledge graphs are used in development to structure complex data relationships, drive intelligent search functionality, and build powerful AI applications that can reason over different data types. Knowledge graphs can connect data from both structured and unstructured sources (databases, documents, etc.), providing an intuitive and flexible way to model complex, real-world scenarios.">
<meta name="author" content="RM">
<link rel="canonical" href="https://rosefinch-midsummer.github.io/zh/posts/course/deeplearningaiknowledge-graphs-for-rag/">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
<link crossorigin="anonymous" href="/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css" integrity="sha256-IhHKMWS&#43;eDACT2qtKzouUghDpk&#43;PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://rosefinch-midsummer.github.io/img/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://rosefinch-midsummer.github.io/img/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://rosefinch-midsummer.github.io/img/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://rosefinch-midsummer.github.io/img/apple-touch-icon.png">
<link rel="mask-icon" href="https://rosefinch-midsummer.github.io/img/android-chrome-192x192.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://rosefinch-midsummer.github.io/zh/posts/course/deeplearningaiknowledge-graphs-for-rag/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous"> 
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js" integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous"></script>
<script> 
	document.addEventListener("DOMContentLoaded", function() { 
		renderMathInElement(document.body, { 
			
			
			delimiters: [ 
				{left: '$$', right: '$$', display: true}, 
				{left: '$', right: '$', display: false}, 
				{left: '\\(', right: '\\)', display: false}, 
				{left: '\\[', right: '\\]', display: true} 
			], 
			
			throwOnError : false 
		}); 
	}); 
</script>







<meta property="og:url" content="https://rosefinch-midsummer.github.io/zh/posts/course/deeplearningaiknowledge-graphs-for-rag/">
  <meta property="og:site_name" content="Â§©Êº¢Â∏ùÂúãÂæ©ËààÈåÑ">
  <meta property="og:title" content="DeeplearningAI„ÄäKnowledge-Graphs-for-RAG„Äã">
  <meta property="og:description" content="Knowledge Graphs for RAG Preface This article is a study note for the course https://www.deeplearning.ai/short-courses/knowledge-graphs-rag/.
What you‚Äôll learn in this course Knowledge graphs are used in development to structure complex data relationships, drive intelligent search functionality, and build powerful AI applications that can reason over different data types. Knowledge graphs can connect data from both structured and unstructured sources (databases, documents, etc.), providing an intuitive and flexible way to model complex, real-world scenarios.">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-15T18:34:25+08:00">
    <meta property="article:modified_time" content="2025-05-15T22:54:22+08:00">
    <meta property="article:tag" content="AI">
    <meta property="article:tag" content="LLM">
    <meta property="article:tag" content="RAG">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DeeplearningAI„ÄäKnowledge-Graphs-for-RAG„Äã">
<meta name="twitter:description" content="Knowledge Graphs for RAG
Preface
This article is a study note for the course https://www.deeplearning.ai/short-courses/knowledge-graphs-rag/.

What you‚Äôll learn in this course
Knowledge graphs are used in development to structure complex data relationships, drive intelligent search functionality, and build powerful AI applications that can reason over different data types. Knowledge graphs can connect data from both structured and unstructured sources (databases, documents, etc.), providing an intuitive and flexible way to model complex, real-world scenarios.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "üìöÊñáÁ´†",
      "item": "https://rosefinch-midsummer.github.io/zh/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "üè´Ë™≤Á®ã",
      "item": "https://rosefinch-midsummer.github.io/zh/posts/course/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "DeeplearningAI„ÄäKnowledge-Graphs-for-RAG„Äã",
      "item": "https://rosefinch-midsummer.github.io/zh/posts/course/deeplearningaiknowledge-graphs-for-rag/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DeeplearningAI„ÄäKnowledge-Graphs-for-RAG„Äã",
  "name": "DeeplearningAI„ÄäKnowledge-Graphs-for-RAG„Äã",
  "description": "Knowledge Graphs for RAG Preface This article is a study note for the course https://www.deeplearning.ai/short-courses/knowledge-graphs-rag/.\nWhat you‚Äôll learn in this course Knowledge graphs are used in development to structure complex data relationships, drive intelligent search functionality, and build powerful AI applications that can reason over different data types. Knowledge graphs can connect data from both structured and unstructured sources (databases, documents, etc.), providing an intuitive and flexible way to model complex, real-world scenarios.\n",
  "keywords": [
    "AI", "LLM", "RAG"
  ],
  "articleBody": "Knowledge Graphs for RAG Preface This article is a study note for the course https://www.deeplearning.ai/short-courses/knowledge-graphs-rag/.\nWhat you‚Äôll learn in this course Knowledge graphs are used in development to structure complex data relationships, drive intelligent search functionality, and build powerful AI applications that can reason over different data types. Knowledge graphs can connect data from both structured and unstructured sources (databases, documents, etc.), providing an intuitive and flexible way to model complex, real-world scenarios.\nUnlike tables or simple lists, knowledge graphs can capture the meaning and context behind the data, allowing you to uncover insights and connections that would be difficult to find with conventional databases. This rich, structured context is ideal for improving the output of large language models (LLMs), because you can build more relevant context for the model than with semantic search alone.\nThis course will teach you how to leverage knowledge graphs within retrieval augmented generation (RAG) applications. You‚Äôll learn to:\nUnderstand the basics of how knowledge graphs store data by using nodes to represent entities and edges to represent relationships between nodes. Use Neo4j‚Äôs query language, Cypher, to retrieve information from a fun graph of movie and actor data. Add a vector index to a knowledge graph to represent unstructured text data and find relevant texts using vector similarity search. Build a knowledge graph of text documents from scratch, using publicly available financial and investment documents as the demo use case. Explore advanced techniques for connecting multiple knowledge graphs and using complex queries for comprehensive data retrieval. Write advanced Cypher queries to retrieve relevant information from the graph and format it for inclusion in your prompt to an LLM. After course completion, you‚Äôll be well-equipped to use knowledge graphs to uncover deeper insights in your data, and enhance the performance of LLMs with structured, relevant context.\nLesson 1: Knowledge Graphs Fundamentals What is a Knowledge GraphÔºü\nRelationships\nNodes\nLesson 2: Querying Knowledge Graphs with Cypher Prerequisites You must have Neo4j running and have added the movie data from the example.\nThe content of the .env file is as follows:\n1 2 3 4 5 6 NEO4J_URI=bolt://localhost:7687 NEO4J_USERNAME=neo4j NEO4J_PASSWORD=Your_Password_Here NEO4J_DATABASE=neo4j OPENAI_API_KEY=Your_OpenAI_API_KEY OPENAI_BASE_URL=OPENAI_BASE_URL Import packages and set up Neo4J 1 2 3 4 5 6 7 8 9 10 11 12 13 from dotenv import load_dotenv import os from langchain_community.graphs import Neo4jGraph # Warning control import warnings warnings.filterwarnings(\"ignore\") load_dotenv('.env', override=True) NEO4J_URI = os.getenv('NEO4J_URI') NEO4J_USERNAME = os.getenv('NEO4J_USERNAME') NEO4J_PASSWORD = os.getenv('NEO4J_PASSWORD') NEO4J_DATABASE = os.getenv('NEO4J_DATABASE') Initialize a knowledge graph instance using LangChain‚Äôs Neo4j integration. Use the code below:\n1 2 3 kg = Neo4jGraph( url=NEO4J_URI, username=NEO4J_USERNAME, password=NEO4J_PASSWORD, database=NEO4J_DATABASE ) Querying the movie knowledge graph Match all nodes in the graph 1 2 3 4 5 6 cypher = \"\"\" MATCH (n) RETURN count(n) \"\"\" result = kg.query(cypher) print(result) Output:\n1 [{'count(n)': 171} 1 2 3 4 5 6 cypher = \"\"\" MATCH (n) RETURN count(n) AS numberOfNodes \"\"\" result = kg.query(cypher) print(result) Output:\n1 [{'numberOfNodes': 175}] 1 print(f\"There are {result[0]['numberOfNodes']} nodes in this graph.\") Output\n1 There are 175 nodes in this graph. Match only the Movie nodes by specifying the node label 1 2 3 4 5 6 cypher = \"\"\" MATCH (n:Movie) RETURN count(n) AS numberOfMovies \"\"\" result = kg.query(cypher) print(result) Output:\n1 [{'numberOfMovies': 38}] Change the variable name in the node pattern match for improved readability 1 2 3 4 5 6 cypher = \"\"\" MATCH (m:Movie) RETURN count(m) AS numberOfMovies \"\"\" result = kg.query(cypher) print(result) Output:\n1 [{'numberOfMovies': 38}] Match only the Person nodes 1 2 3 4 5 6 cypher = \"\"\" MATCH (people:Person) RETURN count(people) AS numberOfPeople \"\"\" result = kg.query(cypher) print(result) Output\n1 [{'numberOfPeople': 137}] Match a single person by specifying the value of the name property on the Person node 1 2 3 4 5 6 cypher = \"\"\" MATCH (tom:Person {name:\"Tom Hanks\"}) RETURN tom \"\"\" result = kg.query(cypher) print(result) Output\n1 [{'tom': {'born': 1956, 'name': 'Tom Hanks'}}] Match a single Movie by specifying the value of the title property 1 2 3 4 5 6 cypher = \"\"\" MATCH (cloudAtlas:Movie {title:\"Cloud Atlas\"}) RETURN cloudAtlas \"\"\" result = kg.query(cypher) print(result) Output\n1 [{'cloudAtlas': {'tagline': 'Everything is connected', 'title': 'Cloud Atlas', 'released': 2012}}] Return only the released property of the matched Movie node 1 2 3 4 5 6 cypher = \"\"\" MATCH (cloudAtlas:Movie {title:\"Cloud Atlas\"}) RETURN cloudAtlas.released \"\"\" result = kg.query(cypher) print(result) Output\n1 [{'cloudAtlas.released': 2012}] Return two properties 1 2 3 4 5 6 cypher = \"\"\" MATCH (cloudAtlas:Movie {title:\"Cloud Atlas\"}) RETURN cloudAtlas.released, cloudAtlas.tagline \"\"\" result = kg.query(cypher) print(result) Output\n1 2 [{'cloudAtlas.released': 2012, 'cloudAtlas.tagline': 'Everything is connected'}] Cypher patterns with conditional matching 1 2 3 4 5 6 7 8 cypher = \"\"\" MATCH (nineties:Movie) WHERE nineties.released \u003e= 1990 AND nineties.released \u003c 2000 RETURN nineties.title \"\"\" result = kg.query(cypher) print(result) Output\n1 [{'nineties.title': 'The Matrix'}, {'nineties.title': \"The Devil's Advocate\"}, {'nineties.title': 'A Few Good Men'}, {'nineties.title': 'As Good as It Gets'}, {'nineties.title': 'What Dreams May Come'}, {'nineties.title': 'Snow Falling on Cedars'}, {'nineties.title': \"You've Got Mail\"}, {'nineties.title': 'Sleepless in Seattle'}, {'nineties.title': 'Joe Versus the Volcano'}, {'nineties.title': 'When Harry Met Sally'}, {'nineties.title': 'That Thing You Do'}, {'nineties.title': 'The Birdcage'}, {'nineties.title': 'Unforgiven'}, {'nineties.title': 'Johnny Mnemonic'}, {'nineties.title': 'The Green Mile'}, {'nineties.title': 'Hoffa'}, {'nineties.title': 'Apollo 13'}, {'nineties.title': 'Twister'}, {'nineties.title': 'Bicentennial Man'}, {'nineties.title': 'A League of Their Own'}] Pattern matching with multiple nodes 1 2 3 4 5 6 cypher = \"\"\" MATCH (actor:Person)-[:ACTED_IN]-\u003e(movie:Movie) RETURN actor.name, movie.title LIMIT 10 \"\"\" result = kg.query(cypher) print(result) Output\n1 2 3 4 5 6 7 8 9 10 [{'actor.name': 'Emil Eifrem', 'movie.title': 'The Matrix'}, {'actor.name': 'Hugo Weaving', 'movie.title': 'The Matrix'}, {'actor.name': 'Laurence Fishburne', 'movie.title': 'The Matrix'}, {'actor.name': 'Carrie-Anne Moss', 'movie.title': 'The Matrix'}, {'actor.name': 'Keanu Reeves', 'movie.title': 'The Matrix'}, {'actor.name': 'Hugo Weaving', 'movie.title': 'The Matrix Reloaded'}, {'actor.name': 'Laurence Fishburne', 'movie.title': 'The Matrix Reloaded'}, {'actor.name': 'Carrie-Anne Moss', 'movie.title': 'The Matrix Reloaded'}, {'actor.name': 'Keanu Reeves', 'movie.title': 'The Matrix Reloaded'}, {'actor.name': 'Hugo Weaving', 'movie.title': 'The Matrix Revolutions'}] 1 2 3 4 5 6 cypher = \"\"\" MATCH (tom:Person {name: \"Tom Hanks\"})-[:ACTED_IN]-\u003e(tomHanksMovies:Movie) RETURN tom.name,tomHanksMovies.title \"\"\" result = kg.query(cypher) print(result) Output\n1 2 3 4 5 6 7 8 9 10 11 12 [{'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'Apollo 13'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': \"You've Got Mail\"}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'A League of Their Own'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'Joe Versus the Volcano'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'That Thing You Do'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'The Da Vinci Code'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'Cloud Atlas'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'Cast Away'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'The Green Mile'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'Sleepless in Seattle'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': 'The Polar Express'}, {'tom.name': 'Tom Hanks', 'tomHanksMovies.title': \"Charlie Wilson's War\"}] 1 2 3 4 5 6 cypher = \"\"\" MATCH (tom:Person {name:\"Tom Hanks\"})-[:ACTED_IN]-\u003e(m)\u003c-[:ACTED_IN]-(coActors) RETURN coActors.name, m.title \"\"\" result = kg.query(cypher) print(result) Output\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 [{'coActors.name': 'Ed Harris', 'm.title': 'Apollo 13'}, {'coActors.name': 'Gary Sinise', 'm.title': 'Apollo 13'}, {'coActors.name': 'Kevin Bacon', 'm.title': 'Apollo 13'}, {'coActors.name': 'Bill Paxton', 'm.title': 'Apollo 13'}, {'coActors.name': 'Parker Posey', 'm.title': \"You've Got Mail\"}, {'coActors.name': 'Greg Kinnear', 'm.title': \"You've Got Mail\"}, {'coActors.name': 'Meg Ryan', 'm.title': \"You've Got Mail\"}, {'coActors.name': 'Steve Zahn', 'm.title': \"You've Got Mail\"}, {'coActors.name': 'Dave Chappelle', 'm.title': \"You've Got Mail\"}, {'coActors.name': 'Madonna', 'm.title': 'A League of Their Own'}, {'coActors.name': \"Rosie O'Donnell\", 'm.title': 'A League of Their Own'}, {'coActors.name': 'Geena Davis', 'm.title': 'A League of Their Own'}, {'coActors.name': 'Bill Paxton', 'm.title': 'A League of Their Own'}, {'coActors.name': 'Lori Petty', 'm.title': 'A League of Their Own'}, {'coActors.name': 'Nathan Lane', 'm.title': 'Joe Versus the Volcano'}, {'coActors.name': 'Meg Ryan', 'm.title': 'Joe Versus the Volcano'}, {'coActors.name': 'Liv Tyler', 'm.title': 'That Thing You Do'}, {'coActors.name': 'Charlize Theron', 'm.title': 'That Thing You Do'}, {'coActors.name': 'Ian McKellen', 'm.title': 'The Da Vinci Code'}, {'coActors.name': 'Audrey Tautou', 'm.title': 'The Da Vinci Code'}, {'coActors.name': 'Paul Bettany', 'm.title': 'The Da Vinci Code'}, {'coActors.name': 'Jim Broadbent', 'm.title': 'Cloud Atlas'}, {'coActors.name': 'Halle Berry', 'm.title': 'Cloud Atlas'}, {'coActors.name': 'Hugo Weaving', 'm.title': 'Cloud Atlas'}, {'coActors.name': 'Helen Hunt', 'm.title': 'Cast Away'}, {'coActors.name': 'Sam Rockwell', 'm.title': 'The Green Mile'}, {'coActors.name': 'Bonnie Hunt', 'm.title': 'The Green Mile'}, {'coActors.name': 'Patricia Clarkson', 'm.title': 'The Green Mile'}, {'coActors.name': 'James Cromwell', 'm.title': 'The Green Mile'}, {'coActors.name': 'Michael Clarke Duncan', 'm.title': 'The Green Mile'}, {'coActors.name': 'David Morse', 'm.title': 'The Green Mile'}, {'coActors.name': 'Gary Sinise', 'm.title': 'The Green Mile'}, {'coActors.name': 'Meg Ryan', 'm.title': 'Sleepless in Seattle'}, {'coActors.name': 'Victor Garber', 'm.title': 'Sleepless in Seattle'}, {'coActors.name': 'Bill Pullman', 'm.title': 'Sleepless in Seattle'}, {'coActors.name': 'Rita Wilson', 'm.title': 'Sleepless in Seattle'}, {'coActors.name': \"Rosie O'Donnell\", 'm.title': 'Sleepless in Seattle'}, {'coActors.name': 'Julia Roberts', 'm.title': \"Charlie Wilson's War\"}, {'coActors.name': 'Philip Seymour Hoffman', 'm.title': \"Charlie Wilson's War\"}] Delete data from the graph 1 2 3 4 5 6 cypher = \"\"\" MATCH (emil:Person {name:\"Emil Eifrem\"})-[actedIn:ACTED_IN]-\u003e(movie:Movie) RETURN emil.name, movie.title \"\"\" result = kg.query(cypher) print(result) Output\n1 [{'emil.name': 'Emil Eifrem', 'movie.title': 'The Matrix'}] 1 2 3 4 5 6 cypher = \"\"\" MATCH (emil:Person {name:\"Emil Eifrem\"})-[actedIn:ACTED_IN]-\u003e(movie:Movie) DELETE actedIn \"\"\" result = kg.query(cypher) print(result) Output\n1 [] Adding data to the graph 1 2 3 4 5 6 cypher = \"\"\" CREATE (andreas:Person {name:\"Andreas\"}) RETURN andreas \"\"\" result = kg.query(cypher) print(result) Output\n1 [{'andreas': {'name': 'Andreas'}}] 1 2 3 4 5 6 7 cypher = \"\"\" MATCH (andreas:Person {name:\"Andreas\"}), (emil:Person {name:\"Emil Eifrem\"}) MERGE (andreas)-[hasRelationship:WORKS_WITH]-\u003e(emil) RETURN andreas, hasRelationship, emil \"\"\" result = kg.query(cypher) print(result) Output\n1 2 3 4 5 [{'andreas': {'name': 'Andreas'}, 'hasRelationship': ({'name': 'Andreas'}, 'WORKS_WITH', {'born': 1978, 'name': 'Emil Eifrem'}), 'emil': {'born': 1978, 'name': 'Emil Eifrem'}}] Lesson 3: Preparing Text Data for RAG Prerequisites: GenAI integrations Introduced in 5.17.\nNeo4j‚Äôs Vector indexes and Vector functions allow you to calculate the similarity between node and relationship properties in a graph. A prerequisite for using these features is that vector embeddings have been set as properties of these entities. The GenAI plugin enables the creation of such embeddings using GenAI providers.\nTo use the GenAI plugin you need an account and API credentials from any of the following GenAI providers: Vertex AI, OpenAI, Azure OpenAI, and Amazon Bedrock.\nTo learn more about using embeddings in Neo4j, see Vector indexes ‚Üí Vectors and embeddings in Neo4j.\nFor a hands-on guide on how to use the GenAI plugin, see GenAI documentation - Embeddings \u0026 Vector Indexes Tutorial ‚Üí Create embeddings with cloud AI providers.\nThe GenAI plugin is enabled by default in Neo4j Aura.\nThe plugin needs to be installed on self-managed instances. This is done by moving the neo4j-genai.jar file from /products to /plugins in the Neo4j home directory, or, if you are using Docker, by starting the Docker container with the extra parameter --env NEO4J_PLUGINS='[\"genai\"]'. For more information, see Operations Manual ‚Üí Configure plugins.\nPrior to Neo4j 5.23, the GenAI plugin was only available on Neo4j Enterprise Edition.\nThe code offered by this course is not working well in my local machine. There will an error about genai when we run the same code. Solution is referred in Message: Failed to invoke function genai.vector.encode: Caused by: com.neo4j.genai.util.GenAIProcedureException: Not authorized to make API request; check your credentials.\nImport packages and set up Neo4j 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 from dotenv import load_dotenv import os from langchain_community.graphs import Neo4jGraph # Warning control import warnings warnings.filterwarnings(\"ignore\") # Load from environment load_dotenv('.env', override=True) NEO4J_URI = os.getenv('NEO4J_URI') NEO4J_USERNAME = os.getenv('NEO4J_USERNAME') NEO4J_PASSWORD = os.getenv('NEO4J_PASSWORD') NEO4J_DATABASE = os.getenv('NEO4J_DATABASE') OPENAI_API_KEY = os.getenv('OPENAI_API_KEY') # Note the code below is unique to this course environment, and not a # standard part of Neo4j's integration with OpenAI. Remove if running # in your own environment. OPENAI_ENDPOINT = os.getenv('OPENAI_BASE_URL') + '/embeddings' # Connect to the knowledge graph instance using LangChain kg = Neo4jGraph( url=NEO4J_URI, username=NEO4J_USERNAME, password=NEO4J_PASSWORD, database=NEO4J_DATABASE ) Create a vector index 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 result = kg.query(\"\"\" CREATE VECTOR INDEX movie_tagline_embeddings IF NOT EXISTS FOR (m:Movie) ON (m.taglineEmbedding) OPTIONS { indexConfig: { `vector.dimensions`: 1536, `vector.similarity_function`: 'cosine' }}\"\"\" ) print(result) vector_index = kg.query(\"\"\" SHOW VECTOR INDEXES \"\"\" ) print(vector_index) Output\n1 2 [] [{'id': 3, 'name': 'movie_tagline_embeddings', 'state': 'POPULATING', 'populationPercent': 0.0, 'type': 'VECTOR', 'entityType': 'NODE', 'labelsOrTypes': ['Movie'], 'properties': ['taglineEmbedding'], 'indexProvider': 'vector-2.0', 'owningConstraint': None, 'lastRead': None, 'readCount': None}] Populate the vector index Calculate vector representation for each movie tagline using OpenAI Add vector to the Movie node as taglineEmbedding property Here is the updated version of the code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 from dotenv import load_dotenv import os from neo4j import GraphDatabase from langchain_community.embeddings import OpenAIEmbeddings # Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè load_dotenv('.env', override=True) # ËØªÂèñËá™ÂÆö‰πâurl OPENAI_BASE_URL = os.getenv('OPENAI_BASE_URL') OPENAI_API_KEY = os.getenv('OPENAI_API_KEY') # ÂàùÂßãÂåñOpenAIÂµåÂÖ•Ê®°Âûã embedding_model = OpenAIEmbeddings() # ËøûÊé•Neo4j NEO4J_URI = os.getenv('NEO4J_URI') NEO4J_USERNAME = os.getenv('NEO4J_USERNAME') NEO4J_PASSWORD = os.getenv('NEO4J_PASSWORD') driver = GraphDatabase.driver(NEO4J_URI, auth=(NEO4J_USERNAME, NEO4J_PASSWORD)) # ÂÆö‰πâËé∑ÂèñÂêëÈáèÁöÑÂáΩÊï∞ def get_embedding(text): return embedding_model.embed_query(text) # Êü•ËØ¢Êú™ËÆæÁΩÆembeddingÁöÑÁîµÂΩ±ËäÇÁÇπ with driver.session() as session: result = session.run(\"\"\" MATCH (m:Movie) WHERE m.tagline IS NOT NULL AND m.taglineEmbedding IS NULL RETURN id(m) AS id, m.tagline AS tagline \"\"\") for record in result: node_id = record['id'] tagline = record['tagline'] try: vector = get_embedding(tagline) # Êõ¥Êñ∞ËäÇÁÇπÂ≠òÂÇ®ÂêëÈáè session.run(\"\"\" MATCH (m) WHERE id(m) = $id SET m.taglineEmbedding = $vector \"\"\", {\"id\": node_id, \"vector\": vector}) print(f\"ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID {node_id} ÁöÑÂêëÈáè„ÄÇ\") except Exception as e: print(f\"Â§ÑÁêÜÁîµÂΩ±ID {node_id} Êó∂Âá∫ÈîôÔºö{e}\") print(\"ÊâÄÊúâÁîµÂΩ±Ê†áÁ≠æÁöÑÂêëÈáèÂ∑≤Êõ¥Êñ∞ÂÆåÊØï„ÄÇ\") Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 LangChainDeprecationWarning: The class `OpenAIEmbeddings` was deprecated in LangChain 0.0.9 and will be removed in 1.0. An updated version of the class exists in the :class:`~langchain-openai package and should be used instead. To use it run `pip install -U :class:`~langchain-openai` and import as `from :class:`~langchain_openai import OpenAIEmbeddings``. embedding_model = OpenAIEmbeddings() Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 4, column: 16, offset: 107} for query: '\\n MATCH (m:Movie)\\n WHERE m.tagline IS NOT NULL AND m.taglineEmbedding IS NULL\\n RETURN id(m) AS id, m.tagline AS tagline\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 4 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 13 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 14 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 15 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 19 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 33 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 41 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 50 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 56 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 60 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 66 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 71 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 77 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 82 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 85 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 89 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 91 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 96 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 99 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 101 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 104 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 109 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 115 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 120 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 125 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 132 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 134 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 141 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 145 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 148 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 151 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 154 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 156 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 161 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 163 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 165 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID 166 ÁöÑÂêëÈáè„ÄÇ Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 33, offset: 33} for query: '\\n MATCH (m) WHERE id(m) = $id\\n SET m.taglineEmbedding = $vector\\n ' ÊâÄÊúâÁîµÂΩ±Ê†áÁ≠æÁöÑÂêëÈáèÂ∑≤Êõ¥Êñ∞ÂÆåÊØï„ÄÇ Get information about tagline. We can use the code as follows:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 from dotenv import load_dotenv import os from langchain_community.graphs import Neo4jGraph from langchain_community.embeddings import OpenAIEmbeddings # Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè load_dotenv('.env', override=True) # ËØªÂèñËá™ÂÆö‰πâurl OPENAI_BASE_URL = os.getenv('OPENAI_BASE_URL') OPENAI_API_KEY = os.getenv('OPENAI_API_KEY') # ÂàùÂßãÂåñOpenAIÂµåÂÖ•Ê®°Âûã embedding_model = OpenAIEmbeddings() # ËøûÊé•Neo4j NEO4J_URI = os.getenv('NEO4J_URI') NEO4J_USERNAME = os.getenv('NEO4J_USERNAME') NEO4J_PASSWORD = os.getenv('NEO4J_PASSWORD') NEO4J_DATABASE = os.getenv('NEO4J_DATABASE') # Connect to the knowledge graph instance using LangChain kg = Neo4jGraph( url=NEO4J_URI, username=NEO4J_USERNAME, password=NEO4J_PASSWORD, database=NEO4J_DATABASE ) result = kg.query(\"\"\" MATCH (m:Movie) WHERE m.tagline IS NOT NULL RETURN m.tagline, m.taglineEmbedding LIMIT 1 \"\"\" ) print(result[0]['m.tagline']) print(result[0]['m.taglineEmbedding'][:10]) print(len(result[0]['m.taglineEmbedding'])) Output:\n1 2 3 Welcome to the Real World [0.017445066977872476, -0.00548189274175866, -0.0020135224370537784, -0.025571243887471496, -0.014404304353743229, 0.01673730279797421, -0.017078077453982578, 0.00048535884802129926, -0.02521736179752236, -0.029516371024739575] 1536 The previous version of the code is as follows\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 from dotenv import load_dotenv import os from langchain_community.graphs import Neo4jGraph # Warning control import warnings warnings.filterwarnings(\"ignore\") # Load from environment load_dotenv('.env', override=True) NEO4J_URI = os.getenv('NEO4J_URI') NEO4J_USERNAME = os.getenv('NEO4J_USERNAME') NEO4J_PASSWORD = os.getenv('NEO4J_PASSWORD') NEO4J_DATABASE = os.getenv('NEO4J_DATABASE') OPENAI_API_KEY = os.getenv('OPENAI_API_KEY') # Note the code below is unique to this course environment, and not a # standard part of Neo4j's integration with OpenAI. Remove if running # in your own environment. OPENAI_ENDPOINT = os.getenv('OPENAI_BASE_URL') + '/embeddings' # Connect to the knowledge graph instance using LangChain kg = Neo4jGraph( url=NEO4J_URI, username=NEO4J_USERNAME, password=NEO4J_PASSWORD, database=NEO4J_DATABASE ) result = kg.query(\"\"\" MATCH (movie:Movie) WHERE movie.tagline IS NOT NULL WITH movie, genai.vector.encode( movie.tagline, \"OpenAI\", { token: $openAiApiKey, endpoint: $openAiEndpoint }) AS vector CALL db.create.setNodeVectorProperty(movie, \"taglineEmbedding\", vector) \"\"\", params={\"openAiApiKey\":OPENAI_API_KEY, \"openAiEndpoint\": OPENAI_ENDPOINT} ) print(result) result = kg.query(\"\"\" MATCH (m:Movie) WHERE m.tagline IS NOT NULL RETURN m.tagline, m.taglineEmbedding LIMIT 1 \"\"\" ) print(result[0]['m.tagline']) print(result[0]['m.taglineEmbedding'][:10]) print(len(result[0]['m.taglineEmbedding'])) Output\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 'Welcome to the Real World' [0.017427725717425346, -0.005441250279545784, -0.0020343265496194363, -0.02555192820727825, -0.014335286803543568, 0.016746340319514275, -0.01711324043571949, 0.0005196377751417458, -0.025263650342822075, -0.029509201645851135] 1536 Similarity search Calculate embedding for question Identify matching movies based on similarity of question and taglineEmbedding vectors Here is the updated version of the code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 from dotenv import load_dotenv import os from langchain_community.graphs import Neo4jGraph from langchain_community.embeddings import OpenAIEmbeddings # Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè load_dotenv('.env', override=True) OPENAI_BASE_URL = os.getenv('OPENAI_BASE_URL') OPENAI_API_KEY = os.getenv('OPENAI_API_KEY') NEO4J_URI = os.getenv('NEO4J_URI') NEO4J_USERNAME = os.getenv('NEO4J_USERNAME') NEO4J_PASSWORD = os.getenv('NEO4J_PASSWORD') NEO4J_DATABASE = os.getenv('NEO4J_DATABASE') # ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ embedding_model = OpenAIEmbeddings(api_key=OPENAI_API_KEY, base_url=OPENAI_BASE_URL) # ËøûÊé• Neo4j kg = Neo4jGraph( url=NEO4J_URI, username=NEO4J_USERNAME, password=NEO4J_PASSWORD, database=NEO4J_DATABASE ) def vector_search(question, top_k=5): # Step 1: ËÆ°ÁÆóÈóÆÈ¢òÁöÑÂêëÈáè question_embedding = embedding_model.embed_query(question) # Step 2: Âú®Neo4jÂÅöÂêëÈáèÁõ∏‰ººÂ∫¶ÊêúÁ¥¢ cypher = \"\"\" CALL db.index.vector.queryNodes( 'movie_tagline_embeddings', $top_k, $question_embedding ) YIELD node AS movie, score RETURN movie.title AS title, movie.tagline AS tagline, score ORDER BY score DESC LIMIT $top_k \"\"\" results = kg.query( cypher, params={ \"top_k\": top_k, \"question_embedding\": question_embedding } ) return results # ÊµãËØïÈóÆÁ≠î question = \"What movies are about love?\" results = vector_search(question, top_k=5) print(f\"Top {len(results)} results for question: {question}\") for i, record in enumerate(results): print(f\"{i+1}. Title: {record['title']}\") print(f\" Tagline: {record['tagline']}\") print(f\" Score: {record['score']:.4f}\") Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 Top 5 results for question: What movies are about love? 1. Title: Joe Versus the Volcano Tagline: A story of love, lava and burning desire. Score: 0.9008 2. Title: As Good as It Gets Tagline: A comedy from the heart that goes for the throat. Score: 0.8963 3. Title: Snow Falling on Cedars Tagline: First loves last. Forever. Score: 0.8947 4. Title: When Harry Met Sally Tagline: Can two friends sleep together and still love each other in the morning? Score: 0.8894 5. Title: Sleepless in Seattle Tagline: What if someone you never met, someone you never saw, someone you never knew was the only someone for you? Score: 0.8882 Some warning are as follows:\n1 2 3 4 5 LangChainDeprecationWarning: The class `OpenAIEmbeddings` was deprecated in LangChain 0.0.9 and will be removed in 1.0. An updated version of the class exists in the :class:`~langchain-openai package and should be used instead. To use it run `pip install -U :class:`~langchain-openai` and import as `from :class:`~langchain_openai import OpenAIEmbeddings``. embedding_model = OpenAIEmbeddings(api_key=OPENAI_API_KEY, base_url=OPENAI_BASE_URL) LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the :class:`~langchain-neo4j package and should be used instead. To use it run `pip install -U :class:`~langchain-neo4j` and import as `from :class:`~langchain_neo4j import Neo4jGraph``. kg = Neo4jGraph( The previous version of the code is as follows\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 question = \"What movies are about love?\" kg.query(\"\"\" WITH genai.vector.encode( $question, \"OpenAI\", { token: $openAiApiKey, endpoint: $openAiEndpoint }) AS question_embedding CALL db.index.vector.queryNodes( 'movie_tagline_embeddings', $top_k, question_embedding ) YIELD node AS movie, score RETURN movie.title, movie.tagline, score \"\"\", params={\"openAiApiKey\":OPENAI_API_KEY, \"openAiEndpoint\": OPENAI_ENDPOINT, \"question\": question, \"top_k\": 5 }) Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [{'movie.title': 'Joe Versus the Volcano', 'movie.tagline': 'A story of love, lava and burning desire.', 'score': 0.9062923789024353}, {'movie.title': 'As Good as It Gets', 'movie.tagline': 'A comedy from the heart that goes for the throat.', 'score': 0.9022473096847534}, {'movie.title': 'Snow Falling on Cedars', 'movie.tagline': 'First loves last. Forever.', 'score': 0.9013161659240723}, {'movie.title': 'Sleepless in Seattle', 'movie.tagline': 'What if someone you never met, someone you never saw, someone you never knew was the only someone for you?', 'score': 0.8944727182388306}, {'movie.title': 'When Harry Met Sally', 'movie.tagline': 'Can two friends sleep together and still love each other in the morning?', 'score': 0.8942465782165527}] Try for yourself: ask you own question! Change the question below and run the graph query to find different movies The previous version of the code is as follows\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 question = \"What movies are about adventure?\" kg.query(\"\"\" WITH genai.vector.encode( $question, \"OpenAI\", { token: $openAiApiKey, endpoint: $openAiEndpoint }) AS question_embedding CALL db.index.vector.queryNodes( 'movie_tagline_embeddings', $top_k, question_embedding ) YIELD node AS movie, score RETURN movie.title, movie.tagline, score \"\"\", params={\"openAiApiKey\":OPENAI_API_KEY, \"openAiEndpoint\": OPENAI_ENDPOINT, \"question\": question, \"top_k\": 5 }) Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 [{'movie.title': 'RescueDawn', 'movie.tagline': \"Based on the extraordinary true story of one man's fight for freedom\", 'score': 0.8998302221298218}, {'movie.title': 'Cast Away', 'movie.tagline': 'At the edge of the world, his journey begins.', 'score': 0.8985401391983032}, {'movie.title': 'Ninja Assassin', 'movie.tagline': 'Prepare to enter a secret world of assassins', 'score': 0.8879814147949219}, {'movie.title': 'Joe Versus the Volcano', 'movie.tagline': 'A story of love, lava and burning desire.', 'score': 0.8870342969894409}, {'movie.title': 'As Good as It Gets', 'movie.tagline': 'A comedy from the heart that goes for the throat.', 'score': 0.8855679035186768}] Lesson 4: Constructing a Knowledge Graph from Text Documents Data cleaning procedure is as follows.\nMain overview of lesson 4 is as follows.\nImport packages and set up Neo4j 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 from dotenv import load_dotenv import os # Common data processing import json import textwrap # Langchain from langchain_community.graphs import Neo4jGraph from langchain_community.vectorstores import Neo4jVector from langchain_openai import OpenAIEmbeddings from langchain.text_splitter import RecursiveCharacterTextSplitter from langchain.chains import RetrievalQAWithSourcesChain from langchain_openai import ChatOpenAI # Warning control import warnings warnings.filterwarnings(\"ignore\") # Load from environment load_dotenv('.env', override=True) NEO4J_URI = os.getenv('NEO4J_URI') NEO4J_USERNAME = os.getenv('NEO4J_USERNAME') NEO4J_PASSWORD = os.getenv('NEO4J_PASSWORD') NEO4J_DATABASE = os.getenv('NEO4J_DATABASE') or 'neo4j' OPENAI_API_KEY = os.getenv('OPENAI_API_KEY') # Note the code below is unique to this course environment, and not a # standard part of Neo4j's integration with OpenAI. Remove if running # in your own environment. OPENAI_ENDPOINT = os.getenv('OPENAI_BASE_URL') + '/embeddings' # Global constants VECTOR_INDEX_NAME = 'form_10k_chunks' VECTOR_NODE_LABEL = 'Chunk' VECTOR_SOURCE_PROPERTY = 'text' VECTOR_EMBEDDING_PROPERTY = 'textEmbedding' Take a look at a Form 10-K json file Publicly traded companies are required to fill a form 10-K each year with the Securities and Exchange Commision (SEC) You can search these filings using the SEC‚Äôs https://www.sec.gov/edgar/search/ For the next few lessons, you‚Äôll work with a single 10-K form for a company called https://www.netapp.com/ 1 2 3 4 5 first_file_name = \"./data/form10k/0000950170-23-027948.json\" first_file_as_object = json.load(open(first_file_name)) type(first_file_as_object) for k,v in first_file_as_object.items(): print(k, type(v)) Output:\n1 2 3 4 5 6 7 8 9 item1 ",
  "wordCount" : "23642",
  "inLanguage": "zh",
  "datePublished": "2025-05-15T18:34:25+08:00",
  "dateModified": "2025-05-15T22:54:22+08:00",
  "author":{
    "@type": "Person",
    "name": "RM"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://rosefinch-midsummer.github.io/zh/posts/course/deeplearningaiknowledge-graphs-for-rag/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Â§©Êº¢Â∏ùÂúãÂæ©ËààÈåÑ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://rosefinch-midsummer.github.io/img/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://rosefinch-midsummer.github.io/zh/" accesskey="h" title="Â§©Êº¢Â∏ùÂúãÂæ©ËààÈåÑ (Alt + H)">Â§©Êº¢Â∏ùÂúãÂæ©ËààÈåÑ</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://rosefinch-midsummer.github.io/zh/" title="üè†‰∏ªÈ†Å">
                    <span>üè†‰∏ªÈ†Å</span>
                </a>
            </li>
            <li>
                <a href="https://rosefinch-midsummer.github.io/zh/posts" title="üìöÊñáÁ´†">
                    <span>üìöÊñáÁ´†</span>
                </a>
            </li>
            <li>
                <a href="https://rosefinch-midsummer.github.io/zh/search" title="üîçÊêúÁ¥¢ (Alt &#43; /)" accesskey=/>
                    <span>üîçÊêúÁ¥¢</span>
                </a>
            </li>
            <li>
                <a href="https://rosefinch-midsummer.github.io/zh/archives" title="‚è±ÊôÇÈñìËª∏">
                    <span>‚è±ÊôÇÈñìËª∏</span>
                </a>
            </li>
            <li>
                <a href="https://rosefinch-midsummer.github.io/zh/categories" title="üß©ÂàÜÈ°û">
                    <span>üß©ÂàÜÈ°û</span>
                </a>
            </li>
            <li>
                <a href="https://rosefinch-midsummer.github.io/zh/tags" title="üîñÊ®ôÁ∞Ω">
                    <span>üîñÊ®ôÁ∞Ω</span>
                </a>
            </li>
            <li>
                <a href="https://rosefinch-midsummer.github.io/zh/about" title="üôãüèª‚Äç‚ôÇÔ∏èÈóú‰∫é">
                    <span>üôãüèª‚Äç‚ôÇÔ∏èÈóú‰∫é</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://rosefinch-midsummer.github.io/zh/">È¶ñÈ†Å</a>&nbsp;¬ª&nbsp;<a href="https://rosefinch-midsummer.github.io/zh/posts/">üìöÊñáÁ´†</a>&nbsp;¬ª&nbsp;<a href="https://rosefinch-midsummer.github.io/zh/posts/course/">üè´Ë™≤Á®ã</a></div>
    <h1 class="post-title">
      DeeplearningAI„ÄäKnowledge-Graphs-for-RAG„Äã
    </h1>
    <div class="post-meta">
    ÂàõÂª∫: 2025-05-15 |
    Êõ¥Êñ∞: 2025-05-15 |
    Â≠óÊï∞: 23642Â≠ó |
    Êó∂Èïø: 48ÂàÜÈíü |
    RM


</div>
   
<div  class="meta-item">&nbsp¬∑&nbsp
  <span id="busuanzi_container_page_pv">Êú¨ÊñáÈòÖËØªÈáè<span id="busuanzi_value_page_pv"></span>Ê¨°</span>
</div>


  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ÁõÆÈåÑ</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#knowledge-graphs-for-rag" aria-label="Knowledge Graphs for RAG">Knowledge Graphs for RAG</a><ul>
                        
                <li>
                    <a href="#preface" aria-label="Preface">Preface</a><ul>
                        
                <li>
                    <a href="#what-youll-learn-in-this-course" aria-label="What you‚Äôll learn in this course">What you‚Äôll learn in this course</a></li></ul>
                </li>
                <li>
                    <a href="#lesson-1-knowledge-graphs-fundamentals" aria-label="Lesson 1: Knowledge Graphs Fundamentals">Lesson 1: Knowledge Graphs Fundamentals</a></li>
                <li>
                    <a href="#lesson-2-querying-knowledge-graphs-with-cypher" aria-label="Lesson 2: Querying Knowledge Graphs with Cypher">Lesson 2: Querying Knowledge Graphs with Cypher</a><ul>
                        
                <li>
                    <a href="#prerequisites" aria-label="Prerequisites">Prerequisites</a></li>
                <li>
                    <a href="#import-packages-and-set-up-neo4j" aria-label="Import packages and set up Neo4J">Import packages and set up Neo4J</a></li>
                <li>
                    <a href="#querying-the-movie-knowledge-graph" aria-label="Querying the movie knowledge graph">Querying the movie knowledge graph</a><ul>
                        
                <li>
                    <a href="#match-all-nodes-in-the-graph" aria-label="Match all nodes in the graph">Match all nodes in the graph</a></li>
                <li>
                    <a href="#match-only-the-movie-nodes-by-specifying-the-node-label" aria-label="Match only the Movie nodes by specifying the node label">Match only the Movie nodes by specifying the node label</a></li>
                <li>
                    <a href="#change-the-variable-name-in-the-node-pattern-match-for-improved-readability" aria-label="Change the variable name in the node pattern match for improved readability">Change the variable name in the node pattern match for improved readability</a></li>
                <li>
                    <a href="#match-only-the-person-nodes" aria-label="Match only the Person nodes">Match only the Person nodes</a></li>
                <li>
                    <a href="#match-a-single-person-by-specifying-the-value-of-the-name-property-on-the-person-node" aria-label="Match a single person by specifying the value of the name property on the Person node">Match a single person by specifying the value of the name property on the Person node</a></li>
                <li>
                    <a href="#match-a-single-movie-by-specifying-the-value-of-the-title-property" aria-label="Match a single Movie by specifying the value of the title property">Match a single Movie by specifying the value of the title property</a></li>
                <li>
                    <a href="#return-only-the-released-property-of-the-matched-movie-node" aria-label="Return only the released property of the matched Movie node">Return only the released property of the matched Movie node</a></li>
                <li>
                    <a href="#return-two-properties" aria-label="Return two properties">Return two properties</a></li>
                <li>
                    <a href="#cypher-patterns-with-conditional-matching" aria-label="Cypher patterns with conditional matching">Cypher patterns with conditional matching</a></li>
                <li>
                    <a href="#pattern-matching-with-multiple-nodes" aria-label="Pattern matching with multiple nodes">Pattern matching with multiple nodes</a></li>
                <li>
                    <a href="#delete-data-from-the-graph" aria-label="Delete data from the graph">Delete data from the graph</a></li>
                <li>
                    <a href="#adding-data-to-the-graph" aria-label="Adding data to the graph">Adding data to the graph</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#lesson-3-preparing-text-data-for-rag" aria-label="Lesson 3: Preparing Text Data for RAG">Lesson 3: Preparing Text Data for RAG</a><ul>
                        
                <li>
                    <a href="#prerequisites-genai-integrations" aria-label="Prerequisites: GenAI integrations">Prerequisites: GenAI integrations</a></li>
                <li>
                    <a href="#import-packages-and-set-up-neo4j-1" aria-label="Import packages and set up Neo4j">Import packages and set up Neo4j</a><ul>
                        
                <li>
                    <a href="#create-a-vector-index" aria-label="Create a vector index">Create a vector index</a></li></ul>
                </li>
                <li>
                    <a href="#populate-the-vector-index" aria-label="Populate the vector index">Populate the vector index</a></li>
                <li>
                    <a href="#similarity-search" aria-label="Similarity search">Similarity search</a></li>
                <li>
                    <a href="#try-for-yourself-ask-you-own-question" aria-label="Try for yourself: ask you own question!">Try for yourself: ask you own question!</a></li></ul>
                </li>
                <li>
                    <a href="#lesson-4-constructing-a-knowledge-graph-from-text-documents" aria-label="Lesson 4: Constructing a Knowledge Graph from Text Documents">Lesson 4: Constructing a Knowledge Graph from Text Documents</a><ul>
                        
                <li>
                    <a href="#import-packages-and-set-up-neo4j-2" aria-label="Import packages and set up Neo4j">Import packages and set up Neo4j</a></li>
                <li>
                    <a href="#take-a-look-at-a-form-10-k-json-file" aria-label="Take a look at a Form 10-K json file">Take a look at a Form 10-K json file</a></li>
                <li>
                    <a href="#split-form-10-k-sections-into-chunks" aria-label="Split Form 10-K sections into chunks">Split Form 10-K sections into chunks</a></li>
                <li>
                    <a href="#create-graph-nodes-using-text-chunks" aria-label="Create graph nodes using text chunks">Create graph nodes using text chunks</a></li>
                <li>
                    <a href="#create-a-vector-index-1" aria-label="Create a vector index">Create a vector index</a></li>
                <li>
                    <a href="#calculate-embedding-vectors-for-chunks-and-populate-index" aria-label="Calculate embedding vectors for chunks and populate index">Calculate embedding vectors for chunks and populate index</a></li>
                <li>
                    <a href="#use-similarity-search-to-find-relevant-chunks" aria-label="Use similarity search to find relevant chunks">Use similarity search to find relevant chunks</a></li>
                <li>
                    <a href="#set-up-a-langchain-rag-workflow-to-chat-with-the-form" aria-label="Set up a LangChain RAG workflow to chat with the form">Set up a LangChain RAG workflow to chat with the form</a></li></ul>
                </li>
                <li>
                    <a href="#lesson-5-adding-relationships-to-the-sec-knowledge-graph" aria-label="Lesson 5: Adding Relationships to the SEC Knowledge Graph">Lesson 5: Adding Relationships to the SEC Knowledge Graph</a><ul>
                        
                <li>
                    <a href="#import-packages-and-set-up-neo4j-3" aria-label="Import packages and set up Neo4j">Import packages and set up Neo4j</a></li>
                <li>
                    <a href="#create-a-form-10-k-node" aria-label="Create a Form 10-K node">Create a Form 10-K node</a></li>
                <li>
                    <a href="#create-a-linked-list-of-chunk-nodes-for-each-section" aria-label="Create a linked list of Chunk nodes for each section">Create a linked list of Chunk nodes for each section</a></li>
                <li>
                    <a href="#add-a-next-relationship-between-subsequent-chunks" aria-label="Add a NEXT relationship between subsequent chunks">Add a NEXT relationship between subsequent chunks</a></li>
                <li>
                    <a href="#connect-chunks-to-their-parent-form-with-a-part_of-relationship" aria-label="Connect chunks to their parent form with a PART_OF relationship">Connect chunks to their parent form with a PART_OF relationship</a></li>
                <li>
                    <a href="#create-a-section-relationship-on-first-chunk-of-each-section" aria-label="Create a SECTION relationship on first chunk of each section">Create a SECTION relationship on first chunk of each section</a></li>
                <li>
                    <a href="#example-cypher-queries" aria-label="Example cypher queries">Example cypher queries</a></li>
                <li>
                    <a href="#information-is-stored-in-the-structure-of-a-graph" aria-label="Information is stored in the structure of a graph">Information is stored in the structure of a graph</a></li>
                <li>
                    <a href="#finding-variable-length-windows" aria-label="Finding variable length windows">Finding variable length windows</a></li>
                <li>
                    <a href="#customize-the-results-of-the-similarity-search-using-cypher" aria-label="Customize the results of the similarity search using Cypher">Customize the results of the similarity search using Cypher</a></li>
                <li>
                    <a href="#try-for-yourself" aria-label="Try for yourself!">Try for yourself!</a></li>
                <li>
                    <a href="#expand-context-around-a-chunk-using-a-window" aria-label="Expand context around a chunk using a window">Expand context around a chunk using a window</a></li>
                <li>
                    <a href="#compare-the-two-chains" aria-label="Compare the two chains">Compare the two chains</a></li></ul>
                </li>
                <li>
                    <a href="#lesson-6-expanding-the-sec-knowledge-graph" aria-label="Lesson 6: Expanding the SEC Knowledge Graph">Lesson 6: Expanding the SEC Knowledge Graph</a><ul>
                        
                <li>
                    <a href="#import-packages-and-set-up-neo4j-4" aria-label="Import packages and set up Neo4j">Import packages and set up Neo4j</a></li>
                <li>
                    <a href="#read-the-collection-of-form-13s" aria-label="Read the collection of Form 13s">Read the collection of Form 13s</a></li>
                <li>
                    <a href="#create-company-nodes-in-the-graph" aria-label="Create company nodes in the graph">Create company nodes in the graph</a></li>
                <li>
                    <a href="#create-manager-nodes" aria-label="Create manager nodes">Create manager nodes</a></li>
                <li>
                    <a href="#create-relationships-between-managers-and-companies" aria-label="Create relationships between managers and companies">Create relationships between managers and companies</a></li>
                <li>
                    <a href="#determine-the-number-of-investors" aria-label="Determine the number of investors">Determine the number of investors</a></li>
                <li>
                    <a href="#use-queries-to-build-additional-context-for-llm" aria-label="Use queries to build additional context for LLM">Use queries to build additional context for LLM</a></li></ul>
                </li>
                <li>
                    <a href="#lesson-7-chatting-with-the-sec-knowledge-graph" aria-label="Lesson 7: Chatting with the SEC Knowledge Graph">Lesson 7: Chatting with the SEC Knowledge Graph</a><ul>
                        
                <li>
                    <a href="#import-packages-and-set-up-neo4j-5" aria-label="Import packages and set up Neo4j">Import packages and set up Neo4j</a></li>
                <li>
                    <a href="#build-located_in-relationship-between-mgr-and-addr" aria-label="Build LOCATED_IN relationship between mgr and addr">Build LOCATED_IN relationship between mgr and addr</a><ul>
                        
                <li>
                    <a href="#1-data-structure-overview" aria-label="1. Data Structure Overview">1. Data Structure Overview</a></li>
                <li>
                    <a href="#2-cypher-query-with-parameters" aria-label="2. Cypher Query with Parameters">2. Cypher Query with Parameters</a></li>
                <li>
                    <a href="#3-python-example-using-neo4jgraph" aria-label="3. Python Example Using Neo4jGraph">3. Python Example Using Neo4jGraph</a></li>
                <li>
                    <a href="#4-key-points" aria-label="4. Key Points">4. Key Points</a></li></ul>
                </li>
                <li>
                    <a href="#build-located_at-relationship-between-manager-and-address-with-dynamic-address-parsing" aria-label="Build LOCATED_AT Relationship Between Manager and Address with Dynamic Address Parsing">Build LOCATED_AT Relationship Between Manager and Address with Dynamic Address Parsing</a><ul>
                        
                <li>
                    <a href="#1-understanding-your-data" aria-label="1. Understanding Your Data">1. Understanding Your Data</a></li>
                <li>
                    <a href="#2-accessing-neo4j-spatial-data-in-python" aria-label="2. Accessing Neo4j Spatial Data in Python">2. Accessing Neo4j Spatial Data in Python</a></li>
                <li>
                    <a href="#3-dynamic-city-and-state-parsing-from-address-string" aria-label="3. Dynamic City and State Parsing from Address String">3. Dynamic City and State Parsing from Address String</a></li>
                <li>
                    <a href="#4-complete-python-script-example" aria-label="4. Complete Python Script Example">4. Complete Python Script Example</a></li></ul>
                </li>
                <li>
                    <a href="#explore-the-updated-sec-documents-graph" aria-label="Explore the updated SEC documents graph">Explore the updated SEC documents graph</a></li>
                <li>
                    <a href="#writing-cypher-with-an-llm" aria-label="Writing Cypher with an LLM">Writing Cypher with an LLM</a></li>
                <li>
                    <a href="#expand-the-prompt-to-teach-the-llm-new-cypher-patterns" aria-label="Expand the prompt to teach the LLM new Cypher patterns">Expand the prompt to teach the LLM new Cypher patterns</a></li>
                <li>
                    <a href="#expand-the-query-to-retrieve-information-from-the-form-10k-chunks" aria-label="Expand the query to retrieve information from the Form 10K chunks">Expand the query to retrieve information from the Form 10K chunks</a></li></ul>
                </li>
                <li>
                    <a href="#references" aria-label="References">References</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="knowledge-graphs-for-rag">Knowledge Graphs for RAG<a hidden class="anchor" aria-hidden="true" href="#knowledge-graphs-for-rag">#</a></h1>
<h2 id="preface">Preface<a hidden class="anchor" aria-hidden="true" href="#preface">#</a></h2>
<p>This article is a study note for the course <a href="https://www.deeplearning.ai/short-courses/knowledge-graphs-rag/">https://www.deeplearning.ai/short-courses/knowledge-graphs-rag/</a>.</p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/e9463f6769ef43bda3fc01f21907229b.png"></p>
<h3 id="what-youll-learn-in-this-course">What you‚Äôll learn in this course<a hidden class="anchor" aria-hidden="true" href="#what-youll-learn-in-this-course">#</a></h3>
<p>Knowledge graphs are used in development to structure complex data relationships, drive intelligent search functionality, and build powerful AI applications that can reason over different data types. Knowledge graphs can connect data from both structured and unstructured sources (databases, documents, etc.), providing an intuitive and flexible way to model complex, real-world scenarios.</p>
<p>Unlike tables or simple lists, knowledge graphs can capture the meaning and context behind the data, allowing you to uncover insights and connections that would be difficult to find with conventional databases. This rich, structured context is ideal for improving the output of large language models (LLMs), because you can build more relevant context for the model than with semantic search alone.</p>
<p>This course will teach you how to leverage knowledge graphs within retrieval augmented generation (RAG) applications. You‚Äôll learn to:</p>
<ul>
<li>Understand the basics of how knowledge graphs store data by using nodes to represent entities and edges to represent relationships between nodes.</li>
<li>Use Neo4j‚Äôs query language, Cypher, to retrieve information from a fun graph of movie and actor data.</li>
<li>Add a vector index to a knowledge graph to represent unstructured text data and find relevant texts using vector similarity search.</li>
<li>Build a knowledge graph of text documents from scratch, using publicly available financial and investment documents as the demo use case.</li>
<li>Explore advanced techniques for connecting multiple knowledge graphs and using complex queries for comprehensive data retrieval.</li>
<li>Write advanced Cypher queries to retrieve relevant information from the graph and format it for inclusion in your prompt to an LLM.</li>
</ul>
<p>After course completion, you‚Äôll be well-equipped to use knowledge graphs to uncover deeper insights in your data, and enhance the performance of LLMs with structured, relevant context.</p>
<h2 id="lesson-1-knowledge-graphs-fundamentals">Lesson 1: Knowledge Graphs Fundamentals<a hidden class="anchor" aria-hidden="true" href="#lesson-1-knowledge-graphs-fundamentals">#</a></h2>
<p>What is a Knowledge GraphÔºü</p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/6b0d67b677fe49948b13921a36683a52.png"></p>
<p>Relationships</p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/6b276b482f144c2f94634fbb142e0a54.png"></p>
<p>Nodes</p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/2b622e1b645f4ef4b167d64f76da4bcb.png"></p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/86026766de164dcfb4484d23d28d117b.png"></p>
<h2 id="lesson-2-querying-knowledge-graphs-with-cypher">Lesson 2: Querying Knowledge Graphs with Cypher<a hidden class="anchor" aria-hidden="true" href="#lesson-2-querying-knowledge-graphs-with-cypher">#</a></h2>
<h3 id="prerequisites">Prerequisites<a hidden class="anchor" aria-hidden="true" href="#prerequisites">#</a></h3>
<p>You must have Neo4j running and have added the movie data from the example.</p>
<p><strong>The content of the .env file is as follows:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NEO4J_URI=bolt://localhost:7687
</span></span><span class="line"><span class="cl">NEO4J_USERNAME=neo4j
</span></span><span class="line"><span class="cl">NEO4J_PASSWORD=Your_Password_Here
</span></span><span class="line"><span class="cl">NEO4J_DATABASE=neo4j
</span></span><span class="line"><span class="cl">OPENAI_API_KEY=Your_OpenAI_API_KEY
</span></span><span class="line"><span class="cl">OPENAI_BASE_URL=OPENAI_BASE_URL
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="import-packages-and-set-up-neo4j">Import packages and set up Neo4J<a hidden class="anchor" aria-hidden="true" href="#import-packages-and-set-up-neo4j">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Initialize a knowledge graph instance using LangChain‚Äôs Neo4j integration. Use the code below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="querying-the-movie-knowledge-graph">Querying the movie knowledge graph<a hidden class="anchor" aria-hidden="true" href="#querying-the-movie-knowledge-graph">#</a></h3>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/3d2ba4011bd0455ba1327ae74fe9fbab.png"></p>
<h4 id="match-all-nodes-in-the-graph">Match all nodes in the graph<a hidden class="anchor" aria-hidden="true" href="#match-all-nodes-in-the-graph">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (n) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN count(n)
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;count(n)&#39;: 171}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (n) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN count(n) AS numberOfNodes
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;numberOfNodes&#39;: 175}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;There are </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;numberOfNodes&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> nodes in this graph.&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">There are 175 nodes in this graph.
</span></span></code></pre></td></tr></table>
</div>
</div><p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/84992fc2a3d049b7bf7116ea572b176f.png"></p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/29326920508a41be8e59498d80321358.png"></p>
<h4 id="match-only-the-movie-nodes-by-specifying-the-node-label">Match only the <code>Movie</code> nodes by specifying the node label<a hidden class="anchor" aria-hidden="true" href="#match-only-the-movie-nodes-by-specifying-the-node-label">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (n:Movie) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN count(n) AS numberOfMovies
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;numberOfMovies&#39;: 38}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="change-the-variable-name-in-the-node-pattern-match-for-improved-readability">Change the variable name in the node pattern match for improved readability<a hidden class="anchor" aria-hidden="true" href="#change-the-variable-name-in-the-node-pattern-match-for-improved-readability">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (m:Movie) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN count(m) AS numberOfMovies
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;numberOfMovies&#39;: 38}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="match-only-the-person-nodes">Match only the <code>Person</code> nodes<a hidden class="anchor" aria-hidden="true" href="#match-only-the-person-nodes">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (people:Person) 
</span></span><span class="line"><span class="cl">  RETURN count(people) AS numberOfPeople
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;numberOfPeople&#39;: 137}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="match-a-single-person-by-specifying-the-value-of-the-name-property-on-the-person-node">Match a single person by specifying the value of the <code>name</code> property on the <code>Person</code> node<a hidden class="anchor" aria-hidden="true" href="#match-a-single-person-by-specifying-the-value-of-the-name-property-on-the-person-node">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (tom:Person {name:&#34;Tom Hanks&#34;}) 
</span></span><span class="line"><span class="cl">  RETURN tom
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;tom&#39;: {&#39;born&#39;: 1956, &#39;name&#39;: &#39;Tom Hanks&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="match-a-single-movie-by-specifying-the-value-of-the-title-property">Match a single <code>Movie</code> by specifying the value of the <code>title</code> property<a hidden class="anchor" aria-hidden="true" href="#match-a-single-movie-by-specifying-the-value-of-the-title-property">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (cloudAtlas:Movie {title:&#34;Cloud Atlas&#34;}) 
</span></span><span class="line"><span class="cl">  RETURN cloudAtlas
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;cloudAtlas&#39;: {&#39;tagline&#39;: &#39;Everything is connected&#39;, &#39;title&#39;: &#39;Cloud Atlas&#39;, &#39;released&#39;: 2012}}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="return-only-the-released-property-of-the-matched-movie-node">Return only the <code>released</code> property of the matched <code>Movie</code> node<a hidden class="anchor" aria-hidden="true" href="#return-only-the-released-property-of-the-matched-movie-node">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (cloudAtlas:Movie {title:&#34;Cloud Atlas&#34;}) 
</span></span><span class="line"><span class="cl">  RETURN cloudAtlas.released
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;cloudAtlas.released&#39;: 2012}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="return-two-properties">Return two properties<a hidden class="anchor" aria-hidden="true" href="#return-two-properties">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (cloudAtlas:Movie {title:&#34;Cloud Atlas&#34;}) 
</span></span><span class="line"><span class="cl">  RETURN cloudAtlas.released, cloudAtlas.tagline
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;cloudAtlas.released&#39;: 2012,
</span></span><span class="line"><span class="cl">  &#39;cloudAtlas.tagline&#39;: &#39;Everything is connected&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="cypher-patterns-with-conditional-matching">Cypher patterns with conditional matching<a hidden class="anchor" aria-hidden="true" href="#cypher-patterns-with-conditional-matching">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (nineties:Movie) 
</span></span><span class="line"><span class="cl">  WHERE nineties.released &gt;= 1990 
</span></span><span class="line"><span class="cl">    AND nineties.released &lt; 2000 
</span></span><span class="line"><span class="cl">  RETURN nineties.title
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;nineties.title&#39;: &#39;The Matrix&#39;}, {&#39;nineties.title&#39;: &#34;The Devil&#39;s Advocate&#34;}, {&#39;nineties.title&#39;: &#39;A Few Good Men&#39;}, {&#39;nineties.title&#39;: &#39;As Good as It Gets&#39;}, {&#39;nineties.title&#39;: &#39;What Dreams May Come&#39;}, {&#39;nineties.title&#39;: &#39;Snow Falling on Cedars&#39;}, {&#39;nineties.title&#39;: &#34;You&#39;ve Got Mail&#34;}, {&#39;nineties.title&#39;: &#39;Sleepless in Seattle&#39;}, {&#39;nineties.title&#39;: &#39;Joe Versus the Volcano&#39;}, {&#39;nineties.title&#39;: &#39;When Harry Met Sally&#39;}, {&#39;nineties.title&#39;: &#39;That Thing You Do&#39;}, {&#39;nineties.title&#39;: &#39;The Birdcage&#39;}, {&#39;nineties.title&#39;: &#39;Unforgiven&#39;}, {&#39;nineties.title&#39;: &#39;Johnny Mnemonic&#39;}, {&#39;nineties.title&#39;: &#39;The Green Mile&#39;}, {&#39;nineties.title&#39;: &#39;Hoffa&#39;}, {&#39;nineties.title&#39;: &#39;Apollo 13&#39;}, {&#39;nineties.title&#39;: &#39;Twister&#39;}, {&#39;nineties.title&#39;: &#39;Bicentennial Man&#39;}, {&#39;nineties.title&#39;: &#39;A League of Their Own&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="pattern-matching-with-multiple-nodes">Pattern matching with multiple nodes<a hidden class="anchor" aria-hidden="true" href="#pattern-matching-with-multiple-nodes">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (actor:Person)-[:ACTED_IN]-&gt;(movie:Movie) 
</span></span><span class="line"><span class="cl">  RETURN actor.name, movie.title LIMIT 10
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Emil Eifrem&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Hugo Weaving&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Laurence Fishburne&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Carrie-Anne Moss&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Keanu Reeves&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Hugo Weaving&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix Reloaded&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Laurence Fishburne&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix Reloaded&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Carrie-Anne Moss&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix Reloaded&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Keanu Reeves&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix Reloaded&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;actor.name&#39;</span><span class="p">:</span> <span class="s1">&#39;Hugo Weaving&#39;</span><span class="p">,</span> <span class="s1">&#39;movie.title&#39;</span><span class="p">:</span> <span class="s1">&#39;The Matrix Revolutions&#39;</span><span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (tom:Person {name: &#34;Tom Hanks&#34;})-[:ACTED_IN]-&gt;(tomHanksMovies:Movie) 
</span></span><span class="line"><span class="cl">  RETURN tom.name,tomHanksMovies.title
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;Apollo 13&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#34;You&#39;ve Got Mail&#34;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;A League of Their Own&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;Joe Versus the Volcano&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;That Thing You Do&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;The Da Vinci Code&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;Cloud Atlas&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;Cast Away&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;Sleepless in Seattle&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#39;The Polar Express&#39;},
</span></span><span class="line"><span class="cl"> {&#39;tom.name&#39;: &#39;Tom Hanks&#39;, &#39;tomHanksMovies.title&#39;: &#34;Charlie Wilson&#39;s War&#34;}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">  MATCH (tom:Person {name:&#34;Tom Hanks&#34;})-[:ACTED_IN]-&gt;(m)&lt;-[:ACTED_IN]-(coActors) 
</span></span><span class="line"><span class="cl">  RETURN coActors.name, m.title
</span></span><span class="line"><span class="cl">  &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;coActors.name&#39;: &#39;Ed Harris&#39;, &#39;m.title&#39;: &#39;Apollo 13&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Gary Sinise&#39;, &#39;m.title&#39;: &#39;Apollo 13&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Kevin Bacon&#39;, &#39;m.title&#39;: &#39;Apollo 13&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Bill Paxton&#39;, &#39;m.title&#39;: &#39;Apollo 13&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Parker Posey&#39;, &#39;m.title&#39;: &#34;You&#39;ve Got Mail&#34;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Greg Kinnear&#39;, &#39;m.title&#39;: &#34;You&#39;ve Got Mail&#34;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Meg Ryan&#39;, &#39;m.title&#39;: &#34;You&#39;ve Got Mail&#34;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Steve Zahn&#39;, &#39;m.title&#39;: &#34;You&#39;ve Got Mail&#34;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Dave Chappelle&#39;, &#39;m.title&#39;: &#34;You&#39;ve Got Mail&#34;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Madonna&#39;, &#39;m.title&#39;: &#39;A League of Their Own&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#34;Rosie O&#39;Donnell&#34;, &#39;m.title&#39;: &#39;A League of Their Own&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Geena Davis&#39;, &#39;m.title&#39;: &#39;A League of Their Own&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Bill Paxton&#39;, &#39;m.title&#39;: &#39;A League of Their Own&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Lori Petty&#39;, &#39;m.title&#39;: &#39;A League of Their Own&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Nathan Lane&#39;, &#39;m.title&#39;: &#39;Joe Versus the Volcano&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Meg Ryan&#39;, &#39;m.title&#39;: &#39;Joe Versus the Volcano&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Liv Tyler&#39;, &#39;m.title&#39;: &#39;That Thing You Do&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Charlize Theron&#39;, &#39;m.title&#39;: &#39;That Thing You Do&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Ian McKellen&#39;, &#39;m.title&#39;: &#39;The Da Vinci Code&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Audrey Tautou&#39;, &#39;m.title&#39;: &#39;The Da Vinci Code&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Paul Bettany&#39;, &#39;m.title&#39;: &#39;The Da Vinci Code&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Jim Broadbent&#39;, &#39;m.title&#39;: &#39;Cloud Atlas&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Halle Berry&#39;, &#39;m.title&#39;: &#39;Cloud Atlas&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Hugo Weaving&#39;, &#39;m.title&#39;: &#39;Cloud Atlas&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Helen Hunt&#39;, &#39;m.title&#39;: &#39;Cast Away&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Sam Rockwell&#39;, &#39;m.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Bonnie Hunt&#39;, &#39;m.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Patricia Clarkson&#39;, &#39;m.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;James Cromwell&#39;, &#39;m.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Michael Clarke Duncan&#39;, &#39;m.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;David Morse&#39;, &#39;m.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Gary Sinise&#39;, &#39;m.title&#39;: &#39;The Green Mile&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Meg Ryan&#39;, &#39;m.title&#39;: &#39;Sleepless in Seattle&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Victor Garber&#39;, &#39;m.title&#39;: &#39;Sleepless in Seattle&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Bill Pullman&#39;, &#39;m.title&#39;: &#39;Sleepless in Seattle&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Rita Wilson&#39;, &#39;m.title&#39;: &#39;Sleepless in Seattle&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#34;Rosie O&#39;Donnell&#34;, &#39;m.title&#39;: &#39;Sleepless in Seattle&#39;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Julia Roberts&#39;, &#39;m.title&#39;: &#34;Charlie Wilson&#39;s War&#34;},
</span></span><span class="line"><span class="cl"> {&#39;coActors.name&#39;: &#39;Philip Seymour Hoffman&#39;,
</span></span><span class="line"><span class="cl">  &#39;m.title&#39;: &#34;Charlie Wilson&#39;s War&#34;}]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="delete-data-from-the-graph">Delete data from the graph<a hidden class="anchor" aria-hidden="true" href="#delete-data-from-the-graph">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">MATCH (emil:Person {name:&#34;Emil Eifrem&#34;})-[actedIn:ACTED_IN]-&gt;(movie:Movie)
</span></span><span class="line"><span class="cl">RETURN emil.name, movie.title
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;emil.name&#39;: &#39;Emil Eifrem&#39;, &#39;movie.title&#39;: &#39;The Matrix&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">MATCH (emil:Person {name:&#34;Emil Eifrem&#34;})-[actedIn:ACTED_IN]-&gt;(movie:Movie)
</span></span><span class="line"><span class="cl">DELETE actedIn
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[]
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="adding-data-to-the-graph">Adding data to the graph<a hidden class="anchor" aria-hidden="true" href="#adding-data-to-the-graph">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">CREATE (andreas:Person {name:&#34;Andreas&#34;})
</span></span><span class="line"><span class="cl">RETURN andreas
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;andreas&#39;: {&#39;name&#39;: &#39;Andreas&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cypher = &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">MATCH (andreas:Person {name:&#34;Andreas&#34;}), (emil:Person {name:&#34;Emil Eifrem&#34;})
</span></span><span class="line"><span class="cl">MERGE (andreas)-[hasRelationship:WORKS_WITH]-&gt;(emil)
</span></span><span class="line"><span class="cl">RETURN andreas, hasRelationship, emil
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">result = kg.query(cypher)
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;andreas&#39;: {&#39;name&#39;: &#39;Andreas&#39;},
</span></span><span class="line"><span class="cl">  &#39;hasRelationship&#39;: ({&#39;name&#39;: &#39;Andreas&#39;},
</span></span><span class="line"><span class="cl">   &#39;WORKS_WITH&#39;,
</span></span><span class="line"><span class="cl">   {&#39;born&#39;: 1978, &#39;name&#39;: &#39;Emil Eifrem&#39;}),
</span></span><span class="line"><span class="cl">  &#39;emil&#39;: {&#39;born&#39;: 1978, &#39;name&#39;: &#39;Emil Eifrem&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lesson-3-preparing-text-data-for-rag">Lesson 3: Preparing Text Data for RAG<a hidden class="anchor" aria-hidden="true" href="#lesson-3-preparing-text-data-for-rag">#</a></h2>
<h3 id="prerequisites-genai-integrations">Prerequisites: GenAI integrations<a hidden class="anchor" aria-hidden="true" href="#prerequisites-genai-integrations">#</a></h3>
<p>Introduced in 5.17.</p>
<p>Neo4j‚Äôs <a href="https://neo4j.com/docs/cypher-manual/5/indexes/semantic-indexes/vector-indexes/">Vector indexes</a> and <a href="https://neo4j.com/docs/cypher-manual/5/functions/vector/">Vector functions</a> allow you to calculate the similarity between node and relationship properties in a graph. A prerequisite for using these features is that vector embeddings have been set as properties of these entities. The GenAI plugin enables the creation of such embeddings using GenAI providers.</p>
<p>To use the GenAI plugin you need an account and API credentials from any of the following GenAI providers: <a href="https://neo4j.com/docs/cypher-manual/5/genai-integrations/?_gl=1*izws68*_ga*NTI1NjUwODcxLjE3NDY4NDMwMDQ.*_ga_DZP8Z65KK4*czE3NDcxMDYxNDEkbzMkZzEkdDE3NDcxMDYxNTQkajAkbDAkaDA.#vertex-ai">Vertex AI</a>, <a href="https://neo4j.com/docs/cypher-manual/5/genai-integrations/?_gl=1*izws68*_ga*NTI1NjUwODcxLjE3NDY4NDMwMDQ.*_ga_DZP8Z65KK4*czE3NDcxMDYxNDEkbzMkZzEkdDE3NDcxMDYxNTQkajAkbDAkaDA.#openai">OpenAI</a>, <a href="https://neo4j.com/docs/cypher-manual/5/genai-integrations/?_gl=1*izws68*_ga*NTI1NjUwODcxLjE3NDY4NDMwMDQ.*_ga_DZP8Z65KK4*czE3NDcxMDYxNDEkbzMkZzEkdDE3NDcxMDYxNTQkajAkbDAkaDA.#azure-openai">Azure OpenAI</a>, and <a href="https://neo4j.com/docs/cypher-manual/5/genai-integrations/?_gl=1*izws68*_ga*NTI1NjUwODcxLjE3NDY4NDMwMDQ.*_ga_DZP8Z65KK4*czE3NDcxMDYxNDEkbzMkZzEkdDE3NDcxMDYxNTQkajAkbDAkaDA.#amazon-bedrock">Amazon Bedrock</a>.</p>
<p>To learn more about using embeddings in Neo4j, see <a href="https://neo4j.com/docs/cypher-manual/5/indexes/semantic-indexes/vector-indexes/#embeddings">Vector indexes ‚Üí Vectors and embeddings in Neo4j</a>.</p>
<p>For a hands-on guide on how to use the GenAI plugin, see <a href="https://neo4j.com/docs/genai/tutorials/embeddings-vector-indexes/">GenAI documentation - Embeddings &amp; Vector Indexes Tutorial ‚Üí Create embeddings with cloud AI providers</a>.</p>
<p>The GenAI plugin is enabled by default in Neo4j Aura.</p>
<p>The plugin needs to be installed on self-managed instances. This is done by moving the <code>neo4j-genai.jar</code> file from <code>/products</code> to <code>/plugins</code> in the Neo4j home directory, or, if you are using Docker, by starting the Docker container with the extra parameter <code>--env NEO4J_PLUGINS='[&quot;genai&quot;]'</code>. For more information, see <a href="https://neo4j.com/docs/operations-manual/current/configuration/plugins/">Operations Manual ‚Üí Configure plugins</a>.</p>
<blockquote>
<p>Prior to Neo4j 5.23, the GenAI plugin was only available on Neo4j Enterprise Edition.</p></blockquote>
<p>The  code offered by this course is not working well in my local machine. There will an error about genai when we run the same code. Solution is referred in <a href="https://community.deeplearning.ai/t/message-failed-to-invoke-function-genai-vector-encode-caused-by-com-neo4j-genai-util-genaiprocedureexception-not-authorized-to-make-api-request-check-your-credentials/674046">Message: Failed to invoke function <code>genai.vector.encode</code>: Caused by: com.neo4j.genai.util.GenAIProcedureException: Not authorized to make API request; check your credentials</a>.</p>
<h3 id="import-packages-and-set-up-neo4j-1">Import packages and set up Neo4j<a hidden class="anchor" aria-hidden="true" href="#import-packages-and-set-up-neo4j-1">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Note the code below is unique to this course environment, and not a </span>
</span></span><span class="line"><span class="cl"><span class="c1"># standard part of Neo4j&#39;s integration with OpenAI. Remove if running </span>
</span></span><span class="line"><span class="cl"><span class="c1"># in your own environment.</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_ENDPOINT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/embeddings&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Connect to the knowledge graph instance using LangChain</span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="create-a-vector-index">Create a vector index<a hidden class="anchor" aria-hidden="true" href="#create-a-vector-index">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CREATE VECTOR INDEX movie_tagline_embeddings IF NOT EXISTS
</span></span></span><span class="line"><span class="cl"><span class="s2">  FOR (m:Movie) ON (m.taglineEmbedding) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  OPTIONS { indexConfig: {
</span></span></span><span class="line"><span class="cl"><span class="s2">    `vector.dimensions`: 1536,
</span></span></span><span class="line"><span class="cl"><span class="s2">    `vector.similarity_function`: &#39;cosine&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">  }}&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vector_index</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  SHOW VECTOR INDEXES
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">vector_index</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[]
</span></span><span class="line"><span class="cl">[{&#39;id&#39;: 3, &#39;name&#39;: &#39;movie_tagline_embeddings&#39;, &#39;state&#39;: &#39;POPULATING&#39;, &#39;populationPercent&#39;: 0.0, &#39;type&#39;: &#39;VECTOR&#39;, &#39;entityType&#39;: &#39;NODE&#39;, &#39;labelsOrTypes&#39;: [&#39;Movie&#39;], &#39;properties&#39;: [&#39;taglineEmbedding&#39;], &#39;indexProvider&#39;: &#39;vector-2.0&#39;, &#39;owningConstraint&#39;: None, &#39;lastRead&#39;: None, &#39;readCount&#39;: None}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="populate-the-vector-index">Populate the vector index<a hidden class="anchor" aria-hidden="true" href="#populate-the-vector-index">#</a></h3>
<ul>
<li>Calculate vector representation for each movie tagline using OpenAI</li>
<li>Add vector to the <code>Movie</code> node as <code>taglineEmbedding</code> property</li>
</ul>
<p><strong>Here is the updated version of the code:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">neo4j</span> <span class="kn">import</span> <span class="n">GraphDatabase</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËØªÂèñËá™ÂÆö‰πâurl</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñOpenAIÂµåÂÖ•Ê®°Âûã</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËøûÊé•Neo4j</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">driver</span> <span class="o">=</span> <span class="n">GraphDatabase</span><span class="o">.</span><span class="n">driver</span><span class="p">(</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">NEO4J_PASSWORD</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÆö‰πâËé∑ÂèñÂêëÈáèÁöÑÂáΩÊï∞</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ËØ¢Êú™ËÆæÁΩÆembeddingÁöÑÁîµÂΩ±ËäÇÁÇπ</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">driver</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        MATCH (m:Movie)
</span></span></span><span class="line"><span class="cl"><span class="s2">        WHERE m.tagline IS NOT NULL AND m.taglineEmbedding IS NULL
</span></span></span><span class="line"><span class="cl"><span class="s2">        RETURN id(m) AS id, m.tagline AS tagline
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">node_id</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">tagline</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;tagline&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">vector</span> <span class="o">=</span> <span class="n">get_embedding</span><span class="p">(</span><span class="n">tagline</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Êõ¥Êñ∞ËäÇÁÇπÂ≠òÂÇ®ÂêëÈáè</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                MATCH (m) WHERE id(m) = $id
</span></span></span><span class="line"><span class="cl"><span class="s2">                SET m.taglineEmbedding = $vector
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;&#34;&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span> <span class="s2">&#34;vector&#34;</span><span class="p">:</span> <span class="n">vector</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±ID </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> ÁöÑÂêëÈáè„ÄÇ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Â§ÑÁêÜÁîµÂΩ±ID </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> Êó∂Âá∫ÈîôÔºö</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÊâÄÊúâÁîµÂΩ±Ê†áÁ≠æÁöÑÂêëÈáèÂ∑≤Êõ¥Êñ∞ÂÆåÊØï„ÄÇ&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">LangChainDeprecationWarning</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">`</span><span class="n">OpenAIEmbeddings</span><span class="o">`</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LangChain</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">9</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain</span><span class="o">-</span><span class="n">openai</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">instead</span><span class="p">.</span><span class="w"> </span><span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">`</span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain</span><span class="o">-</span><span class="n">openai</span><span class="o">`</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">from</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain_openai</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">OpenAIEmbeddings</span><span class="o">``</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">embedding_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">OpenAIEmbeddings</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">107</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n        MATCH (m:Movie)\n        WHERE m.tagline IS NOT NULL AND m.taglineEmbedding IS NULL\n        RETURN id(m) AS id, m.tagline AS tagline\n    &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">19</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">33</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">41</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">66</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">71</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">77</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">82</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">89</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">91</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">96</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">99</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">101</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">104</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">109</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">115</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">120</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">125</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">132</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">134</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">141</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">145</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">148</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">151</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">154</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">156</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">161</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">163</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">165</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊàêÂäüÊõ¥Êñ∞ÁîµÂΩ±</span><span class="n">ID</span><span class="w"> </span><span class="mi">166</span><span class="w"> </span><span class="err">ÁöÑÂêëÈáè„ÄÇ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n                MATCH (m) WHERE id(m) = $id\n                SET m.taglineEmbedding = $vector\n            &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">ÊâÄÊúâÁîµÂΩ±Ê†áÁ≠æÁöÑÂêëÈáèÂ∑≤Êõ¥Êñ∞ÂÆåÊØï„ÄÇ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Get information about tagline. We can use the code as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËØªÂèñËá™ÂÆö‰πâurl</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñOpenAIÂµåÂÖ•Ê®°Âûã</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËøûÊé•Neo4j</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Connect to the knowledge graph instance using LangChain</span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (m:Movie) 
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE m.tagline IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN m.tagline, m.taglineEmbedding
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;m.tagline&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;m.taglineEmbedding&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;m.taglineEmbedding&#39;</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Welcome to the Real World
</span></span><span class="line"><span class="cl">[0.017445066977872476, -0.00548189274175866, -0.0020135224370537784, -0.025571243887471496, -0.014404304353743229, 0.01673730279797421, -0.017078077453982578, 0.00048535884802129926, -0.02521736179752236, -0.029516371024739575]
</span></span><span class="line"><span class="cl">1536
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>The previous version of the code is as follows</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Note the code below is unique to this course environment, and not a</span>
</span></span><span class="line"><span class="cl"><span class="c1"># standard part of Neo4j&#39;s integration with OpenAI. Remove if running</span>
</span></span><span class="line"><span class="cl"><span class="c1"># in your own environment.</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_ENDPOINT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/embeddings&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Connect to the knowledge graph instance using LangChain</span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (movie:Movie) WHERE movie.tagline IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s2">    WITH movie, genai.vector.encode(
</span></span></span><span class="line"><span class="cl"><span class="s2">        movie.tagline, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;OpenAI&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        {
</span></span></span><span class="line"><span class="cl"><span class="s2">          token: $openAiApiKey,
</span></span></span><span class="line"><span class="cl"><span class="s2">          endpoint: $openAiEndpoint
</span></span></span><span class="line"><span class="cl"><span class="s2">        }) AS vector
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL db.create.setNodeVectorProperty(movie, &#34;taglineEmbedding&#34;, vector)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;openAiApiKey&#34;</span><span class="p">:</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="s2">&#34;openAiEndpoint&#34;</span><span class="p">:</span> <span class="n">OPENAI_ENDPOINT</span><span class="p">}</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (m:Movie) 
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE m.tagline IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN m.tagline, m.taglineEmbedding
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;m.tagline&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;m.taglineEmbedding&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;m.taglineEmbedding&#39;</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#39;Welcome to the Real World&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[0.017427725717425346,
</span></span><span class="line"><span class="cl"> -0.005441250279545784,
</span></span><span class="line"><span class="cl"> -0.0020343265496194363,
</span></span><span class="line"><span class="cl"> -0.02555192820727825,
</span></span><span class="line"><span class="cl"> -0.014335286803543568,
</span></span><span class="line"><span class="cl"> 0.016746340319514275,
</span></span><span class="line"><span class="cl"> -0.01711324043571949,
</span></span><span class="line"><span class="cl"> 0.0005196377751417458,
</span></span><span class="line"><span class="cl"> -0.025263650342822075,
</span></span><span class="line"><span class="cl"> -0.029509201645851135]
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 1536
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="similarity-search">Similarity search<a hidden class="anchor" aria-hidden="true" href="#similarity-search">#</a></h3>
<ul>
<li>Calculate embedding for question</li>
<li>Identify matching movies based on similarity of question and <code>taglineEmbedding</code> vectors</li>
</ul>
<p><strong>Here is the updated version of the code:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ËøûÊé• Neo4j</span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">vector_search</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 1: ËÆ°ÁÆóÈóÆÈ¢òÁöÑÂêëÈáè</span>
</span></span><span class="line"><span class="cl">    <span class="n">question_embedding</span> <span class="o">=</span> <span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 2: Âú®Neo4jÂÅöÂêëÈáèÁõ∏‰ººÂ∫¶ÊêúÁ¥¢</span>
</span></span><span class="line"><span class="cl">    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL db.index.vector.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#39;movie_tagline_embeddings&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s2">        $top_k,
</span></span></span><span class="line"><span class="cl"><span class="s2">        $question_embedding
</span></span></span><span class="line"><span class="cl"><span class="s2">    ) YIELD node AS movie, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN movie.title AS title, movie.tagline AS tagline, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY score DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT $top_k
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">cypher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;top_k&#34;</span><span class="p">:</span> <span class="n">top_k</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;question_embedding&#34;</span><span class="p">:</span> <span class="n">question_embedding</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊµãËØïÈóÆÁ≠î</span>
</span></span><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;What movies are about love?&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">results</span> <span class="o">=</span> <span class="n">vector_search</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> results for question: </span><span class="si">{</span><span class="n">question</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">record</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. Title: </span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;   Tagline: </span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;tagline&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;   Score: </span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Top 5 results for question: What movies are about love?
</span></span><span class="line"><span class="cl">1. Title: Joe Versus the Volcano
</span></span><span class="line"><span class="cl">   Tagline: A story of love, lava and burning desire.
</span></span><span class="line"><span class="cl">   Score: 0.9008
</span></span><span class="line"><span class="cl">2. Title: As Good as It Gets
</span></span><span class="line"><span class="cl">   Tagline: A comedy from the heart that goes for the throat.
</span></span><span class="line"><span class="cl">   Score: 0.8963
</span></span><span class="line"><span class="cl">3. Title: Snow Falling on Cedars
</span></span><span class="line"><span class="cl">   Tagline: First loves last. Forever.
</span></span><span class="line"><span class="cl">   Score: 0.8947
</span></span><span class="line"><span class="cl">4. Title: When Harry Met Sally
</span></span><span class="line"><span class="cl">   Tagline: Can two friends sleep together and still love each other in the morning?
</span></span><span class="line"><span class="cl">   Score: 0.8894
</span></span><span class="line"><span class="cl">5. Title: Sleepless in Seattle
</span></span><span class="line"><span class="cl">   Tagline: What if someone you never met, someone you never saw, someone you never knew was the only someone for you?
</span></span><span class="line"><span class="cl">   Score: 0.8882
</span></span></code></pre></td></tr></table>
</div>
</div><p>Some warning are as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">LangChainDeprecationWarning</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">`</span><span class="n">OpenAIEmbeddings</span><span class="o">`</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LangChain</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">9</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain</span><span class="o">-</span><span class="n">openai</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">instead</span><span class="p">.</span><span class="w"> </span><span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">`</span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain</span><span class="o">-</span><span class="n">openai</span><span class="o">`</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">from</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain_openai</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">OpenAIEmbeddings</span><span class="o">``</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">embedding_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">LangChainDeprecationWarning</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">`</span><span class="n">Neo4jGraph</span><span class="o">`</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LangChain</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">8</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain</span><span class="o">-</span><span class="n">neo4j</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">instead</span><span class="p">.</span><span class="w"> </span><span class="k">To</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">`</span><span class="n">pip</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">U</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain</span><span class="o">-</span><span class="n">neo4j</span><span class="o">`</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">`</span><span class="k">from</span><span class="w"> </span><span class="p">:</span><span class="n">class</span><span class="p">:</span><span class="o">`~</span><span class="n">langchain_neo4j</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">Neo4jGraph</span><span class="o">``</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">kg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Neo4jGraph</span><span class="p">(</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>The previous version of the code is as follows</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;What movies are about love?&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    WITH genai.vector.encode(
</span></span></span><span class="line"><span class="cl"><span class="s2">        $question, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;OpenAI&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        {
</span></span></span><span class="line"><span class="cl"><span class="s2">          token: $openAiApiKey,
</span></span></span><span class="line"><span class="cl"><span class="s2">          endpoint: $openAiEndpoint
</span></span></span><span class="line"><span class="cl"><span class="s2">        }) AS question_embedding
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL db.index.vector.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#39;movie_tagline_embeddings&#39;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        $top_k, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        question_embedding
</span></span></span><span class="line"><span class="cl"><span class="s2">        ) YIELD node AS movie, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN movie.title, movie.tagline, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;openAiApiKey&#34;</span><span class="p">:</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;openAiEndpoint&#34;</span><span class="p">:</span> <span class="n">OPENAI_ENDPOINT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;top_k&#34;</span><span class="p">:</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;movie.title&#39;: &#39;Joe Versus the Volcano&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;A story of love, lava and burning desire.&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.9062923789024353},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;As Good as It Gets&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;A comedy from the heart that goes for the throat.&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.9022473096847534},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;Snow Falling on Cedars&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;First loves last. Forever.&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.9013161659240723},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;Sleepless in Seattle&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;What if someone you never met, someone you never saw, someone you never knew was the only someone for you?&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.8944727182388306},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;When Harry Met Sally&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;Can two friends sleep together and still love each other in the morning?&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.8942465782165527}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="try-for-yourself-ask-you-own-question">Try for yourself: ask you own question!<a hidden class="anchor" aria-hidden="true" href="#try-for-yourself-ask-you-own-question">#</a></h3>
<ul>
<li>Change the question below and run the graph query to find different movies</li>
</ul>
<p><strong>The previous version of the code is as follows</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;What movies are about adventure?&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    WITH genai.vector.encode(
</span></span></span><span class="line"><span class="cl"><span class="s2">        $question, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;OpenAI&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        {
</span></span></span><span class="line"><span class="cl"><span class="s2">          token: $openAiApiKey,
</span></span></span><span class="line"><span class="cl"><span class="s2">          endpoint: $openAiEndpoint
</span></span></span><span class="line"><span class="cl"><span class="s2">        }) AS question_embedding
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL db.index.vector.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#39;movie_tagline_embeddings&#39;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        $top_k, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        question_embedding
</span></span></span><span class="line"><span class="cl"><span class="s2">        ) YIELD node AS movie, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN movie.title, movie.tagline, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;openAiApiKey&#34;</span><span class="p">:</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;openAiEndpoint&#34;</span><span class="p">:</span> <span class="n">OPENAI_ENDPOINT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;top_k&#34;</span><span class="p">:</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;movie.title&#39;: &#39;RescueDawn&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#34;Based on the extraordinary true story of one man&#39;s fight for freedom&#34;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.8998302221298218},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;Cast Away&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;At the edge of the world, his journey begins.&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.8985401391983032},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;Ninja Assassin&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;Prepare to enter a secret world of assassins&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.8879814147949219},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;Joe Versus the Volcano&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;A story of love, lava and burning desire.&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.8870342969894409},
</span></span><span class="line"><span class="cl"> {&#39;movie.title&#39;: &#39;As Good as It Gets&#39;,
</span></span><span class="line"><span class="cl">  &#39;movie.tagline&#39;: &#39;A comedy from the heart that goes for the throat.&#39;,
</span></span><span class="line"><span class="cl">  &#39;score&#39;: 0.8855679035186768}]
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lesson-4-constructing-a-knowledge-graph-from-text-documents">Lesson 4: Constructing a Knowledge Graph from Text Documents<a hidden class="anchor" aria-hidden="true" href="#lesson-4-constructing-a-knowledge-graph-from-text-documents">#</a></h2>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/3eef6b6c594449838c4f35c1f66ac276.png"></p>
<p>Data cleaning procedure is as follows.</p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/d6d6856b636643229a4019f33cb799c2.png"></p>
<p>Main overview of lesson 4 is as follows.</p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/7e9f66f723584e08a5fa9940c96e03e9.png"></p>
<h3 id="import-packages-and-set-up-neo4j-2">Import packages and set up Neo4j<a hidden class="anchor" aria-hidden="true" href="#import-packages-and-set-up-neo4j-2">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neo4j&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Note the code below is unique to this course environment, and not a </span>
</span></span><span class="line"><span class="cl"><span class="c1"># standard part of Neo4j&#39;s integration with OpenAI. Remove if running </span>
</span></span><span class="line"><span class="cl"><span class="c1"># in your own environment.</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_ENDPOINT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/embeddings&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="take-a-look-at-a-form-10-k-json-file">Take a look at a Form 10-K json file<a hidden class="anchor" aria-hidden="true" href="#take-a-look-at-a-form-10-k-json-file">#</a></h3>
<ul>
<li>Publicly traded companies are required to fill a form 10-K each year with the Securities and Exchange Commision (SEC)</li>
<li>You can search these filings using the SEC‚Äôs <a href="https://www.sec.gov/edgar/search/">https://www.sec.gov/edgar/search/</a></li>
<li>For the next few lessons, you‚Äôll work with a single 10-K form for a company called <a href="https://www.netapp.com/">https://www.netapp.com/</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">first_file_name</span> <span class="o">=</span> <span class="s2">&#34;./data/form10k/0000950170-23-027948.json&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">first_file_as_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">first_file_name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">type</span><span class="p">(</span><span class="n">first_file_as_object</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">first_file_as_object</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">item1 &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">item1a &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">item7 &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">item7a &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">cik &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">cusip6 &lt;class &#39;str&#39;&gt;
</span></span><span class="line"><span class="cl">cusip &lt;class &#39;list&#39;&gt;
</span></span><span class="line"><span class="cl">names &lt;class &#39;list&#39;&gt;
</span></span><span class="line"><span class="cl">source &lt;class &#39;str&#39;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">item1_text</span> <span class="o">=</span> <span class="n">first_file_as_object</span><span class="p">[</span><span class="s1">&#39;item1&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">item1_text</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1500</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt;Item 1.  
</span></span><span class="line"><span class="cl">Business
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Overview
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NetApp, Inc. (NetApp, we, us or the Company) is a global cloud-led, data-centric software company. We were incorporated in 1992 and are headquartered in San Jose, California. Building on more than three decades of innovation, we give customers the freedom to manage applications and data across hybrid multicloud environments. Our portfolio of cloud services, and storage infrastructure, powered by intelligent data management software, enables applications to run faster, more reliably, and more securely, all at a lower cost.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Our opportunity is defined by the durable megatrends of data-driven digital and cloud transformations. NetApp helps organizations meet the complexities created by rapid data and cloud growth, multi-cloud management, and the adoption of next-generation technologies, such as AI, Kubernetes, and modern databases. Our modern approach to hybrid, multicloud infrastructure and data management, which we term ‚Äòevolved cloud‚Äô, provides customers the ability to leverage data across their entire estate with simplicity, security, and sustainability which increases our relevance and value to our customers.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In an evolved cloud state, the cloud is fully integrated into an organization‚Äôs architecture and operations. Data centers and clouds are seamlessly united and hybrid multicloud operations are simplified, with consistency and observability across environments. The key benefits NetApp brings to an organization‚Äôs hybrid multicloud envir
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="split-form-10-k-sections-into-chunks">Split Form 10-K sections into chunks<a hidden class="anchor" aria-hidden="true" href="#split-form-10-k-sections-into-chunks">#</a></h3>
<ul>
<li>Set up text splitter using LangChain</li>
<li>For now, split only the text from the ‚Äúitem 1‚Äù section</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neo4j&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Note the code below is unique to this course environment, and not a</span>
</span></span><span class="line"><span class="cl"><span class="c1"># standard part of Neo4j&#39;s integration with OpenAI. Remove if running</span>
</span></span><span class="line"><span class="cl"><span class="c1"># in your own environment.</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_ENDPOINT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/embeddings&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">first_file_name</span> <span class="o">=</span> <span class="s2">&#34;../data/form10k/0000950170-23-027948.json&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">first_file_as_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">first_file_name</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">item1_text</span> <span class="o">=</span> <span class="n">first_file_as_object</span><span class="p">[</span><span class="s1">&#39;item1&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">text_splitter</span> <span class="o">=</span> <span class="n">RecursiveCharacterTextSplitter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">chunk_overlap</span>  <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">length_function</span> <span class="o">=</span> <span class="nb">len</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_separator_regex</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">item1_text_chunks</span> <span class="o">=</span> <span class="n">text_splitter</span><span class="o">.</span><span class="n">split_text</span><span class="p">(</span><span class="n">item1_text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">item1_text_chunks</span><span class="p">))</span> <span class="c1"># list</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">item1_text_chunks</span><span class="p">))</span> <span class="c1"># 254</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">item1_text_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;class &#39;list&#39;&gt;
</span></span><span class="line"><span class="cl">254
</span></span><span class="line"><span class="cl">&gt;Item 1.  
</span></span><span class="line"><span class="cl">Business
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Overview
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NetApp, Inc. (NetApp, we, us or the Company) is a global cloud-led, data-centric software company. We were incorporated in 1992 and are headquartered in San Jose, California. Building on more than three decades of innovation, we give customers the freedom to manage applications and data across hybrid multicloud environments. Our portfolio of cloud services, and storage infrastructure, powered by intelligent data management software, enables applications to run faster, more reliably, and more securely, all at a lower cost.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Our opportunity is defined by the durable megatrends of data-driven digital and cloud transformations. NetApp helps organizations meet the complexities created by rapid data and cloud growth, multi-cloud management, and the adoption of next-generation technologies, such as AI, Kubernetes, and modern databases. Our modern approach to hybrid, multicloud infrastructure and data management, which we term ‚Äòevolved cloud‚Äô, provides customers the ability to leverage data across their entire estate with simplicity, security, and sustainability which increases our relevance and value to our customers.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">In an evolved cloud state, the cloud is fully integrated into an organization‚Äôs architecture and operations. Data centers and clouds are seamlessly united and hybrid multicloud operations are simplified, with consistency and observability across environments. The key benefits NetApp brings to an organization‚Äôs hybrid multicloud environment are:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">‚Ä¢
</span></span><span class="line"><span class="cl">Operational simplicity: NetApp‚Äôs use of open source, open architectures and APIs, microservices, and common capabilities and data services facilitate the creation of applications that can run anywhere.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">‚Ä¢
</span></span><span class="line"><span class="cl">Flexibility and consistency: NetApp makes moving data and applications between environments seamless through a common storage foundation across on-premises and multicloud environments.
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Set up a helper function to chunk all sections of the Form 10-K</li>
<li>You‚Äôll limit the number of chunks in each section to 20 to speed things up</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">split_form10k_data_from_file</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">chunks_with_metadata</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># use this to accumlate chunk records</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_as_object</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">))</span> <span class="c1"># open the json file</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;item1&#39;</span><span class="p">,</span><span class="s1">&#39;item1a&#39;</span><span class="p">,</span><span class="s1">&#39;item7&#39;</span><span class="p">,</span><span class="s1">&#39;item7a&#39;</span><span class="p">]:</span> <span class="c1"># pull these keys from the json</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1"> from </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="n">item_text</span> <span class="o">=</span> <span class="n">file_as_object</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="c1"># grab the text of the item</span>
</span></span><span class="line"><span class="cl">        <span class="n">item_text_chunks</span> <span class="o">=</span> <span class="n">text_splitter</span><span class="o">.</span><span class="n">split_text</span><span class="p">(</span><span class="n">item_text</span><span class="p">)</span> <span class="c1"># split the text into chunks</span>
</span></span><span class="line"><span class="cl">        <span class="n">chunk_seq_id</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">item_text_chunks</span><span class="p">[:</span><span class="mi">20</span><span class="p">]:</span> <span class="c1"># only take the first 20 chunks</span>
</span></span><span class="line"><span class="cl">            <span class="n">form_id</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">file</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span> <span class="c1"># extract form id from file name</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># finally, construct a record with metadata and the chunk text</span>
</span></span><span class="line"><span class="cl">            <span class="n">chunks_with_metadata</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="c1"># metadata from looping...</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;f10kItem&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;chunkSeqId&#39;</span><span class="p">:</span> <span class="n">chunk_seq_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># constructed metadata...</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;formId&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">form_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="c1"># pulled from the filename</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;chunkId&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">form_id</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s1">-chunk</span><span class="si">{</span><span class="n">chunk_seq_id</span><span class="si">:</span><span class="s1">04d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># metadata from file...</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">file_as_object</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;cik&#39;</span><span class="p">:</span> <span class="n">file_as_object</span><span class="p">[</span><span class="s1">&#39;cik&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;cusip6&#39;</span><span class="p">:</span> <span class="n">file_as_object</span><span class="p">[</span><span class="s1">&#39;cusip6&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="n">file_as_object</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="n">chunk_seq_id</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">Split into </span><span class="si">{</span><span class="n">chunk_seq_id</span><span class="si">}</span><span class="s1"> chunks&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">chunks_with_metadata</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">first_file_chunks</span> <span class="o">=</span> <span class="n">split_form10k_data_from_file</span><span class="p">(</span><span class="n">first_file_name</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Processing item1 from ../data/form10k/0000950170-23-027948.json
</span></span><span class="line"><span class="cl">	Split into 20 chunks
</span></span><span class="line"><span class="cl">Processing item1a from ../data/form10k/0000950170-23-027948.json
</span></span><span class="line"><span class="cl">	Split into 1 chunks
</span></span><span class="line"><span class="cl">Processing item7 from ../data/form10k/0000950170-23-027948.json
</span></span><span class="line"><span class="cl">	Split into 1 chunks
</span></span><span class="line"><span class="cl">Processing item7a from ../data/form10k/0000950170-23-027948.json
</span></span><span class="line"><span class="cl">	Split into 1 chunks
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">first_file_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;text&#39;: &#39;&gt;Item 1.  \nBusiness\n\n\nOverview\n\n\nNetApp, Inc. (NetApp, we, us or the Company) is a global cloud-led, data-centric software company. We were incorporated in 1992 and are headquartered in San Jose, California. Building on more than three decades of innovation, we give customers the freedom to manage applications and data across hybrid multicloud environments. Our portfolio of cloud services, and storage infrastructure, powered by intelligent data management software, enables applications to run faster, more reliably, and more securely, all at a lower cost.\n\n\nOur opportunity is defined by the durable megatrends of data-driven digital and cloud transformations. NetApp helps organizations meet the complexities created by rapid data and cloud growth, multi-cloud management, and the adoption of next-generation technologies, such as AI, Kubernetes, and modern databases. Our modern approach to hybrid, multicloud infrastructure and data management, which we term ‚Äòevolved cloud‚Äô, provides customers the ability to leverage data across their entire estate with simplicity, security, and sustainability which increases our relevance and value to our customers.\n\n\nIn an evolved cloud state, the cloud is fully integrated into an organization‚Äôs architecture and operations. Data centers and clouds are seamlessly united and hybrid multicloud operations are simplified, with consistency and observability across environments. The key benefits NetApp brings to an organization‚Äôs hybrid multicloud environment are:\n\n\n‚Ä¢\nOperational simplicity: NetApp‚Äôs use of open source, open architectures and APIs, microservices, and common capabilities and data services facilitate the creation of applications that can run anywhere.\n\n\n‚Ä¢\nFlexibility and consistency: NetApp makes moving data and applications between environments seamless through a common storage foundation across on-premises and multicloud environments.&#39;,
</span></span><span class="line"><span class="cl"> &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl"> &#39;chunkSeqId&#39;: 0,
</span></span><span class="line"><span class="cl"> &#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl"> &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl"> &#39;names&#39;: [&#39;Netapp Inc&#39;, &#39;NETAPP INC&#39;],
</span></span><span class="line"><span class="cl"> &#39;cik&#39;: &#39;1002047&#39;,
</span></span><span class="line"><span class="cl"> &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl"> &#39;source&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-graph-nodes-using-text-chunks">Create graph nodes using text chunks<a hidden class="anchor" aria-hidden="true" href="#create-graph-nodes-using-text-chunks">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">merge_chunk_node_query</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MERGE(mergedChunk:Chunk {chunkId: $chunkParam.chunkId})
</span></span></span><span class="line"><span class="cl"><span class="s2">    ON CREATE SET 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.names = $chunkParam.names,
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.formId = $chunkParam.formId, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.cik = $chunkParam.cik, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.cusip6 = $chunkParam.cusip6, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.source = $chunkParam.source, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.f10kItem = $chunkParam.f10kItem, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.chunkSeqId = $chunkParam.chunkSeqId, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mergedChunk.text = $chunkParam.text
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mergedChunk
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Set up connection to graph instance using LangChain</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create a single chunk node for now</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">merge_chunk_node_query</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkParam&#39;</span><span class="p">:</span><span class="n">first_file_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mergedChunk&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;names&#39;: [&#39;Netapp Inc&#39;, &#39;NETAPP INC&#39;],
</span></span><span class="line"><span class="cl">   &#39;cik&#39;: &#39;1002047&#39;,
</span></span><span class="line"><span class="cl">   &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl">   &#39;source&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;,
</span></span><span class="line"><span class="cl">   &#39;text&#39;: &#39;&gt;Item 1.  \nBusiness\n\n\nOverview\n\n\nNetApp, Inc. (NetApp, we, us or the Company) is a global cloud-led, data-centric software company. We were incorporated in 1992 and are headquartered in San Jose, California. Building on more than three decades of innovation, we give customers the freedom to manage applications and data across hybrid multicloud environments. Our portfolio of cloud services, and storage infrastructure, powered by intelligent data management software, enables applications to run faster, more reliably, and more securely, all at a lower cost.\n\n\nOur opportunity is defined by the durable megatrends of data-driven digital and cloud transformations. NetApp helps organizations meet the complexities created by rapid data and cloud growth, multi-cloud management, and the adoption of next-generation technologies, such as AI, Kubernetes, and modern databases. Our modern approach to hybrid, multicloud infrastructure and data management, which we term ‚Äòevolved cloud‚Äô, provides customers the ability to leverage data across their entire estate with simplicity, security, and sustainability which increases our relevance and value to our customers.\n\n\nIn an evolved cloud state, the cloud is fully integrated into an organization‚Äôs architecture and operations. Data centers and clouds are seamlessly united and hybrid multicloud operations are simplified, with consistency and observability across environments. The key benefits NetApp brings to an organization‚Äôs hybrid multicloud environment are:\n\n\n‚Ä¢\nOperational simplicity: NetApp‚Äôs use of open source, open architectures and APIs, microservices, and common capabilities and data services facilitate the creation of applications that can run anywhere.\n\n\n‚Ä¢\nFlexibility and consistency: NetApp makes moving data and applications between environments seamless through a common storage foundation across on-premises and multicloud environments.&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 0}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create a uniqueness constraint to avoid duplicate chunks</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE CONSTRAINT unique_chunk IF NOT EXISTS 
</span></span></span><span class="line"><span class="cl"><span class="s2">    FOR (c:Chunk) REQUIRE c.chunkId IS UNIQUE
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;SHOW INDEXES&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;id&#39;: 1,
</span></span><span class="line"><span class="cl">  &#39;name&#39;: &#39;index_343aff4e&#39;,
</span></span><span class="line"><span class="cl">  &#39;state&#39;: &#39;ONLINE&#39;,
</span></span><span class="line"><span class="cl">  &#39;populationPercent&#39;: 100.0,
</span></span><span class="line"><span class="cl">  &#39;type&#39;: &#39;LOOKUP&#39;,
</span></span><span class="line"><span class="cl">  &#39;entityType&#39;: &#39;NODE&#39;,
</span></span><span class="line"><span class="cl">  &#39;labelsOrTypes&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;properties&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;indexProvider&#39;: &#39;token-lookup-1.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;owningConstraint&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;lastRead&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;readCount&#39;: 0},
</span></span><span class="line"><span class="cl"> {&#39;id&#39;: 2,
</span></span><span class="line"><span class="cl">  &#39;name&#39;: &#39;index_f7700477&#39;,
</span></span><span class="line"><span class="cl">  &#39;state&#39;: &#39;ONLINE&#39;,
</span></span><span class="line"><span class="cl">  &#39;populationPercent&#39;: 100.0,
</span></span><span class="line"><span class="cl">  &#39;type&#39;: &#39;LOOKUP&#39;,
</span></span><span class="line"><span class="cl">  &#39;entityType&#39;: &#39;RELATIONSHIP&#39;,
</span></span><span class="line"><span class="cl">  &#39;labelsOrTypes&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;properties&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;indexProvider&#39;: &#39;token-lookup-1.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;owningConstraint&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;lastRead&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;readCount&#39;: 0},
</span></span><span class="line"><span class="cl"> {&#39;id&#39;: 3,
</span></span><span class="line"><span class="cl">  &#39;name&#39;: &#39;unique_chunk&#39;,
</span></span><span class="line"><span class="cl">  &#39;state&#39;: &#39;ONLINE&#39;,
</span></span><span class="line"><span class="cl">  &#39;populationPercent&#39;: 100.0,
</span></span><span class="line"><span class="cl">  &#39;type&#39;: &#39;RANGE&#39;,
</span></span><span class="line"><span class="cl">  &#39;entityType&#39;: &#39;NODE&#39;,
</span></span><span class="line"><span class="cl">  &#39;labelsOrTypes&#39;: [&#39;Chunk&#39;],
</span></span><span class="line"><span class="cl">  &#39;properties&#39;: [&#39;chunkId&#39;],
</span></span><span class="line"><span class="cl">  &#39;indexProvider&#39;: &#39;range-1.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;owningConstraint&#39;: &#39;unique_chunk&#39;,
</span></span><span class="line"><span class="cl">  &#39;lastRead&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;readCount&#39;: None}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Loop through and create nodes for all chunks</li>
<li>Should create 23 nodes because you set a limit of 20 chunks in the text splitting function above</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">node_count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">first_file_chunks</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Creating `:Chunk` node for chunk ID </span><span class="si">{</span><span class="n">chunk</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">merge_chunk_node_query</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;chunkParam&#39;</span><span class="p">:</span> <span class="n">chunk</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Created </span><span class="si">{</span><span class="n">node_count</span><span class="si">}</span><span class="s2"> nodes&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0000
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0001
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0002
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0003
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0004
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0005
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0006
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0007
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0008
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0009
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0010
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0011
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0012
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0013
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0014
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0015
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0016
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0017
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0018
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1-chunk0019
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item1a-chunk0000
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item7-chunk0000
</span></span><span class="line"><span class="cl">Creating `:Chunk` node for chunk ID 0000950170-23-027948-item7a-chunk0000
</span></span><span class="line"><span class="cl">Created 23 nodes
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">         MATCH (n)
</span></span></span><span class="line"><span class="cl"><span class="s2">         RETURN count(n) as nodeCount
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># [{&#39;nodeCount&#39;: 23}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-a-vector-index-1">Create a vector index<a hidden class="anchor" aria-hidden="true" href="#create-a-vector-index-1">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">         CREATE VECTOR INDEX `form_10k_chunks` IF NOT EXISTS
</span></span></span><span class="line"><span class="cl"><span class="s2">          FOR (c:Chunk) ON (c.textEmbedding) 
</span></span></span><span class="line"><span class="cl"><span class="s2">          OPTIONS { indexConfig: {
</span></span></span><span class="line"><span class="cl"><span class="s2">            `vector.dimensions`: 1536,
</span></span></span><span class="line"><span class="cl"><span class="s2">            `vector.similarity_function`: &#39;cosine&#39;    
</span></span></span><span class="line"><span class="cl"><span class="s2">         }}
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;SHOW INDEXES&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;id&#39;: 5,
</span></span><span class="line"><span class="cl">  &#39;name&#39;: &#39;form_10k_chunks&#39;,
</span></span><span class="line"><span class="cl">  &#39;state&#39;: &#39;POPULATING&#39;,
</span></span><span class="line"><span class="cl">  &#39;populationPercent&#39;: 0.0,
</span></span><span class="line"><span class="cl">  &#39;type&#39;: &#39;VECTOR&#39;,
</span></span><span class="line"><span class="cl">  &#39;entityType&#39;: &#39;NODE&#39;,
</span></span><span class="line"><span class="cl">  &#39;labelsOrTypes&#39;: [&#39;Chunk&#39;],
</span></span><span class="line"><span class="cl">  &#39;properties&#39;: [&#39;textEmbedding&#39;],
</span></span><span class="line"><span class="cl">  &#39;indexProvider&#39;: &#39;vector-1.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;owningConstraint&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;lastRead&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;readCount&#39;: None},
</span></span><span class="line"><span class="cl"> {&#39;id&#39;: 1,
</span></span><span class="line"><span class="cl">  &#39;name&#39;: &#39;index_343aff4e&#39;,
</span></span><span class="line"><span class="cl">  &#39;state&#39;: &#39;ONLINE&#39;,
</span></span><span class="line"><span class="cl">  &#39;populationPercent&#39;: 100.0,
</span></span><span class="line"><span class="cl">  &#39;type&#39;: &#39;LOOKUP&#39;,
</span></span><span class="line"><span class="cl">  &#39;entityType&#39;: &#39;NODE&#39;,
</span></span><span class="line"><span class="cl">  &#39;labelsOrTypes&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;properties&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;indexProvider&#39;: &#39;token-lookup-1.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;owningConstraint&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;lastRead&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;readCount&#39;: 0},
</span></span><span class="line"><span class="cl"> {&#39;id&#39;: 2,
</span></span><span class="line"><span class="cl">  &#39;name&#39;: &#39;index_f7700477&#39;,
</span></span><span class="line"><span class="cl">  &#39;state&#39;: &#39;ONLINE&#39;,
</span></span><span class="line"><span class="cl">  &#39;populationPercent&#39;: 100.0,
</span></span><span class="line"><span class="cl">  &#39;type&#39;: &#39;LOOKUP&#39;,
</span></span><span class="line"><span class="cl">  &#39;entityType&#39;: &#39;RELATIONSHIP&#39;,
</span></span><span class="line"><span class="cl">  &#39;labelsOrTypes&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;properties&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;indexProvider&#39;: &#39;token-lookup-1.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;owningConstraint&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;lastRead&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;readCount&#39;: 0},
</span></span><span class="line"><span class="cl"> {&#39;id&#39;: 3,
</span></span><span class="line"><span class="cl">  &#39;name&#39;: &#39;unique_chunk&#39;,
</span></span><span class="line"><span class="cl">  &#39;state&#39;: &#39;ONLINE&#39;,
</span></span><span class="line"><span class="cl">  &#39;populationPercent&#39;: 100.0,
</span></span><span class="line"><span class="cl">  &#39;type&#39;: &#39;RANGE&#39;,
</span></span><span class="line"><span class="cl">  &#39;entityType&#39;: &#39;NODE&#39;,
</span></span><span class="line"><span class="cl">  &#39;labelsOrTypes&#39;: [&#39;Chunk&#39;],
</span></span><span class="line"><span class="cl">  &#39;properties&#39;: [&#39;chunkId&#39;],
</span></span><span class="line"><span class="cl">  &#39;indexProvider&#39;: &#39;range-1.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;owningConstraint&#39;: &#39;unique_chunk&#39;,
</span></span><span class="line"><span class="cl">  &#39;lastRead&#39;: None,
</span></span><span class="line"><span class="cl">  &#39;readCount&#39;: None}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calculate-embedding-vectors-for-chunks-and-populate-index">Calculate embedding vectors for chunks and populate index<a hidden class="anchor" aria-hidden="true" href="#calculate-embedding-vectors-for-chunks-and-populate-index">#</a></h3>
<p>This query calculates the embedding vector and stores it as a property called <code>textEmbedding</code> on each <code>Chunk</code> node.</p>
<p><strong>Here is the previous version of the code:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (chunk:Chunk) WHERE chunk.textEmbedding IS NULL
</span></span></span><span class="line"><span class="cl"><span class="s2">    WITH chunk, genai.vector.encode(
</span></span></span><span class="line"><span class="cl"><span class="s2">      chunk.text, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      &#34;OpenAI&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      {
</span></span></span><span class="line"><span class="cl"><span class="s2">        token: $openAiApiKey, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        endpoint: $openAiEndpoint
</span></span></span><span class="line"><span class="cl"><span class="s2">      }) AS vector
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL db.create.setNodeVectorProperty(chunk, &#34;textEmbedding&#34;, vector)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;openAiApiKey&#34;</span><span class="p">:</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="s2">&#34;openAiEndpoint&#34;</span><span class="p">:</span> <span class="n">OPENAI_ENDPOINT</span><span class="p">}</span> <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The updated version code is as follows.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÆö‰πâËé∑ÂèñÂêëÈáèÁöÑÂáΩÊï∞</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">         MATCH (c:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">         WHERE c.textEmbedding IS NULL and c.text IS NOT NULL
</span></span></span><span class="line"><span class="cl"><span class="s2">         RETURN id(c) AS id, c.textEmbedding AS embedding, c.text AS text
</span></span></span><span class="line"><span class="cl"><span class="s2">     &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ËØ¢Êú™ËÆæÁΩÆembeddingÁöÑChunkËäÇÁÇπ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_id</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">vector</span> <span class="o">=</span> <span class="n">get_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Êõ¥Êñ∞ËäÇÁÇπÂ≠òÂÇ®ÂêëÈáè</span>
</span></span><span class="line"><span class="cl">        <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">            MATCH (c) WHERE id(c) = $id
</span></span></span><span class="line"><span class="cl"><span class="s2">            SET c.textEmbedding = $vector
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span> <span class="s2">&#34;vector&#34;</span><span class="p">:</span> <span class="n">vector</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;ÊàêÂäüÊõ¥Êñ∞Chunk ID </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> ÁöÑÂêëÈáè„ÄÇ&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Â§ÑÁêÜChunk ID </span><span class="si">{</span><span class="n">node_id</span><span class="si">}</span><span class="s2"> Êó∂Âá∫ÈîôÔºö</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;ÂÆåÊàêÂêëÈáèÊõ¥Êñ∞„ÄÇ&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">Received</span><span class="w"> </span><span class="n">notification</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">DBMS</span><span class="w"> </span><span class="n">server</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">severity</span><span class="p">:</span><span class="w"> </span><span class="n">WARNING</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">code</span><span class="p">:</span><span class="w"> </span><span class="n">Neo</span><span class="p">.</span><span class="n">ClientNotification</span><span class="p">.</span><span class="n">Statement</span><span class="p">.</span><span class="n">FeatureDeprecationWarning</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">category</span><span class="p">:</span><span class="w"> </span><span class="n">DEPRECATION</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="n">versions</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">description</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">deprecated</span><span class="w"> </span><span class="n">function</span><span class="p">:</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">.</span><span class="err">}</span><span class="w"> </span><span class="err">{</span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">line</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="k">column</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="n">offset</span><span class="p">:</span><span class="w"> </span><span class="mi">104</span><span class="err">}</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;\n         MATCH (c:Chunk)\n         WHERE c.textEmbedding IS NULL and c.text IS NOT NULL\n         RETURN id(c) AS id, c.textEmbedding AS embedding, c.text AS text\n     &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">[</span><span class="err">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">176</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;embedding&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&gt;Item 1.  \nBusiness\n\n\nOverview\n\n\nNetApp, 
</span></span></span><span class="line"><span class="cl"><span class="s1">......
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 176 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 177 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 178 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 179 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 180 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 181 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 182 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 183 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 184 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 185 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 186 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 187 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 188 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 189 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 190 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 191 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 192 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 193 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 194 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 195 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 196 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 197 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">Received notification from DBMS server: {severity: WARNING} {code: Neo.ClientNotification.Statement.FeatureDeprecationWarning} {category: DEPRECATION} {title: This feature is deprecated and will be removed in future versions.} {description: The query used a deprecated function: `id`.} {position: line: 2, column: 29, offset: 29} for query: &#39;</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="k">MATCH</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nf">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">id</span><span class="err">\</span><span class="n">n</span><span class="w">            </span><span class="kt">SET</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">textEmbedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">vector</span><span class="err">\</span><span class="n">n</span><span class="w">        </span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">ÊàêÂäüÊõ¥Êñ∞Chunk ID 198 ÁöÑÂêëÈáè„ÄÇ
</span></span></span><span class="line"><span class="cl"><span class="s1">ÂÆåÊàêÂêëÈáèÊõ¥Êñ∞„ÄÇ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Then execute the code below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">refresh_schema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Node properties:
</span></span><span class="line"><span class="cl">Chunk {textEmbedding: LIST, source: STRING, f10kItem: STRING, chunkSeqId: INTEGER, cik: STRING, cusip6: STRING, chunkId: STRING, text: STRING, names: LIST, formId: STRING}
</span></span><span class="line"><span class="cl">Relationship properties:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The relationships:
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="use-similarity-search-to-find-relevant-chunks">Use similarity search to find relevant chunks<a hidden class="anchor" aria-hidden="true" href="#use-similarity-search-to-find-relevant-chunks">#</a></h3>
<p>Setup a helper function to perform similarity search using the vector index.</p>
<p><strong>Here is the previous version of the code:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">neo4j_vector_search</span><span class="p">(</span><span class="n">question</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;&#34;&#34;Search for similar nodes using the Neo4j vector index&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">vector_search_query</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    WITH genai.vector.encode(
</span></span></span><span class="line"><span class="cl"><span class="s2">      $question, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      &#34;OpenAI&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      {
</span></span></span><span class="line"><span class="cl"><span class="s2">        token: $openAiApiKey,
</span></span></span><span class="line"><span class="cl"><span class="s2">        endpoint: $openAiEndpoint
</span></span></span><span class="line"><span class="cl"><span class="s2">      }) AS question_embedding
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL db.index.vector.queryNodes($index_name, $top_k, question_embedding) yield node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN score, node.text AS text
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">similar</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">vector_search_query</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                     <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;openAiApiKey&#39;</span><span class="p">:</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;openAiEndpoint&#39;</span><span class="p">:</span> <span class="n">OPENAI_ENDPOINT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;index_name&#39;</span><span class="p">:</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;top_k&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">similar</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ask a question!</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">search_results</span> <span class="o">=</span> <span class="n">neo4j_vector_search</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;In a single sentence, tell me about Netapp.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">search_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;score&#39;: 0.9358431696891785,
</span></span><span class="line"><span class="cl"> &#39;text&#39;: &#39;&gt;Item 1.  \nBusiness\n\n\nOverview\n\n\nNetApp, Inc. (NetApp, we, us or the Company) is a global cloud-led, data-centric software company. We were incorporated in 1992 and are headquartered in San Jose, California. Building on more than three decades of innovation, we give customers the freedom to manage applications and data across hybrid multicloud environments. Our portfolio of cloud services, and storage infrastructure, powered by intelligent data management software, enables applications to run faster, more reliably, and more securely, all at a lower cost.\n\n\nOur opportunity is defined by the durable megatrends of data-driven digital and cloud transformations. NetApp helps organizations meet the complexities created by rapid data and cloud growth, multi-cloud management, and the adoption of next-generation technologies, such as AI, Kubernetes, and modern databases. Our modern approach to hybrid, multicloud infrastructure and data management, which we term ‚Äòevolved cloud‚Äô, provides customers the ability to leverage data across their entire estate with simplicity, security, and sustainability which increases our relevance and value to our customers.\n\n\nIn an evolved cloud state, the cloud is fully integrated into an organization‚Äôs architecture and operations. Data centers and clouds are seamlessly united and hybrid multicloud operations are simplified, with consistency and observability across environments. The key benefits NetApp brings to an organization‚Äôs hybrid multicloud environment are:\n\n\n‚Ä¢\nOperational simplicity: NetApp‚Äôs use of open source, open architectures and APIs, microservices, and common capabilities and data services facilitate the creation of applications that can run anywhere.\n\n\n‚Ä¢\nFlexibility and consistency: NetApp makes moving data and applications between environments seamless through a common storage foundation across on-premises and multicloud environments.&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here is the updated version of the code above:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">vector_search</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 1: ËÆ°ÁÆóÈóÆÈ¢òÁöÑÂêëÈáè</span>
</span></span><span class="line"><span class="cl">    <span class="n">question_embedding</span> <span class="o">=</span> <span class="n">embedding_model</span><span class="o">.</span><span class="n">embed_query</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 2: Âú®Neo4jÂÅöÂêëÈáèÁõ∏‰ººÂ∫¶ÊêúÁ¥¢</span>
</span></span><span class="line"><span class="cl">    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL db.index.vector.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">        $index_name, $top_k, $question_embedding) yield node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN score, node.text AS text
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">cypher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;top_k&#34;</span><span class="p">:</span> <span class="n">top_k</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;question_embedding&#34;</span><span class="p">:</span> <span class="n">question_embedding</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;index_name&#39;</span><span class="p">:</span> <span class="n">VECTOR_INDEX_NAME</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s1">&#39;In a single sentence, tell me about Netapp.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">results</span> <span class="o">=</span> <span class="n">vector_search</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;score&#39;: 0.9298248291015625, &#39;text&#39;: &#39;&gt;Item 1.  \nBusiness\n\n\nOverview\n\n\nNetApp, Inc. (NetApp, we, us or the Company) is a global cloud-led, data-centric software company. We were incorporated in 1992 and are headquartered in San Jose, California. Building on more than three decades of innovation, we give customers the freedom to manage applications and data across hybrid multicloud environments. Our portfolio of cloud services, and storage infrastructure, powered by intelligent data management software, enables applications to run faster, more reliably, and more securely, all at a lower cost.\n\n\nOur opportunity is defined by the durable megatrends of data-driven digital and cloud transformations. NetApp helps organizations meet the complexities created by rapid data and cloud growth, multi-cloud management, and the adoption of next-generation technologies, such as AI, Kubernetes, and modern databases. Our modern approach to hybrid, multicloud infrastructure and data management, which we term ‚Äòevolved cloud‚Äô, provides customers the ability to leverage data across their entire estate with simplicity, security, and sustainability which increases our relevance and value to our customers.\n\n\nIn an evolved cloud state, the cloud is fully integrated into an organization‚Äôs architecture and operations. Data centers and clouds are seamlessly united and hybrid multicloud operations are simplified, with consistency and observability across environments. The key benefits NetApp brings to an organization‚Äôs hybrid multicloud environment are:\n\n\n‚Ä¢\nOperational simplicity: NetApp‚Äôs use of open source, open architectures and APIs, microservices, and common capabilities and data services facilitate the creation of applications that can run anywhere.\n\n\n‚Ä¢\nFlexibility and consistency: NetApp makes moving data and applications between environments seamless through a common storage foundation across on-premises and multicloud environments.&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="set-up-a-langchain-rag-workflow-to-chat-with-the-form">Set up a LangChain RAG workflow to chat with the form<a hidden class="anchor" aria-hidden="true" href="#set-up-a-langchain-rag-workflow-to-chat-with-the-form">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">neo4j_vector_store</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_graph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_label</span><span class="o">=</span><span class="n">VECTOR_NODE_LABEL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_properties</span><span class="o">=</span><span class="p">[</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding_node_property</span><span class="o">=</span><span class="n">VECTOR_EMBEDDING_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">retriever</span> <span class="o">=</span> <span class="n">neo4j_vector_store</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Set up a RetrievalQAWithSourcesChain to carry out question answering.</p>
<p>You can check out the LangChain documentation for this chain <a href="https://api.python.langchain.com/en/latest/chains/langchain.chains.qa%5C_with%5C_sources.retrieval.RetrievalQAWithSourcesChain.html">https://api.python.langchain.com/en/latest/chains/langchain.chains.qa_with_sources.retrieval.RetrievalQAWithSourcesChain.html</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">chain</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prettychain</span><span class="p">(</span><span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Pretty print the chain&#39;s response to a question&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">chain</span><span class="p">({</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">],</span> <span class="mi">60</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;What is Netapp&#39;s primary business?&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">prettychain</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NetApp&#39;s primary business is enterprise storage and data
</span></span><span class="line"><span class="cl">management, cloud storage, and cloud operations.
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettychain</span><span class="p">(</span><span class="s2">&#34;Where is Netapp headquartered?&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Netapp is headquartered in San Jose, California.
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettychain</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Tell me about Netapp. 
</span></span></span><span class="line"><span class="cl"><span class="s2">    Limit your answer to a single sentence.
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NetApp is a global cloud-led, data-centric software company
</span></span><span class="line"><span class="cl">that provides customers with the freedom to manage
</span></span><span class="line"><span class="cl">applications and data across hybrid multicloud environments.
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettychain</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Tell me about Apple. 
</span></span></span><span class="line"><span class="cl"><span class="s2">    Limit your answer to a single sentence.
</span></span></span><span class="line"><span class="cl"><span class="s2">    If you are unsure about the answer, say you don&#39;t know.
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">I don&#39;t know.
</span></span></code></pre></td></tr></table>
</div>
</div><p>The full version of the code is as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">neo4j_vector_store</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_graph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_label</span><span class="o">=</span><span class="n">VECTOR_NODE_LABEL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_properties</span><span class="o">=</span><span class="p">[</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding_node_property</span><span class="o">=</span><span class="n">VECTOR_EMBEDDING_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">retriever</span> <span class="o">=</span> <span class="n">neo4j_vector_store</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">chain</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prettychain</span><span class="p">(</span><span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Pretty print the chain&#39;s response to a question&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">chain</span><span class="p">({</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;answer&#39;</span><span class="p">],</span> <span class="mi">60</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;What is Netapp&#39;s primary business?&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">prettychain</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">prettychain</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Tell me about Apple. 
</span></span></span><span class="line"><span class="cl"><span class="s2">    Limit your answer to a single sentence.
</span></span></span><span class="line"><span class="cl"><span class="s2">    If you are unsure about the answer, say you don&#39;t know.
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NetApp&#39;s primary business is enterprise storage and data
</span></span><span class="line"><span class="cl">management, cloud storage, and cloud operations.
</span></span><span class="line"><span class="cl">I don&#39;t know.
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lesson-5-adding-relationships-to-the-sec-knowledge-graph">Lesson 5: Adding Relationships to the SEC Knowledge Graph<a hidden class="anchor" aria-hidden="true" href="#lesson-5-adding-relationships-to-the-sec-knowledge-graph">#</a></h2>
<h3 id="import-packages-and-set-up-neo4j-3">Import packages and set up Neo4j<a hidden class="anchor" aria-hidden="true" href="#import-packages-and-set-up-neo4j-3">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neo4j&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-a-form-10-k-node">Create a Form 10-K node<a hidden class="anchor" aria-hidden="true" href="#create-a-form-10-k-node">#</a></h3>
<ul>
<li>Create a node to represent the entire Form 10-K</li>
<li>Populate with metadata taken from a single chunk of the form</li>
</ul>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/79f63c85ce544850809c987dd3a4ed25.png"></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (anyChunk:Chunk) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH anyChunk LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN anyChunk { .names, .source, .formId, .cik, .cusip6 } as formInfo
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">form_info_list</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">form_info_list</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;formInfo&#39;: {&#39;cik&#39;: &#39;1002047&#39;,
</span></span><span class="line"><span class="cl">   &#39;source&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;,
</span></span><span class="line"><span class="cl">   &#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;names&#39;: [&#39;Netapp Inc&#39;, &#39;NETAPP INC&#39;],
</span></span><span class="line"><span class="cl">   &#39;cusip6&#39;: &#39;64110D&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">form_info</span> <span class="o">=</span> <span class="n">form_info_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;formInfo&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;cik&#39;: &#39;1002047&#39;,
</span></span><span class="line"><span class="cl"> &#39;source&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;,
</span></span><span class="line"><span class="cl"> &#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl"> &#39;names&#39;: [&#39;Netapp Inc&#39;, &#39;NETAPP INC&#39;],
</span></span><span class="line"><span class="cl"> &#39;cusip6&#39;: &#39;64110D&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (f:Form {formId: $formInfoParam.formId })
</span></span></span><span class="line"><span class="cl"><span class="s2">      ON CREATE 
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.names = $formInfoParam.names
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.source = $formInfoParam.source
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.cik = $formInfoParam.cik
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.cusip6 = $formInfoParam.cusip6
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formInfoParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;MATCH (f:Form) RETURN count(f) as formCount&#34;</span><span class="p">)</span> <span class="c1"># [{&#39;formCount&#39;: 1}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The full code is as list:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (anyChunk:Chunk) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH anyChunk LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN anyChunk { .names, .source, .formId, .cik, .cusip6 } as formInfo
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">form_info_list</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">form_info_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">form_info</span> <span class="o">=</span> <span class="n">form_info_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;formInfo&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (f:Form {formId: $formInfoParam.formId })
</span></span></span><span class="line"><span class="cl"><span class="s2">      ON CREATE 
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.names = $formInfoParam.names
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.source = $formInfoParam.source
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.cik = $formInfoParam.cik
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET f.cusip6 = $formInfoParam.cusip6
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formInfoParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;MATCH (f:Form) RETURN count(f) as formCount&#34;</span><span class="p">)</span> <span class="c1"># [{&#39;formCount&#39;: 1}]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;formInfo&#39;: {&#39;cik&#39;: &#39;1002047&#39;, &#39;source&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;, &#39;formId&#39;: &#39;0000950170-23-027948&#39;, &#39;names&#39;: [&#39;Netapp Inc&#39;, &#39;NETAPP INC&#39;], &#39;cusip6&#39;: &#39;64110D&#39;}}]
</span></span><span class="line"><span class="cl">[{&#39;formCount&#39;: 1}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-a-linked-list-of-chunk-nodes-for-each-section">Create a linked list of Chunk nodes for each section<a hidden class="anchor" aria-hidden="true" href="#create-a-linked-list-of-chunk-nodes-for-each-section">#</a></h3>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/659e3a315a654a48a6575d0f8142d39a.png"></p>
<ul>
<li>Start by identifying chunks from the same section</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (from_same_form:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE from_same_form.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN from_same_form {.formId, .f10kItem, .chunkId, .chunkSeqId } as chunkInfo
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 0}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0001&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 1}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0002&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 2}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0003&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 3}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0004&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 4}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0005&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 5}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0006&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 6}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0007&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 7}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0008&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 8}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0009&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 9}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Order chunks by their sequence ID</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (from_same_form:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE from_same_form.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN from_same_form {.formId, .f10kItem, .chunkId, .chunkSeqId } as chunkInfo 
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY from_same_form.chunkSeqId ASC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item7a&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item7a-chunk0000&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 0}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item7&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item7-chunk0000&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 0}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1a&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1a-chunk0000&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 0}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 0}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0001&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 1}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0002&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 2}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0003&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 3}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0004&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 4}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0005&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 5}},
</span></span><span class="line"><span class="cl"> {&#39;chunkInfo&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0006&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 6}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Limit chunks to just the ‚ÄúItem 1‚Äù section, the organize in ascending order</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (from_same_section:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE from_same_section.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">    AND from_same_section.f10kItem = $f10kItemParam // NEW!!!
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN from_same_section { .formId, .f10kItem, .chunkId, .chunkSeqId } 
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY from_same_section.chunkSeqId ASC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;f10kItemParam&#39;</span><span class="p">:</span> <span class="s1">&#39;item1&#39;</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 0}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0001&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 1}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0002&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 2}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0003&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 3}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0004&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 4}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0005&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 5}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0006&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 6}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0007&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 7}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0008&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 8}},
</span></span><span class="line"><span class="cl"> {&#39;from_same_section&#39;: {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">   &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0009&#39;,
</span></span><span class="line"><span class="cl">   &#39;chunkSeqId&#39;: 9}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Collect ordered chunks into a list</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (from_same_section:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE from_same_section.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">    AND from_same_section.f10kItem = $f10kItemParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH from_same_section { .formId, .f10kItem, .chunkId, .chunkSeqId } 
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY from_same_section.chunkSeqId ASC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN collect(from_same_section) // NEW!!!
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;f10kItemParam&#39;</span><span class="p">:</span> <span class="s1">&#39;item1&#39;</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;collect(from_same_section)&#39;: [{&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 0},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0001&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 1},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0002&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 2},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0003&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 3},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0004&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 4},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0005&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 5},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0006&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 6},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0007&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 7},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0008&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 8},
</span></span><span class="line"><span class="cl">   {&#39;formId&#39;: &#39;0000950170-23-027948&#39;,
</span></span><span class="line"><span class="cl">    &#39;f10kItem&#39;: &#39;item1&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0009&#39;,
</span></span><span class="line"><span class="cl">    &#39;chunkSeqId&#39;: 9}]}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="add-a-next-relationship-between-subsequent-chunks">Add a NEXT relationship between subsequent chunks<a hidden class="anchor" aria-hidden="true" href="#add-a-next-relationship-between-subsequent-chunks">#</a></h3>
<p>Use the <code>apoc.nodes.link</code> function from Neo4j to link ordered list of <code>Chunk</code> nodes with a <code>NEXT</code> relationship.</p>
<p>Do this for just the ‚ÄúItem 1‚Äù section to start.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (from_same_section:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE from_same_section.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">    AND from_same_section.f10kItem = $f10kItemParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH from_same_section
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY from_same_section.chunkSeqId ASC
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH collect(from_same_section) as section_chunk_list
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL apoc.nodes.link(
</span></span></span><span class="line"><span class="cl"><span class="s2">        section_chunk_list, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;NEXT&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        {avoidDuplicates: true}
</span></span></span><span class="line"><span class="cl"><span class="s2">    )  // NEW!!!
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN size(section_chunk_list)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;f10kItemParam&#39;</span><span class="p">:</span> <span class="s1">&#39;item1&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Output: [{&#39;size(section_chunk_list)&#39;: 20}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">refresh_schema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Node properties are the following:
</span></span><span class="line"><span class="cl">Chunk {textEmbedding: LIST, f10kItem: STRING, chunkSeqId: INTEGER, text: STRING, cik: STRING, cusip6: STRING, names: LIST, formId: STRING, source: STRING, chunkId: STRING},Form {cik: STRING, cusip6: STRING, names: LIST, formId: STRING, source: STRING}
</span></span><span class="line"><span class="cl">Relationship properties are the following:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The relationships are the following:
</span></span><span class="line"><span class="cl">(:Chunk)-[:NEXT]-&gt;(:Chunk)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Loop through and create relationships for all sections of the form 10-K</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (from_same_section:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE from_same_section.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">    AND from_same_section.f10kItem = $f10kItemParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH from_same_section
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY from_same_section.chunkSeqId ASC
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH collect(from_same_section) as section_chunk_list
</span></span></span><span class="line"><span class="cl"><span class="s2">    CALL apoc.nodes.link(
</span></span></span><span class="line"><span class="cl"><span class="s2">        section_chunk_list, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;NEXT&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        {avoidDuplicates: true}
</span></span></span><span class="line"><span class="cl"><span class="s2">    )
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN size(section_chunk_list)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">form10kItemName</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;item1&#39;</span><span class="p">,</span> <span class="s1">&#39;item1a&#39;</span><span class="p">,</span> <span class="s1">&#39;item7&#39;</span><span class="p">,</span> <span class="s1">&#39;item7a&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">  <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span><span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                           <span class="s1">&#39;f10kItemParam&#39;</span><span class="p">:</span> <span class="n">form10kItemName</span><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="connect-chunks-to-their-parent-form-with-a-part_of-relationship">Connect chunks to their parent form with a PART_OF relationship<a hidden class="anchor" aria-hidden="true" href="#connect-chunks-to-their-parent-form-with-a-part_of-relationship">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (c:Chunk), (f:Form)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE c.formId = f.formId
</span></span></span><span class="line"><span class="cl"><span class="s2">  MERGE (c)-[newRelationship:PART_OF]-&gt;(f)
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN count(newRelationship)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;count(newRelationship)&#39;: 23}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-a-section-relationship-on-first-chunk-of-each-section">Create a SECTION relationship on first chunk of each section<a hidden class="anchor" aria-hidden="true" href="#create-a-section-relationship-on-first-chunk-of-each-section">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (first:Chunk), (f:Form)
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE first.formId = f.formId
</span></span></span><span class="line"><span class="cl"><span class="s2">    AND first.chunkSeqId = 0
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH first, f
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (f)-[r:SECTION {f10kItem: first.f10kItem}]-&gt;(first)
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN count(r)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span> <span class="c1"># [{&#39;count(newRelationship)&#39;: 23}]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;count(r)&#39;: 4}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="example-cypher-queries">Example cypher queries<a hidden class="anchor" aria-hidden="true" href="#example-cypher-queries">#</a></h3>
<ul>
<li>Return the first chunk of the Item 1 section</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (f:Form)-[r:SECTION]-&gt;(first:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE f.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">        AND r.f10kItem = $f10kItemParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN first.chunkId as chunkId, first.text as text
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">first_chunk_info</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;f10kItemParam&#39;</span><span class="p">:</span> <span class="s1">&#39;item1&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">first_chunk_info</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl"> &#39;text&#39;: &#39;&gt;Item 1.  \nBusiness\n\n\nOverview\n\n\nNetApp, Inc. (NetApp, we, us or the Company) is a global cloud-led, data-centric software company. We were incorporated in 1992 and are headquartered in San Jose, California. Building on more than three decades of innovation, we give customers the freedom to manage applications and data across hybrid multicloud environments. Our portfolio of cloud services, and storage infrastructure, powered by intelligent data management software, enables applications to run faster, more reliably, and more securely, all at a lower cost.\n\n\nOur opportunity is defined by the durable megatrends of data-driven digital and cloud transformations. NetApp helps organizations meet the complexities created by rapid data and cloud growth, multi-cloud management, and the adoption of next-generation technologies, such as AI, Kubernetes, and modern databases. Our modern approach to hybrid, multicloud infrastructure and data management, which we term ‚Äòevolved cloud‚Äô, provides customers the ability to leverage data across their entire estate with simplicity, security, and sustainability which increases our relevance and value to our customers.\n\n\nIn an evolved cloud state, the cloud is fully integrated into an organization‚Äôs architecture and operations. Data centers and clouds are seamlessly united and hybrid multicloud operations are simplified, with consistency and observability across environments. The key benefits NetApp brings to an organization‚Äôs hybrid multicloud environment are:\n\n\n‚Ä¢\nOperational simplicity: NetApp‚Äôs use of open source, open architectures and APIs, microservices, and common capabilities and data services facilitate the creation of applications that can run anywhere.\n\n\n‚Ä¢\nFlexibility and consistency: NetApp makes moving data and applications between environments seamless through a common storage foundation across on-premises and multicloud environments.&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Get the second chunk of the Item 1 section</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (f:Form)-[r:SECTION]-&gt;(first:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE f.formId = $formIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">        AND r.f10kItem = $f10kItemParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN first.chunkId as chunkId, first.text as text
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">first_chunk_info</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;formIdParam&#39;</span><span class="p">:</span> <span class="n">form_info</span><span class="p">[</span><span class="s1">&#39;formId&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;f10kItemParam&#39;</span><span class="p">:</span> <span class="s1">&#39;item1&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (first:Chunk)-[:NEXT]-&gt;(nextChunk:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE first.chunkId = $chunkIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN nextChunk.chunkId as chunkId, nextChunk.text as text
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">next_chunk_info</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">first_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">})[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">next_chunk_info</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;chunkId&#39;</span><span class="p">:</span> <span class="s1">&#39;0000950170-23-027948-item1-chunk0001&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"> <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s2">&#34;‚Ä¢</span><span class="se">\n</span><span class="s2">Flexibility and consistency: NetApp makes moving data and applications between environments seamless through a common storage foundation across on-premises and multicloud environments.</span><span class="se">\n\n\n</span><span class="s2">‚Ä¢</span><span class="se">\n</span><span class="s2">Cyber resilience: NetApp unifies monitoring, data protection, security, governance, and compliance for total cyber resilience - with consistency and automation across environments. </span><span class="se">\n\n\n</span><span class="s2">‚Ä¢</span><span class="se">\n</span><span class="s2">Continuous operations: NetApp uses AI-driven automation for continuous optimization to service applications and store stateless and stateful applications at the lowest possible costs.</span><span class="se">\n\n\n</span><span class="s2">‚Ä¢</span><span class="se">\n</span><span class="s2">Sustainability: NetApp has industry-leading tools to audit consumption, locate waste, and set guardrails to stop overprovisioning.</span><span class="se">\n\n\n</span><span class="s2">Product, Solutions and Services Portfolio</span><span class="se">\n</span><span class="s2"> </span><span class="se">\n\n\n</span><span class="s2">NetApp&#39;s portfolio of cloud services and storage infrastructure is powered by intelligent data management software. Our operations are organized into two segments: Hybrid Cloud and Public Cloud.</span><span class="se">\n\n\n</span><span class="s2"> </span><span class="se">\n\n\n</span><span class="s2">Hybrid Cloud</span><span class="se">\n\n\n</span><span class="s2">Hybrid Cloud </span><span class="se">\n</span><span class="s2">offers a portfolio of storage management and infrastructure solutions that help customers recast their traditional data centers into modern data centers with the power of the cloud. Our hybrid cloud portfolio is designed to operate with public clouds to unlock the potential of hybrid, multi-cloud operations. We offer a broad portfolio of cloud-connected all-flash, hybrid-flash, and object storage systems, powered by intelligent data management software. Hybrid Cloud is composed of software, hardware, and related support, as well as professional and other services.</span><span class="se">\n\n\n</span><span class="s2">Intelligent data management software&#34;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">first_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">],</span> <span class="n">next_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">0000950170-23-027948-item1-chunk0000 0000950170-23-027948-item1-chunk0001
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Return a window of three chunks</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (c1:Chunk)-[:NEXT]-&gt;(c2:Chunk)-[:NEXT]-&gt;(c3:Chunk) 
</span></span></span><span class="line"><span class="cl"><span class="s2">        WHERE c2.chunkId = $chunkIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN c1.chunkId, c2.chunkId, c3.chunkId
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">next_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;c1.chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;,
</span></span><span class="line"><span class="cl">  &#39;c2.chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0001&#39;,
</span></span><span class="line"><span class="cl">  &#39;c3.chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0002&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="information-is-stored-in-the-structure-of-a-graph">Information is stored in the structure of a graph<a hidden class="anchor" aria-hidden="true" href="#information-is-stored-in-the-structure-of-a-graph">#</a></h3>
<ul>
<li>Matched patterns of nodes and relationships in a graph are called <strong>paths</strong></li>
<li>The length of a path is equal to the number of relationships in the path</li>
<li>Paths can be captured as variables and used elsewhere in queries</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH window = (c1:Chunk)-[:NEXT]-&gt;(c2:Chunk)-[:NEXT]-&gt;(c3:Chunk) 
</span></span></span><span class="line"><span class="cl"><span class="s2">        WHERE c1.chunkId = $chunkIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN length(window) as windowPathLength
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">next_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;windowPathLength&#39;: 2}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="finding-variable-length-windows">Finding variable length windows<a hidden class="anchor" aria-hidden="true" href="#finding-variable-length-windows">#</a></h3>
<ul>
<li>A pattern match will fail if the relationship doesn‚Äôt exist in the graph</li>
<li>For example, the first chunk in a section has no preceding chunk, so the next query won‚Äôt return anything</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH window=(c1:Chunk)-[:NEXT]-&gt;(c2:Chunk)-[:NEXT]-&gt;(c3:Chunk) 
</span></span></span><span class="line"><span class="cl"><span class="s2">        WHERE c2.chunkId = $chunkIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN nodes(window) as chunkList
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pull the chunk ID from the first </span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">first_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Modify <code>NEXT</code> relationship to have variable length</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH window=
</span></span></span><span class="line"><span class="cl"><span class="s2">      (:Chunk)-[:NEXT*0..1]-&gt;(c:Chunk)-[:NEXT*0..1]-&gt;(:Chunk) 
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE c.chunkId = $chunkIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN length(window)
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">first_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;length(window)&#39;: 0}, {&#39;length(window)&#39;: 1}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Retrieve only the longest path</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH window=
</span></span></span><span class="line"><span class="cl"><span class="s2">      (:Chunk)-[:NEXT*0..1]-&gt;(c:Chunk)-[:NEXT*0..1]-&gt;(:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE c.chunkId = $chunkIdParam
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH window as longestChunkWindow 
</span></span></span><span class="line"><span class="cl"><span class="s2">      ORDER BY length(window) DESC LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN length(longestChunkWindow)
</span></span></span><span class="line"><span class="cl"><span class="s2">  &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">first_chunk_info</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;length(longestChunkWindow)&#39;: 1}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="customize-the-results-of-the-similarity-search-using-cypher">Customize the results of the similarity search using Cypher<a hidden class="anchor" aria-hidden="true" href="#customize-the-results-of-the-similarity-search-using-cypher">#</a></h3>
<ul>
<li>Extend the vector store definition to accept a Cypher query</li>
<li>The Cypher query takes the results of the vector similarity search and then modifies them in some way</li>
<li>Start with a simple query that just returns some extra text along with the search results</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">retrieval_query_extra_text</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH node, score, &#34;Andreas knows Cypher. &#34; as extraText
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN extraText + &#34;</span><span class="se">\n</span><span class="s2">&#34; + node.text as text,
</span></span></span><span class="line"><span class="cl"><span class="s2">    score,
</span></span></span><span class="line"><span class="cl"><span class="s2">    node {.source} AS metadata
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Set up the vector store to use the query, then instantiate a retriever and Question-Answer chain in LangChain</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">vector_store_extra_text</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="s2">&#34;neo4j&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_property</span><span class="o">=</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retrieval_query</span><span class="o">=</span><span class="n">retrieval_query_extra_text</span><span class="p">,</span> <span class="c1"># NEW !!!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">retriever_extra_text</span> <span class="o">=</span> <span class="n">vector_store_extra_text</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">chain_extra_text</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever_extra_text</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Ask a question!</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">chain_extra_text</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="s2">&#34;What topics does Andreas know about?&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;answer&#39;: &#39;Andreas knows about Cypher, Human Capital, Risk Factors, Quantitative and Qualitative Disclosures About Market Risk, Diversity, Inclusion, Belonging, Benefits, Wellbeing, and Engagement.\n&#39;,
</span></span><span class="line"><span class="cl"> &#39;sources&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Note, the LLM hallucinates here, using the information in the retrieved text as well as the extra text.</li>
<li>Modify the prompt to try and get a more accurate answer</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">chain_extra_text</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="s2">&#34;What single topic does Andreas know about?&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;answer&#39;: &#39;Andreas knows about Cypher.\n&#39;,
</span></span><span class="line"><span class="cl"> &#39;sources&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>The full version of code is as list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">retrieval_query_extra_text</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH node, score, &#34;Andreas knows Cypher. &#34; as extraText
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN extraText + &#34;</span><span class="se">\n</span><span class="s2">&#34; + node.text as text,
</span></span></span><span class="line"><span class="cl"><span class="s2">    score,
</span></span></span><span class="line"><span class="cl"><span class="s2">    node {.source} AS metadata
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">vector_store_extra_text</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="s2">&#34;neo4j&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_property</span><span class="o">=</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retrieval_query</span><span class="o">=</span><span class="n">retrieval_query_extra_text</span><span class="p">,</span> <span class="c1"># NEW !!!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">retriever_extra_text</span> <span class="o">=</span> <span class="n">vector_store_extra_text</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">chain_extra_text</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever_extra_text</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">chain_extra_text</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="s2">&#34;What topics does Andreas know about?&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="try-for-yourself">Try for yourself!<a hidden class="anchor" aria-hidden="true" href="#try-for-yourself">#</a></h3>
<ul>
<li>Modify the query below to add your own additional text</li>
<li>Try engineering the prompt to refine your results</li>
<li><strong>Note, you‚Äôll need to reset the vector store, retriever, and chain each time you change the Cypher query.</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># modify the retrieval extra text here then run the entire cell</span>
</span></span><span class="line"><span class="cl"><span class="n">retrieval_query_extra_text</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH node, score, &#34;Andreas knows Cypher. &#34; as extraText
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN extraText + &#34;</span><span class="se">\n</span><span class="s2">&#34; + node.text as text,
</span></span></span><span class="line"><span class="cl"><span class="s2">    score,
</span></span></span><span class="line"><span class="cl"><span class="s2">    node {.source} AS metadata
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vector_store_extra_text</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="s2">&#34;neo4j&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_property</span><span class="o">=</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retrieval_query</span><span class="o">=</span><span class="n">retrieval_query_extra_text</span><span class="p">,</span> <span class="c1"># NEW !!!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">retriever_extra_text</span> <span class="o">=</span> <span class="n">vector_store_extra_text</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">chain_extra_text</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever_extra_text</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="expand-context-around-a-chunk-using-a-window">Expand context around a chunk using a window<a hidden class="anchor" aria-hidden="true" href="#expand-context-around-a-chunk-using-a-window">#</a></h3>
<ul>
<li>First, create a regular vector store that retrieves a single node</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">neo4j_vector_store</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_graph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_label</span><span class="o">=</span><span class="n">VECTOR_NODE_LABEL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_properties</span><span class="o">=</span><span class="p">[</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding_node_property</span><span class="o">=</span><span class="n">VECTOR_EMBEDDING_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">windowless_retriever</span> <span class="o">=</span> <span class="n">neo4j_vector_store</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">windowless_chain</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">windowless_retriever</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Next, define a window retrieval query to get consecutive chunks</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">retrieval_query_window</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH window=
</span></span></span><span class="line"><span class="cl"><span class="s2">    (:Chunk)-[:NEXT*0..1]-&gt;(node)-[:NEXT*0..1]-&gt;(:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH node, score, window as longestWindow 
</span></span></span><span class="line"><span class="cl"><span class="s2">  ORDER BY length(window) DESC LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH nodes(longestWindow) as chunkList, node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">  UNWIND chunkList as chunkRows
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH collect(chunkRows.text) as textList, node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN apoc.text.join(textList, &#34; </span><span class="se">\n</span><span class="s2"> &#34;) as text,
</span></span></span><span class="line"><span class="cl"><span class="s2">    score,
</span></span></span><span class="line"><span class="cl"><span class="s2">    node {.source} AS metadata
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Set up a QA chain that will use the window retrieval query</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">vector_store_window</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="s2">&#34;neo4j&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_property</span><span class="o">=</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retrieval_query</span><span class="o">=</span><span class="n">retrieval_query_window</span><span class="p">,</span> <span class="c1"># NEW!!!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">retriever_window</span> <span class="o">=</span> <span class="n">vector_store_window</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">chain_window</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever_window</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="compare-the-two-chains">Compare the two chains<a hidden class="anchor" aria-hidden="true" href="#compare-the-two-chains">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;In a single sentence, tell me about Netapp&#39;s business.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="n">windowless_chain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="s2">&#34;answer&#34;</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NetApp is a global cloud-led, data-centric software company that
</span></span><span class="line"><span class="cl">provides customers the freedom to manage applications and data across
</span></span><span class="line"><span class="cl">hybrid multicloud environments, focusing on enterprise storage and
</span></span><span class="line"><span class="cl">data management, cloud storage, and cloud operations markets.
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="n">chain_window</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="s2">&#34;answer&#34;</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NetApp is a company that offers storage-as-a-service and global
</span></span><span class="line"><span class="cl">support for continuous operation in complex environments, with a focus
</span></span><span class="line"><span class="cl">on proactive and preemptive technology support for operational
</span></span><span class="line"><span class="cl">continuity across the NetApp hybrid cloud.
</span></span></code></pre></td></tr></table>
</div>
</div><p>The full version of code is as list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Common data processing</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âä†ËΩΩÁéØÂ¢ÉÂèòÈáè</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_BASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàùÂßãÂåñ OpenAI ÂµåÂÖ•Ê®°ÂûãÔºà‰Ω†ÂèØ‰ª•‰º†ÂÖ• api_key„ÄÅbase_urlÔºâ</span>
</span></span><span class="line"><span class="cl"><span class="n">embedding_model</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">OPENAI_API_KEY</span><span class="p">,</span> <span class="n">base_url</span><span class="o">=</span><span class="n">OPENAI_BASE_URL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">neo4j_vector_store</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_graph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_label</span><span class="o">=</span><span class="n">VECTOR_NODE_LABEL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_properties</span><span class="o">=</span><span class="p">[</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding_node_property</span><span class="o">=</span><span class="n">VECTOR_EMBEDDING_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">windowless_retriever</span> <span class="o">=</span> <span class="n">neo4j_vector_store</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">windowless_chain</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">windowless_retriever</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">retrieval_query_window</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH window=
</span></span></span><span class="line"><span class="cl"><span class="s2">    (:Chunk)-[:NEXT*0..1]-&gt;(node)-[:NEXT*0..1]-&gt;(:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH node, score, window as longestWindow 
</span></span></span><span class="line"><span class="cl"><span class="s2">  ORDER BY length(window) DESC LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH nodes(longestWindow) as chunkList, node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">  UNWIND chunkList as chunkRows
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH collect(chunkRows.text) as textList, node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN apoc.text.join(textList, &#34; </span><span class="se">\n</span><span class="s2"> &#34;) as text,
</span></span></span><span class="line"><span class="cl"><span class="s2">    score,
</span></span></span><span class="line"><span class="cl"><span class="s2">    node {.source} AS metadata
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">vector_store_window</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="s2">&#34;neo4j&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_property</span><span class="o">=</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retrieval_query</span><span class="o">=</span><span class="n">retrieval_query_window</span><span class="p">,</span> <span class="c1"># NEW!!!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">retriever_window</span> <span class="o">=</span> <span class="n">vector_store_window</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">chain_window</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever_window</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;In a single sentence, tell me about Netapp&#39;s business.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="n">windowless_chain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="s2">&#34;answer&#34;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="n">chain_window</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">answer</span><span class="p">[</span><span class="s2">&#34;answer&#34;</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">NetApp is a global cloud-led, data-centric software company that
</span></span><span class="line"><span class="cl">provides customers the freedom to manage applications and data across
</span></span><span class="line"><span class="cl">hybrid multicloud environments, focusing primarily on enterprise
</span></span><span class="line"><span class="cl">storage and data management, cloud storage, and cloud operations
</span></span><span class="line"><span class="cl">markets.
</span></span><span class="line"><span class="cl">NetApp is a company that offers storage-as-a-service and global
</span></span><span class="line"><span class="cl">support for hybrid cloud environments, with a focus on enterprise
</span></span><span class="line"><span class="cl">storage, data management, and cloud operations.
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lesson-6-expanding-the-sec-knowledge-graph">Lesson 6: Expanding the SEC Knowledge Graph<a hidden class="anchor" aria-hidden="true" href="#lesson-6-expanding-the-sec-knowledge-graph">#</a></h2>
<h3 id="import-packages-and-set-up-neo4j-4">Import packages and set up Neo4j<a hidden class="anchor" aria-hidden="true" href="#import-packages-and-set-up-neo4j-4">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neo4j&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="read-the-collection-of-form-13s">Read the collection of Form 13s<a hidden class="anchor" aria-hidden="true" href="#read-the-collection-of-form-13s">#</a></h3>
<ul>
<li>Investment management firms must report on their investments in companies to the SEC by filing a document called <strong>Form 13</strong></li>
<li>You‚Äôll load a collection of Form 13 for managers that have invested in NetApp</li>
<li>You can check out the CSV file by navigating to the data directory using the File menu at the top of the notebook</li>
</ul>
<p>We can use the <a href="https://github.com/aishweta/Neo4j-Knowledge-Graphs-for-RAG/blob/main/form13.csv">url</a> to get the form13.csv from GitHub.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">all_form13s</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./data/form13.csv&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span> <span class="c1"># each row will be a dictionary</span>
</span></span><span class="line"><span class="cl">      <span class="n">all_form13s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Look at the contents of the first 5 Form 13s</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">all_form13s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;source&#39;: &#39;https://sec.gov/Archives/edgar/data/1000275/0001140361-23-039575.txt&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerCik&#39;: &#39;1000275&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerAddress&#39;: &#39;ROYAL BANK PLAZA, 200 BAY STREET, TORONTO, A6, M5J2J5&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerName&#39;: &#39;Royal Bank of Canada&#39;,
</span></span><span class="line"><span class="cl">  &#39;reportCalendarOrQuarter&#39;: &#39;2023-06-30&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip&#39;: &#39;64110D104&#39;,
</span></span><span class="line"><span class="cl">  &#39;companyName&#39;: &#39;NETAPP INC&#39;,
</span></span><span class="line"><span class="cl">  &#39;value&#39;: &#39;64395000000.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;shares&#39;: &#39;842850&#39;},
</span></span><span class="line"><span class="cl"> {&#39;source&#39;: &#39;https://sec.gov/Archives/edgar/data/1002784/0001387131-23-009542.txt&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerCik&#39;: &#39;1002784&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerAddress&#39;: &#39;1875 Lawrence Street, Suite 300, Denver, CO, 80202-1805&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerName&#39;: &#39;SHELTON CAPITAL MANAGEMENT&#39;,
</span></span><span class="line"><span class="cl">  &#39;reportCalendarOrQuarter&#39;: &#39;2023-06-30&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip&#39;: &#39;64110D104&#39;,
</span></span><span class="line"><span class="cl">  &#39;companyName&#39;: &#39;NETAPP INC&#39;,
</span></span><span class="line"><span class="cl">  &#39;value&#39;: &#39;2989085000.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;shares&#39;: &#39;39124&#39;},
</span></span><span class="line"><span class="cl"> {&#39;source&#39;: &#39;https://sec.gov/Archives/edgar/data/1007280/0001007280-23-000008.txt&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerCik&#39;: &#39;1007280&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerAddress&#39;: &#39;277 E TOWN ST, COLUMBUS, OH, 43215&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerName&#39;: &#39;PUBLIC EMPLOYEES RETIREMENT SYSTEM OF OHIO&#39;,
</span></span><span class="line"><span class="cl">  &#39;reportCalendarOrQuarter&#39;: &#39;2023-06-30&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip&#39;: &#39;64110D104&#39;,
</span></span><span class="line"><span class="cl">  &#39;companyName&#39;: &#39;Netapp Inc&#39;,
</span></span><span class="line"><span class="cl">  &#39;value&#39;: &#39;8170000.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;shares&#39;: &#39;106941&#39;},
</span></span><span class="line"><span class="cl"> {&#39;source&#39;: &#39;https://sec.gov/Archives/edgar/data/1007399/0001007399-23-000004.txt&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerCik&#39;: &#39;1007399&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerAddress&#39;: &#39;150 WEST MAIN STREET, SUITE 1700, NORFOLK, VA, 23510&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerName&#39;: &#39;WILBANKS SMITH &amp; THOMAS ASSET MANAGEMENT LLC&#39;,
</span></span><span class="line"><span class="cl">  &#39;reportCalendarOrQuarter&#39;: &#39;2023-06-30&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip&#39;: &#39;64110D104&#39;,
</span></span><span class="line"><span class="cl">  &#39;companyName&#39;: &#39;NETAPP INC&#39;,
</span></span><span class="line"><span class="cl">  &#39;value&#39;: &#39;505539000.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;shares&#39;: &#39;6617&#39;},
</span></span><span class="line"><span class="cl"> {&#39;source&#39;: &#39;https://sec.gov/Archives/edgar/data/1008894/0001172661-23-003025.txt&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerCik&#39;: &#39;1008894&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerAddress&#39;: &#39;250 Park Avenue South, Suite 250, Winter Park, FL, 32789&#39;,
</span></span><span class="line"><span class="cl">  &#39;managerName&#39;: &#39;DEPRINCE RACE &amp; ZOLLO INC&#39;,
</span></span><span class="line"><span class="cl">  &#39;reportCalendarOrQuarter&#39;: &#39;2023-06-30&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl">  &#39;cusip&#39;: &#39;64110D104&#39;,
</span></span><span class="line"><span class="cl">  &#39;companyName&#39;: &#39;NETAPP INC&#39;,
</span></span><span class="line"><span class="cl">  &#39;value&#39;: &#39;24492389000.0&#39;,
</span></span><span class="line"><span class="cl">  &#39;shares&#39;: &#39;320581&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">len(all_form13s) # 561
</span></span></code></pre></td></tr></table>
</div>
</div><p>The csv file I used is from <a href="https://github.com/end0/SEC-13F-Securities/blob/master/data/sample/csv/13flist2018q4.csv">https://github.com/end0/SEC-13F-Securities/blob/master/data/sample/csv/13flist2018q4.csv</a>. We can also use <a href="https://github.com/zach-blumenfeld/neo4j-sec-edgar-form13/blob/main/download.py">the python script</a> to download data.</p>
<p>The full version of code is as list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neo4j&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">all_form13s</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./data/13flist2018q4.csv&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">csv_reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_reader</span><span class="p">:</span> <span class="c1"># each row will be a dictionary</span>
</span></span><span class="line"><span class="cl">      <span class="n">all_form13s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">all_form13s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;year&#39;: &#39;2018&#39;, &#39;quarter&#39;: &#39;4&#39;, &#39;cusip_no&#39;: &#39;33734X 90 2&#39;, &#39;has_listed_options&#39;: &#39;&#39;, &#39;issuer_name&#39;: &#39;FIRST TR EXCHANGE TRADED FD&#39;, &#39;issuer_description&#39;: &#39;CALL&#39;, &#39;status&#39;: &#39;&#39;, &#39;cusip_6&#39;: &#39;33734X&#39;, &#39;cusip_2&#39;: &#39;90&#39;, &#39;cusip_1&#39;: &#39;2&#39;, &#39;cusip_8&#39;: &#39;33734X90&#39;, &#39;cusip_9&#39;: &#39;33734X902&#39;}, {&#39;year&#39;: &#39;2018&#39;, &#39;quarter&#39;: &#39;4&#39;, &#39;cusip_no&#39;: &#39;98954M 20 0&#39;, &#39;has_listed_options&#39;: &#39;*&#39;, &#39;issuer_name&#39;: &#39;ZILLOW GROUP INC&#39;, &#39;issuer_description&#39;: &#39;CL C CAP STK&#39;, &#39;status&#39;: &#39;&#39;, &#39;cusip_6&#39;: &#39;98954M&#39;, &#39;cusip_2&#39;: &#39;20&#39;, &#39;cusip_1&#39;: &#39;0&#39;, &#39;cusip_8&#39;: &#39;98954M20&#39;, &#39;cusip_9&#39;: &#39;98954M200&#39;}, {&#39;year&#39;: &#39;2018&#39;, &#39;quarter&#39;: &#39;4&#39;, &#39;cusip_no&#39;: &#39;518416 70 6&#39;, &#39;has_listed_options&#39;: &#39;&#39;, &#39;issuer_name&#39;: &#39;LATTICE STRATEGIES TR&#39;, &#39;issuer_description&#39;: &#39;HARTFORD MULTI&#39;, &#39;status&#39;: &#39;&#39;, &#39;cusip_6&#39;: &#39;518416&#39;, &#39;cusip_2&#39;: &#39;70&#39;, &#39;cusip_1&#39;: &#39;6&#39;, &#39;cusip_8&#39;: &#39;51841670&#39;, &#39;cusip_9&#39;: &#39;518416706&#39;}, {&#39;year&#39;: &#39;2018&#39;, &#39;quarter&#39;: &#39;4&#39;, &#39;cusip_no&#39;: &#39;35471R 90 6&#39;, &#39;has_listed_options&#39;: &#39;&#39;, &#39;issuer_name&#39;: &#39;FRANKLIN STREET PPTYS CORP&#39;, &#39;issuer_description&#39;: &#39;CALL&#39;, &#39;status&#39;: &#39;&#39;, &#39;cusip_6&#39;: &#39;35471R&#39;, &#39;cusip_2&#39;: &#39;90&#39;, &#39;cusip_1&#39;: &#39;6&#39;, &#39;cusip_8&#39;: &#39;35471R90&#39;, &#39;cusip_9&#39;: &#39;35471R906&#39;}, {&#39;year&#39;: &#39;2018&#39;, &#39;quarter&#39;: &#39;4&#39;, &#39;cusip_no&#39;: &#39;043436 10 4&#39;, &#39;has_listed_options&#39;: &#39;*&#39;, &#39;issuer_name&#39;: &#39;ASBURY AUTOMOTIVE GROUP INC&#39;, &#39;issuer_description&#39;: &#39;COM&#39;, &#39;status&#39;: &#39;&#39;, &#39;cusip_6&#39;: &#39;043436&#39;, &#39;cusip_2&#39;: &#39;10&#39;, &#39;cusip_1&#39;: &#39;4&#39;, &#39;cusip_8&#39;: &#39;04343610&#39;, &#39;cusip_9&#39;: &#39;043436104&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-company-nodes-in-the-graph">Create company nodes in the graph<a hidden class="anchor" aria-hidden="true" href="#create-company-nodes-in-the-graph">#</a></h3>
<ul>
<li>Use the companies identified in the Form 13s to create <code>Company</code> nodes</li>
<li>For now, there is only one company - NetApp</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># work with just the first form fow now</span>
</span></span><span class="line"><span class="cl"><span class="n">first_form13</span> <span class="o">=</span> <span class="n">all_form13s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MERGE (com:Company {cusip6: $cusip6})
</span></span></span><span class="line"><span class="cl"><span class="s2">  ON CREATE
</span></span></span><span class="line"><span class="cl"><span class="s2">    SET com.companyName = $companyName,
</span></span></span><span class="line"><span class="cl"><span class="s2">        com.cusip = $cusip
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cusip6&#39;</span><span class="p">:</span><span class="n">first_form13</span><span class="p">[</span><span class="s1">&#39;cusip6&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;companyName&#39;</span><span class="p">:</span><span class="n">first_form13</span><span class="p">[</span><span class="s1">&#39;companyName&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cusip&#39;</span><span class="p">:</span><span class="n">first_form13</span><span class="p">[</span><span class="s1">&#39;cusip&#39;</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (com:Company)
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN com LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;com&#39;: {&#39;cusip&#39;: &#39;64110D104&#39;,
</span></span><span class="line"><span class="cl">   &#39;names&#39;: [&#39;Netapp Inc&#39;, &#39;NETAPP INC&#39;],
</span></span><span class="line"><span class="cl">   &#39;companyName&#39;: &#39;NETAPP INC&#39;,
</span></span><span class="line"><span class="cl">   &#39;cusip6&#39;: &#39;64110D&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Update the company name to match Form 10-K</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (com:Company), (form:Form)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE com.cusip6 = form.cusip6
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN com.companyName, form.names
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;com.companyName&#39;: &#39;NETAPP INC&#39;, &#39;form.names&#39;: [&#39;Netapp Inc&#39;, &#39;NETAPP INC&#39;]}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (com:Company), (form:Form)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE com.cusip6 = form.cusip6
</span></span></span><span class="line"><span class="cl"><span class="s2">  SET com.names = form.names
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create a <code>FILED</code> relationship between the company and the Form-10K node</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (com:Company), (form:Form)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE com.cusip6 = form.cusip6
</span></span></span><span class="line"><span class="cl"><span class="s2">  MERGE (com)-[:FILED]-&gt;(form)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-manager-nodes">Create manager nodes<a hidden class="anchor" aria-hidden="true" href="#create-manager-nodes">#</a></h3>
<ul>
<li>Create a <code>manager</code> node for companies that have filed a Form 13 to report their investment in NetApp</li>
<li>Start with the single manager who filed the first Form 13 in the list</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MERGE (mgr:Manager {managerCik: $managerParam.managerCik})
</span></span></span><span class="line"><span class="cl"><span class="s2">    ON CREATE
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET mgr.managerName = $managerParam.managerName,
</span></span></span><span class="line"><span class="cl"><span class="s2">            mgr.managerAddress = $managerParam.managerAddress
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;managerParam&#39;</span><span class="p">:</span> <span class="n">first_form13</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (mgr:Manager)
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN mgr LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mgr&#39;: {&#39;managerCik&#39;: &#39;1000275&#39;,
</span></span><span class="line"><span class="cl">   &#39;managerAddress&#39;: &#39;ROYAL BANK PLAZA, 200 BAY STREET, TORONTO, A6, M5J2J5&#39;,
</span></span><span class="line"><span class="cl">   &#39;managerName&#39;: &#39;Royal Bank of Canada&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create a uniqueness constraint to avoid duplicate managers</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE CONSTRAINT unique_manager 
</span></span></span><span class="line"><span class="cl"><span class="s2">  IF NOT EXISTS
</span></span></span><span class="line"><span class="cl"><span class="s2">  FOR (n:Manager) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  REQUIRE n.managerCik IS UNIQUE
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create a fulltext index of manager names to enable text search</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CREATE FULLTEXT INDEX fullTextManagerNames
</span></span></span><span class="line"><span class="cl"><span class="s2">  IF NOT EXISTS
</span></span></span><span class="line"><span class="cl"><span class="s2">  FOR (mgr:Manager) 
</span></span></span><span class="line"><span class="cl"><span class="s2">  ON EACH [mgr.managerName]
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CALL db.index.fulltext.queryNodes(&#34;fullTextManagerNames&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">      &#34;royal bank&#34;) YIELD node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN node.managerName, score
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;node.managerName&#39;: &#39;Royal Bank of Canada&#39;, &#39;score&#39;: 0.2615291476249695}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create nodes for all companies that filed a Form 13</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MERGE (mgr:Manager {managerCik: $managerParam.managerCik})
</span></span></span><span class="line"><span class="cl"><span class="s2">    ON CREATE
</span></span></span><span class="line"><span class="cl"><span class="s2">        SET mgr.managerName = $managerParam.managerName,
</span></span></span><span class="line"><span class="cl"><span class="s2">            mgr.managerAddress = $managerParam.managerAddress
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># loop through all Form 13s</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">form13</span> <span class="ow">in</span> <span class="n">all_form13s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;managerParam&#39;</span><span class="p">:</span> <span class="n">form13</span> <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (mgr:Manager) 
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN count(mgr)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;count(mgr)&#39;: 561}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="create-relationships-between-managers-and-companies">Create relationships between managers and companies<a hidden class="anchor" aria-hidden="true" href="#create-relationships-between-managers-and-companies">#</a></h3>
<ul>
<li>Match companies with managers based on data in the Form 13</li>
<li>Create an <code>OWNS_STOCK_IN</code> relationship between the manager and the company</li>
<li>Start with the single manager who filed the first Form 13 in the list</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (mgr:Manager {managerCik: $investmentParam.managerCik}), 
</span></span></span><span class="line"><span class="cl"><span class="s2">        (com:Company {cusip6: $investmentParam.cusip6})
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN mgr.managerName, com.companyName, $investmentParam as investment
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;investmentParam&#39;</span><span class="p">:</span> <span class="n">first_form13</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mgr.managerName&#39;: &#39;Royal Bank of Canada&#39;,
</span></span><span class="line"><span class="cl">  &#39;com.companyName&#39;: &#39;NETAPP INC&#39;,
</span></span><span class="line"><span class="cl">  &#39;investment&#39;: {&#39;shares&#39;: &#39;842850&#39;,
</span></span><span class="line"><span class="cl">   &#39;source&#39;: &#39;https://sec.gov/Archives/edgar/data/1000275/0001140361-23-039575.txt&#39;,
</span></span><span class="line"><span class="cl">   &#39;managerName&#39;: &#39;Royal Bank of Canada&#39;,
</span></span><span class="line"><span class="cl">   &#39;managerAddress&#39;: &#39;ROYAL BANK PLAZA, 200 BAY STREET, TORONTO, A6, M5J2J5&#39;,
</span></span><span class="line"><span class="cl">   &#39;value&#39;: &#39;64395000000.0&#39;,
</span></span><span class="line"><span class="cl">   &#39;cusip6&#39;: &#39;64110D&#39;,
</span></span><span class="line"><span class="cl">   &#39;cusip&#39;: &#39;64110D104&#39;,
</span></span><span class="line"><span class="cl">   &#39;reportCalendarOrQuarter&#39;: &#39;2023-06-30&#39;,
</span></span><span class="line"><span class="cl">   &#39;companyName&#39;: &#39;NETAPP INC&#39;,
</span></span><span class="line"><span class="cl">   &#39;managerCik&#39;: &#39;1000275&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager {managerCik: $ownsParam.managerCik}), 
</span></span></span><span class="line"><span class="cl"><span class="s2">        (com:Company {cusip6: $ownsParam.cusip6})
</span></span></span><span class="line"><span class="cl"><span class="s2">MERGE (mgr)-[owns:OWNS_STOCK_IN { 
</span></span></span><span class="line"><span class="cl"><span class="s2">    reportCalendarOrQuarter: $ownsParam.reportCalendarOrQuarter
</span></span></span><span class="line"><span class="cl"><span class="s2">}]-&gt;(com)
</span></span></span><span class="line"><span class="cl"><span class="s2">ON CREATE
</span></span></span><span class="line"><span class="cl"><span class="s2">    SET owns.value  = toFloat($ownsParam.value), 
</span></span></span><span class="line"><span class="cl"><span class="s2">        owns.shares = toInteger($ownsParam.shares)
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mgr.managerName, owns.reportCalendarOrQuarter, com.companyName
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;ownsParam&#39;</span><span class="p">:</span> <span class="n">first_form13</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mgr.managerName&#39;: &#39;Royal Bank of Canada&#39;,
</span></span><span class="line"><span class="cl">  &#39;owns.reportCalendarOrQuarter&#39;: &#39;2023-06-30&#39;,
</span></span><span class="line"><span class="cl">  &#39;com.companyName&#39;: &#39;NETAPP INC&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager {managerCik: $ownsParam.managerCik})
</span></span></span><span class="line"><span class="cl"><span class="s2">-[owns:OWNS_STOCK_IN]-&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        (com:Company {cusip6: $ownsParam.cusip6})
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN owns { .shares, .value }
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;ownsParam&#39;</span><span class="p">:</span> <span class="n">first_form13</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;owns&#39;: {&#39;shares&#39;: 842850, &#39;value&#39;: 64395000000.0}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create relationships between all of the managers who filed Form 13s and the company</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager {managerCik: $ownsParam.managerCik}), 
</span></span></span><span class="line"><span class="cl"><span class="s2">        (com:Company {cusip6: $ownsParam.cusip6})
</span></span></span><span class="line"><span class="cl"><span class="s2">MERGE (mgr)-[owns:OWNS_STOCK_IN { 
</span></span></span><span class="line"><span class="cl"><span class="s2">    reportCalendarOrQuarter: $ownsParam.reportCalendarOrQuarter 
</span></span></span><span class="line"><span class="cl"><span class="s2">    }]-&gt;(com)
</span></span></span><span class="line"><span class="cl"><span class="s2">  ON CREATE
</span></span></span><span class="line"><span class="cl"><span class="s2">    SET owns.value  = toFloat($ownsParam.value), 
</span></span></span><span class="line"><span class="cl"><span class="s2">        owns.shares = toInteger($ownsParam.shares)
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#loop through all Form 13s</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">form13</span> <span class="ow">in</span> <span class="n">all_form13s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ownsParam&#39;</span><span class="p">:</span> <span class="n">form13</span> <span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (:Manager)-[owns:OWNS_STOCK_IN]-&gt;(:Company)
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN count(owns) as investments
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span> <span class="c1"># [{&#39;investments&#39;: 561}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">refresh_schema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Node properties are the following: Chunk {textEmbedding:
</span></span><span class="line"><span class="cl">LIST, f10kItem: STRING, chunkSeqId: INTEGER, text: STRING,
</span></span><span class="line"><span class="cl">cik: STRING, cusip6: STRING, names: LIST, formId: STRING,
</span></span><span class="line"><span class="cl">source: STRING, chunkId: STRING},Form {cusip6: STRING,
</span></span><span class="line"><span class="cl">names: LIST, formId: STRING, source: STRING},Company
</span></span><span class="line"><span class="cl">{cusip6: STRING, names: LIST, companyName: STRING, cusip:
</span></span><span class="line"><span class="cl">STRING},Manager {managerName: STRING, managerCik: STRING,
</span></span><span class="line"><span class="cl">managerAddress: STRING} Relationship properties are the
</span></span><span class="line"><span class="cl">following: SECTION {f10kItem: STRING},OWNS_STOCK_IN {shares:
</span></span><span class="line"><span class="cl">INTEGER, reportCalendarOrQuarter: STRING, value: FLOAT} The
</span></span><span class="line"><span class="cl">relationships are the following: (:Chunk)-[:NEXT]-
</span></span><span class="line"><span class="cl">&gt;(:Chunk),(:Chunk)-[:PART_OF]-&gt;(:Form),(:Form)-[:SECTION]-
</span></span><span class="line"><span class="cl">&gt;(:Chunk),(:Company)-[:FILED]-&gt;(:Form),(:Manager)-
</span></span><span class="line"><span class="cl">[:OWNS_STOCK_IN]-&gt;(:Company)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="determine-the-number-of-investors">Determine the number of investors<a hidden class="anchor" aria-hidden="true" href="#determine-the-number-of-investors">#</a></h3>
<ul>
<li>Start by finding a form 10-K chunk, and save to use in subsequent queries</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (chunk:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN chunk.chunkId as chunkId LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">chunk_rows</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">chunk_rows</span><span class="p">)</span> <span class="c1"># [{&#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;}]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">chunk_first_row</span> <span class="o">=</span> <span class="n">chunk_rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">chunk_first_row</span><span class="p">)</span>  <span class="c1"># {&#39;chunkId&#39;: &#39;0000950170-23-027948-item1-chunk0000&#39;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ref_chunk_id</span> <span class="o">=</span> <span class="n">chunk_first_row</span><span class="p">[</span><span class="s1">&#39;chunkId&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">ref_chunk_id</span><span class="p">)</span>  <span class="c1"># &#39;0000950170-23-027948-item1-chunk0000&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Build up path from Form 10-K chunk to companies and managers</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (:Chunk {chunkId: $chunkIdParam})-[:PART_OF]-&gt;(f:Form)
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN f.source
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">ref_chunk_id</span><span class="p">}))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;f.source&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (:Chunk {chunkId: $chunkIdParam})-[:PART_OF]-&gt;(f:Form),
</span></span></span><span class="line"><span class="cl"><span class="s2">    (com:Company)-[:FILED]-&gt;(f)
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN com.companyName as name
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">ref_chunk_id</span><span class="p">}))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;name&#39;: &#39;NETAPP INC&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (:Chunk {chunkId: $chunkIdParam})-[:PART_OF]-&gt;(f:Form),
</span></span></span><span class="line"><span class="cl"><span class="s2">        (com:Company)-[:FILED]-&gt;(f),
</span></span></span><span class="line"><span class="cl"><span class="s2">        (mgr:Manager)-[:OWNS_STOCK_IN]-&gt;(com)
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN com.companyName, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        count(mgr.managerName) as numberOfinvestors 
</span></span></span><span class="line"><span class="cl"><span class="s2">LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">ref_chunk_id</span><span class="p">}))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;com.companyName&#39;: &#39;NETAPP INC&#39;, &#39;numberOfinvestors&#39;: 561}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="use-queries-to-build-additional-context-for-llm">Use queries to build additional context for LLM<a hidden class="anchor" aria-hidden="true" href="#use-queries-to-build-additional-context-for-llm">#</a></h3>
<ul>
<li>Create sentences that indicate how much stock a manager has invested in a company</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MATCH (:Chunk {chunkId: $chunkIdParam})-[:PART_OF]-&gt;(f:Form),
</span></span></span><span class="line"><span class="cl"><span class="s2">        (com:Company)-[:FILED]-&gt;(f),
</span></span></span><span class="line"><span class="cl"><span class="s2">        (mgr:Manager)-[owns:OWNS_STOCK_IN]-&gt;(com)
</span></span></span><span class="line"><span class="cl"><span class="s2">    RETURN mgr.managerName + &#34; owns &#34; + owns.shares + 
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34; shares of &#34; + com.companyName + 
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34; at a value of $&#34; + 
</span></span></span><span class="line"><span class="cl"><span class="s2">        apoc.number.format(toInteger(owns.value)) AS text
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">ref_chunk_id</span><span class="p">}))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;text&#39;: &#39;CSS LLC/IL owns 12500 shares of NETAPP INC at a value of $955,000,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;BOKF, NA owns 40774 shares of NETAPP INC at a value of $3,115,134,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;BANK OF NOVA SCOTIA owns 18676 shares of NETAPP INC at a value of $1,426,847,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;Jefferies Financial Group Inc. owns 23200 shares of NETAPP INC at a value of $1,772,480,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;DEUTSCHE BANK AG\\ owns 929854 shares of NETAPP INC at a value of $71,040,845,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;TORONTO DOMINION BANK owns 183163 shares of NETAPP INC at a value of $13,984,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;STATE BOARD OF ADMINISTRATION OF FLORIDA RETIREMENT SYSTEM owns 265756 shares of NETAPP INC at a value of $20,303,759,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;NISA INVESTMENT ADVISORS, LLC owns 67848 shares of NETAPP INC at a value of $5,183,587,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;ONTARIO TEACHERS PENSION PLAN BOARD owns 7290 shares of NETAPP INC at a value of $556,956,000&#39;},
</span></span><span class="line"><span class="cl"> {&#39;text&#39;: &#39;STATE STREET CORP owns 9321206 shares of NETAPP INC at a value of $712,140,138,000&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">results</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;chunkIdParam&#39;</span><span class="p">:</span> <span class="n">ref_chunk_id</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="mi">60</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CSS LLC/IL owns 12500 shares of NETAPP INC at a value of
</span></span><span class="line"><span class="cl">$955,000,000
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create a plain Question Answer chain</li>
<li>Similarity search only, no augmentation by Cypher Query</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">vector_store</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_graph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding</span><span class="o">=</span><span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">node_label</span><span class="o">=</span><span class="n">VECTOR_NODE_LABEL</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_properties</span><span class="o">=</span><span class="p">[</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">embedding_node_property</span><span class="o">=</span><span class="n">VECTOR_EMBEDDING_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">retriever</span> <span class="o">=</span> <span class="n">vector_store</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">plain_chain</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Create a second QA chain</li>
<li>Augment similarity search using sentences found by the investment query above</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">investment_retrieval_query</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (node)-[:PART_OF]-&gt;(f:Form),
</span></span></span><span class="line"><span class="cl"><span class="s2">    (f)&lt;-[:FILED]-(com:Company),
</span></span></span><span class="line"><span class="cl"><span class="s2">    (com)&lt;-[owns:OWNS_STOCK_IN]-(mgr:Manager)
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH node, score, mgr, owns, com 
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY owns.shares DESC LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH collect (
</span></span></span><span class="line"><span class="cl"><span class="s2">    mgr.managerName + 
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34; owns &#34; + owns.shares + 
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34; shares in &#34; + com.companyName + 
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34; at a value of $&#34; + 
</span></span></span><span class="line"><span class="cl"><span class="s2">    apoc.number.format(toInteger(owns.value)) + &#34;.&#34; 
</span></span></span><span class="line"><span class="cl"><span class="s2">) AS investment_statements, node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN apoc.text.join(investment_statements, &#34;</span><span class="se">\n</span><span class="s2">&#34;) + 
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;</span><span class="se">\n</span><span class="s2">&#34; + node.text AS text,
</span></span></span><span class="line"><span class="cl"><span class="s2">    score,
</span></span></span><span class="line"><span class="cl"><span class="s2">    { 
</span></span></span><span class="line"><span class="cl"><span class="s2">      source: node.source
</span></span></span><span class="line"><span class="cl"><span class="s2">    } as metadata
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">vector_store_with_investment</span> <span class="o">=</span> <span class="n">Neo4jVector</span><span class="o">.</span><span class="n">from_existing_index</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">OpenAIEmbeddings</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="o">=</span><span class="s2">&#34;neo4j&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">index_name</span><span class="o">=</span><span class="n">VECTOR_INDEX_NAME</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_node_property</span><span class="o">=</span><span class="n">VECTOR_SOURCE_PROPERTY</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">retrieval_query</span><span class="o">=</span><span class="n">investment_retrieval_query</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a retriever from the vector store</span>
</span></span><span class="line"><span class="cl"><span class="n">retriever_with_investments</span> <span class="o">=</span> <span class="n">vector_store_with_investment</span><span class="o">.</span><span class="n">as_retriever</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a chatbot Question &amp; Answer chain from the retriever</span>
</span></span><span class="line"><span class="cl"><span class="n">investment_chain</span> <span class="o">=</span> <span class="n">RetrievalQAWithSourcesChain</span><span class="o">.</span><span class="n">from_chain_type</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">    <span class="n">chain_type</span><span class="o">=</span><span class="s2">&#34;stuff&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">retriever</span><span class="o">=</span><span class="n">retriever_with_investments</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Compare the outputs!</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;In a single sentence, tell me about Netapp.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">plain_chain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;answer&#39;: &#39;NetApp is a global cloud-led, data-centric software company that provides customers the freedom to manage applications and data across hybrid multicloud environments. \n&#39;, &#39;sources&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;In a single sentence, tell me about Netapp.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">investment_chain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;answer&#39;: &#39;NetApp is a global cloud-led, data-centric software company that focuses on enterprise storage and data management, cloud storage, and cloud operations markets, providing solutions for hybrid multicloud environments and intelligent data management software.\n&#39;, &#39;sources&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>The LLM didn‚Äôt make use of the investor information since the question didn‚Äôt ask about investors</li>
<li>Change the question and ask again</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">question</span> <span class="o">=</span> <span class="s2">&#34;In a single sentence, tell me about Netapp investors.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">plain_chain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;answer&#39;: &#39;Netapp investors are a diversified group that includes global enterprises, local businesses, and government installations who look to NetApp and its ecosystem of partners to help maximize the business value of their IT and cloud investments.\n&#39;,
</span></span><span class="line"><span class="cl"> &#39;sources&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">investment_chain</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span><span class="s2">&#34;question&#34;</span><span class="p">:</span> <span class="n">question</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_only_outputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{&#39;answer&#39;: &#39;Netapp investors include Vanguard Group Inc., BlackRock Inc., and PRIMECAP MANAGEMENT CO/CA/.\n&#39;,
</span></span><span class="line"><span class="cl"> &#39;sources&#39;: &#39;https://www.sec.gov/Archives/edgar/data/1002047/000095017023027948/0000950170-23-027948-index.htm&#39;}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="lesson-7-chatting-with-the-sec-knowledge-graph">Lesson 7: Chatting with the SEC Knowledge Graph<a hidden class="anchor" aria-hidden="true" href="#lesson-7-chatting-with-the-sec-knowledge-graph">#</a></h2>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/4d559a6ffeb8463d9f1a0f25ac33a252.png"></p>
<p>Extract, Enhance, Expand with SEC Forms.</p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost05/img20250515164835.png"></p>
<p><img loading="lazy" src="https://cdn.jsdelivr.net/gh/Rosefinch-Midsummer/MyImagesHost05/img20250515165119.png"></p>
<p><strong>The graph is displayed as follows.</strong></p>
<p><img alt="Âú®ËøôÈáåÊèíÂÖ•ÂõæÁâáÊèèËø∞" loading="lazy" src="https://i-blog.csdnimg.cn/direct/ce6b2120f6144147bb9b52724350bae0.png"></p>
<h3 id="import-packages-and-set-up-neo4j-5">Import packages and set up Neo4j<a hidden class="anchor" aria-hidden="true" href="#import-packages-and-set-up-neo4j-5">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">textwrap</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Langchain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.vectorstores</span> <span class="kn">import</span> <span class="n">Neo4jVector</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQAWithSourcesChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.prompts.prompt</span> <span class="kn">import</span> <span class="n">PromptTemplate</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">GraphCypherQAChain</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Warning control</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Load from environment</span>
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neo4j&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_API_KEY&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Note the code below is unique to this course environment, and not a </span>
</span></span><span class="line"><span class="cl"><span class="c1"># standard part of Neo4j&#39;s integration with OpenAI. Remove if running </span>
</span></span><span class="line"><span class="cl"><span class="c1"># in your own environment.</span>
</span></span><span class="line"><span class="cl"><span class="n">OPENAI_ENDPOINT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;OPENAI_BASE_URL&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/embeddings&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Global constants</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_INDEX_NAME</span> <span class="o">=</span> <span class="s1">&#39;form_10k_chunks&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_NODE_LABEL</span> <span class="o">=</span> <span class="s1">&#39;Chunk&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_SOURCE_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">VECTOR_EMBEDDING_PROPERTY</span> <span class="o">=</span> <span class="s1">&#39;textEmbedding&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="build-located_in-relationship-between-mgr-and-addr">Build LOCATED_IN relationship between mgr and addr<a hidden class="anchor" aria-hidden="true" href="#build-located_in-relationship-between-mgr-and-addr">#</a></h3>
<p>In this tutorial, you will learn how to create <code>Address</code> nodes from properties of existing <code>Manager</code> (<code>mgr</code>) nodes and then establish a <code>(:Manager)-[:LOCATED_AT]-&gt;(:Address)</code> relationship in Neo4j. The approach uses Neo4j‚Äôs spatial <code>point</code> type and avoids duplicate nodes by using <code>MERGE</code>. The example implements this via Cypher and Python, leveraging the <code>Neo4jGraph</code> class for query execution without directly using the Neo4j driver.</p>
<hr>
<h4 id="1-data-structure-overview">1. Data Structure Overview<a hidden class="anchor" aria-hidden="true" href="#1-data-structure-overview">#</a></h4>
<p>Suppose you have a manager node represented as:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;managerCik&#34;</span><span class="p">:</span> <span class="s2">&#34;1424381&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;managerName&#34;</span><span class="p">:</span> <span class="s2">&#34;LAKEWOOD CAPITAL MANAGEMENT, LP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;managerAddress&#34;</span><span class="p">:</span> <span class="s2">&#34;650 Madison Avenue, 25th Floor, New York, NY, 10022&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="err">POINT(</span><span class="mf">-73.9713457</span> <span class="mf">40.7639879</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You want to create a corresponding address node from its location details:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;country&#34;</span><span class="p">:</span> <span class="s2">&#34;United States&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;city&#34;</span><span class="p">:</span> <span class="s2">&#34;New York&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;New York&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="err">POINT(</span><span class="mf">-73.9821429</span> <span class="mf">40.7584882</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, link the manager node to the address node using the <code>LOCATED_AT</code> relationship.</p>
<hr>
<h4 id="2-cypher-query-with-parameters">2. Cypher Query with Parameters<a hidden class="anchor" aria-hidden="true" href="#2-cypher-query-with-parameters">#</a></h4>
<p>Use the following Cypher query to:</p>
<ul>
<li><code>MERGE</code> the <code>Manager</code> node based on <code>managerCik</code>, update its properties.</li>
<li><code>MERGE</code> the <code>Address</code> node based on address attributes.</li>
<li>Create the relationship <code>(:Manager)-[:LOCATED_AT]-&gt;(:Address)</code>:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">MERGE (m:Manager {managerCik: $managerCik})
</span></span><span class="line"><span class="cl">SET m.managerName = $managerName,
</span></span><span class="line"><span class="cl">    m.managerAddress = $managerAddress,
</span></span><span class="line"><span class="cl">    m.location = point({longitude: $mgr_longitude, latitude: $mgr_latitude})
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MERGE (a:Address {
</span></span><span class="line"><span class="cl">    country: $country,
</span></span><span class="line"><span class="cl">    city: $city,
</span></span><span class="line"><span class="cl">    state: $state,
</span></span><span class="line"><span class="cl">    location: point({longitude: $addr_longitude, latitude: $addr_latitude})
</span></span><span class="line"><span class="cl">})
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MERGE (m)-[:LOCATED_AT]-&gt;(a)
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h4 id="3-python-example-using-neo4jgraph">3. Python Example Using <code>Neo4jGraph</code><a hidden class="anchor" aria-hidden="true" href="#3-python-example-using-neo4jgraph">#</a></h4>
<p>Here‚Äôs how to execute the above query in Python utilizing the <code>Neo4jGraph</code> interface without a direct Neo4j driver.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.graphs</span> <span class="kn">import</span> <span class="n">Neo4jGraph</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">load_dotenv</span><span class="p">(</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="n">override</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_URI</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_URI&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_USERNAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_USERNAME&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_PASSWORD</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_PASSWORD&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">NEO4J_DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;NEO4J_DATABASE&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;neo4j&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kg</span> <span class="o">=</span> <span class="n">Neo4jGraph</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span><span class="o">=</span><span class="n">NEO4J_URI</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">NEO4J_USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">NEO4J_PASSWORD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">NEO4J_DATABASE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example input data</span>
</span></span><span class="line"><span class="cl"><span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mgr&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;managerCik&#39;</span><span class="p">:</span> <span class="s1">&#39;1424381&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;managerAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;650 Madison Avenue, 25th Floor, New York, NY, 10022&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">73.9713457</span><span class="p">,</span> <span class="mf">40.7639879</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;LAKEWOOD CAPITAL MANAGEMENT, LP&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;addr&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;United States&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">73.9821429</span><span class="p">,</span> <span class="mf">40.7584882</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">mgr</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mgr&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;addr&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (m:Manager {managerCik: $managerCik})
</span></span></span><span class="line"><span class="cl"><span class="s2">    SET m.managerName = $managerName,
</span></span></span><span class="line"><span class="cl"><span class="s2">        m.managerAddress = $managerAddress,
</span></span></span><span class="line"><span class="cl"><span class="s2">        m.location = point({longitude: $mgr_longitude, latitude: $mgr_latitude})
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (a:Address {
</span></span></span><span class="line"><span class="cl"><span class="s2">        country: $country,
</span></span></span><span class="line"><span class="cl"><span class="s2">        city: $city,
</span></span></span><span class="line"><span class="cl"><span class="s2">        state: $state,
</span></span></span><span class="line"><span class="cl"><span class="s2">        location: point({longitude: $addr_longitude, latitude: $addr_latitude})
</span></span></span><span class="line"><span class="cl"><span class="s2">    })
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (m)-[:LOCATED_AT]-&gt;(a)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;managerCik&#39;</span><span class="p">:</span> <span class="n">mgr</span><span class="p">[</span><span class="s1">&#39;managerCik&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;managerName&#39;</span><span class="p">:</span> <span class="n">mgr</span><span class="p">[</span><span class="s1">&#39;managerName&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;managerAddress&#39;</span><span class="p">:</span> <span class="n">mgr</span><span class="p">[</span><span class="s1">&#39;managerAddress&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mgr_longitude&#39;</span><span class="p">:</span> <span class="n">mgr</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mgr_latitude&#39;</span><span class="p">:</span> <span class="n">mgr</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="n">addr</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="n">addr</span><span class="p">[</span><span class="s1">&#39;city&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="n">addr</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;addr_longitude&#39;</span><span class="p">:</span> <span class="n">addr</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;addr_latitude&#39;</span><span class="p">:</span> <span class="n">addr</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">cypher</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h4 id="4-key-points">4. Key Points<a hidden class="anchor" aria-hidden="true" href="#4-key-points">#</a></h4>
<ul>
<li>Use <code>MERGE</code> to avoid creating duplicate nodes.</li>
<li>Store geospatial info with Neo4j‚Äôs <code>point({longitude, latitude})</code>.</li>
<li>Parameters allow safe and flexible data insertion.</li>
<li>You can extend <code>data_list</code> to batch-create multiple <code>Manager</code>/<code>Address</code> nodes and relationships.</li>
<li>This method leverages your existing <code>Neo4jGraph</code> instance (<code>kg</code>), no explicit driver usage required.</li>
</ul>
<h3 id="build-located_at-relationship-between-manager-and-address-with-dynamic-address-parsing">Build LOCATED_AT Relationship Between Manager and Address with Dynamic Address Parsing<a hidden class="anchor" aria-hidden="true" href="#build-located_at-relationship-between-manager-and-address-with-dynamic-address-parsing">#</a></h3>
<p>This tutorial guides you through creating <code>Address</code> nodes from existing <code>Manager</code> (<code>mgr</code>) nodes in Neo4j and establishing <code>(:Manager)-[:LOCATED_AT]-&gt;(:Address)</code> relationships dynamically. It shows how to:</p>
<ul>
<li>Access spatial point properties in Neo4j from Python correctly.</li>
<li>Implement simple parsing logic to extract city and state from the textual <code>managerAddress</code>.</li>
<li>Create or merge corresponding <code>Address</code> nodes using parsed data.</li>
<li>Link each Manager node to its Address node with a relationship.</li>
</ul>
<p>This solution uses <code>Neo4jGraph</code>‚Äôs <code>kg.query()</code> interface without directly calling the Neo4j driver.</p>
<hr>
<h4 id="1-understanding-your-data">1. Understanding Your Data<a hidden class="anchor" aria-hidden="true" href="#1-understanding-your-data">#</a></h4>
<p>Each <code>Manager</code> node has properties similar to this example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;managerCik&#34;</span><span class="p">:</span> <span class="s2">&#34;1424381&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;managerName&#34;</span><span class="p">:</span> <span class="s2">&#34;LAKEWOOD CAPITAL MANAGEMENT, LP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;managerAddress&#34;</span><span class="p">:</span> <span class="s2">&#34;650 Madison Avenue, 25th Floor, New York, NY, 10022&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="err">POINT(</span><span class="mf">-73.9713457</span> <span class="mf">40.7639879</span><span class="err">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The goal is to create an <code>Address</code> node from relevant parts of <code>managerAddress</code> (city, state) and <code>location</code> (longitude, latitude) of the manager, then create a relationship indicating that the manager is located at that address.</p>
<hr>
<h4 id="2-accessing-neo4j-spatial-data-in-python">2. Accessing Neo4j Spatial Data in Python<a hidden class="anchor" aria-hidden="true" href="#2-accessing-neo4j-spatial-data-in-python">#</a></h4>
<p>Neo4j spatial points are returned as <code>WGS84Point</code> objects, <strong>not dictionaries</strong>. To get longitude and latitude, access them as attributes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">longitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">longitude</span>
</span></span><span class="line"><span class="cl"><span class="n">latitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">latitude</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Using <code>.get()</code> or indexing will cause errors.</p>
<hr>
<h4 id="3-dynamic-city-and-state-parsing-from-address-string">3. Dynamic City and State Parsing from Address String<a hidden class="anchor" aria-hidden="true" href="#3-dynamic-city-and-state-parsing-from-address-string">#</a></h4>
<p>Addresses often come as strings, for example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;650 Madison Avenue, 25th Floor, New York, NY, 10022&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>A simple heuristic to extract city and state:</p>
<ul>
<li>Split the string by commas.</li>
<li>Trim whitespace from each part.</li>
<li>City is typically the third-last element.</li>
<li>State is typically the second-last element, often a two-letter code (e.g., NY).</li>
</ul>
<p>Example parsing function:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">parse_city_state</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">city</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">city</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">state_candidate</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_candidate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">state_candidate</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">state</span> <span class="o">=</span> <span class="n">state_candidate</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">state</span> <span class="o">=</span> <span class="n">state_candidate</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">city</span><span class="p">,</span> <span class="n">state</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This heuristic may require adjustment for various address formats.</p>
<hr>
<h4 id="4-complete-python-script-example">4. Complete Python Script Example<a hidden class="anchor" aria-hidden="true" href="#4-complete-python-script-example">#</a></h4>
<p>This script:</p>
<ul>
<li>Queries all <code>Manager</code> nodes.</li>
<li>Extracts and parses city/state dynamically.</li>
<li>Creates or merges <code>Address</code> nodes with spatial info.</li>
<li>Creates <code>LOCATED_AT</code> relationships from <code>Manager</code> to <code>Address</code>.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Assuming kg is your Neo4jGraph instance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">parse_city_state</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">city</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">city</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">state_candidate</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state_candidate</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">state_candidate</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">state</span> <span class="o">=</span> <span class="n">state_candidate</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">state</span> <span class="o">=</span> <span class="n">state_candidate</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">city</span><span class="p">,</span> <span class="n">state</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">managers</span> <span class="o">=</span> <span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager)
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mgr.managerCik AS cik,
</span></span></span><span class="line"><span class="cl"><span class="s2">       mgr.managerName AS name,
</span></span></span><span class="line"><span class="cl"><span class="s2">       mgr.managerAddress AS address,
</span></span></span><span class="line"><span class="cl"><span class="s2">       mgr.location AS location
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">mgr_record</span> <span class="ow">in</span> <span class="n">managers</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">cik</span> <span class="o">=</span> <span class="n">mgr_record</span><span class="p">[</span><span class="s1">&#39;cik&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">mgr_record</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">mgr_address</span> <span class="o">=</span> <span class="n">mgr_record</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">location</span> <span class="o">=</span> <span class="n">mgr_record</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">longitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">longitude</span>
</span></span><span class="line"><span class="cl">    <span class="n">latitude</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">latitude</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">city</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">parse_city_state</span><span class="p">(</span><span class="n">mgr_address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">city</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">city</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">state</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">country</span> <span class="o">=</span> <span class="s2">&#34;United States&#34;</span>  <span class="c1"># Adjust or parse as needed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cypher</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (m:Manager {managerCik: $cik})
</span></span></span><span class="line"><span class="cl"><span class="s2">    SET m.managerName = $name,
</span></span></span><span class="line"><span class="cl"><span class="s2">        m.managerAddress = $mgrAddress,
</span></span></span><span class="line"><span class="cl"><span class="s2">        m.location = point({longitude: $mgr_longitude, latitude: $mgr_latitude})
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (a:Address {
</span></span></span><span class="line"><span class="cl"><span class="s2">        country: $country,
</span></span></span><span class="line"><span class="cl"><span class="s2">        city: $city,
</span></span></span><span class="line"><span class="cl"><span class="s2">        state: $state
</span></span></span><span class="line"><span class="cl"><span class="s2">    })
</span></span></span><span class="line"><span class="cl"><span class="s2">    SET a.location = point({longitude: $mgr_longitude, latitude: $mgr_latitude})
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    MERGE (m)-[:LOCATED_AT]-&gt;(a)
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="explore-the-updated-sec-documents-graph">Explore the updated SEC documents graph<a hidden class="anchor" aria-hidden="true" href="#explore-the-updated-sec-documents-graph">#</a></h3>
<p>In this lesson, you‚Äôll be working with an updated graph that also includes the address information discussed in the video</p>
<ul>
<li>Some outputs below may differ slightly from the video</li>
<li>Start by checking the schema of the graph</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">refresh_schema</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">kg</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Node properties are the following: Chunk {textEmbedding:
</span></span><span class="line"><span class="cl">LIST, f10kItem: STRING, chunkSeqId: INTEGER, text: STRING,
</span></span><span class="line"><span class="cl">cik: STRING, cusip6: STRING, names: LIST, formId: STRING,
</span></span><span class="line"><span class="cl">source: STRING, chunkId: STRING},Form {cusip6: STRING,
</span></span><span class="line"><span class="cl">names: LIST, formId: STRING, source: STRING},Company
</span></span><span class="line"><span class="cl">{location: POINT, cusip: STRING, names: LIST,
</span></span><span class="line"><span class="cl">companyAddress: STRING, companyName: STRING, cusip6:
</span></span><span class="line"><span class="cl">STRING},Manager {location: POINT, managerName: STRING,
</span></span><span class="line"><span class="cl">managerCik: STRING, managerAddress: STRING},Address
</span></span><span class="line"><span class="cl">{location: POINT, country: STRING, city: STRING, state:
</span></span><span class="line"><span class="cl">STRING} Relationship properties are the following: SECTION
</span></span><span class="line"><span class="cl">{f10kItem: STRING},OWNS_STOCK_IN {shares: INTEGER,
</span></span><span class="line"><span class="cl">reportCalendarOrQuarter: STRING, value: FLOAT} The
</span></span><span class="line"><span class="cl">relationships are the following: (:Chunk)-[:NEXT]-
</span></span><span class="line"><span class="cl">&gt;(:Chunk),(:Chunk)-[:PART_OF]-&gt;(:Form),(:Form)-[:SECTION]-
</span></span><span class="line"><span class="cl">&gt;(:Chunk),(:Company)-[:FILED]-&gt;(:Form),(:Company)-
</span></span><span class="line"><span class="cl">[:LOCATED_AT]-&gt;(:Address),(:Manager)-[:LOCATED_AT]-
</span></span><span class="line"><span class="cl">&gt;(:Address),(:Manager)-[:OWNS_STOCK_IN]-&gt;(:Company)
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Check the address of a random Manager</li>
<li>Note: the company returned by the following query may differ from the one in the video</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(addr:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mgr, addr
</span></span></span><span class="line"><span class="cl"><span class="s2">LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mgr&#39;: {&#39;managerCik&#39;: &#39;1424381&#39;,
</span></span><span class="line"><span class="cl">   &#39;managerAddress&#39;: &#39;650 Madison Avenue, 25th Floor, New York, NY, 10022&#39;,
</span></span><span class="line"><span class="cl">   &#39;location&#39;: POINT(-73.9713457 40.7639879),
</span></span><span class="line"><span class="cl">   &#39;managerName&#39;: &#39;LAKEWOOD CAPITAL MANAGEMENT, LP&#39;},
</span></span><span class="line"><span class="cl">  &#39;addr&#39;: {&#39;country&#39;: &#39;United States&#39;,
</span></span><span class="line"><span class="cl">   &#39;city&#39;: &#39;New York&#39;,
</span></span><span class="line"><span class="cl">   &#39;location&#39;: POINT(-73.9821429 40.7584882),
</span></span><span class="line"><span class="cl">   &#39;state&#39;: &#39;New York&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Full text search for a manager named Royal Bank</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CALL db.index.fulltext.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;fullTextManagerNames&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;royal bank&#34;) YIELD node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN node.managerName, score LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;node.managerName&#39;: &#39;Royal Bank of Canada&#39;, &#39;score&#39;: 3.70367431640625}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Find location of Royal Bank</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">CALL db.index.fulltext.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;fullTextManagerNames&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;royal bank&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  ) YIELD node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">WITH node as mgr LIMIT 1
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(addr:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mgr.managerName, addr
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mgr.managerName&#39;: &#39;Royal Bank of Canada&#39;,
</span></span><span class="line"><span class="cl">  &#39;addr&#39;: {&#39;country&#39;: &#39;Canada&#39;,
</span></span><span class="line"><span class="cl">   &#39;city&#39;: &#39;Toronto&#39;,
</span></span><span class="line"><span class="cl">   &#39;location&#39;: POINT(-79.3805647 43.6508267),
</span></span><span class="line"><span class="cl">   &#39;state&#39;: &#39;Ontario&#39;}}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Determine which state has the most investment firms</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH p=(:Manager)-[:LOCATED_AT]-&gt;(address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN address.state as state, count(address.state) as numManagers
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY numManagers DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;state&#39;: &#39;New York&#39;, &#39;numManagers&#39;: 304},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;California&#39;, &#39;numManagers&#39;: 302},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Massachusetts&#39;, &#39;numManagers&#39;: 146},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Pennsylvania&#39;, &#39;numManagers&#39;: 138},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Texas&#39;, &#39;numManagers&#39;: 125},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Illinois&#39;, &#39;numManagers&#39;: 121},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Florida&#39;, &#39;numManagers&#39;: 115},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Connecticut&#39;, &#39;numManagers&#39;: 77},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Ohio&#39;, &#39;numManagers&#39;: 76},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;New Jersey&#39;, &#39;numManagers&#39;: 69}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Determine which state has the most companies</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH p=(:Company)-[:LOCATED_AT]-&gt;(address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN address.state as state, count(address.state) as numCompanies
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY numCompanies DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;state&#39;: &#39;California&#39;, &#39;numCompanies&#39;: 7},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Delaware&#39;, &#39;numCompanies&#39;: 1},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;New York&#39;, &#39;numCompanies&#39;: 1},
</span></span><span class="line"><span class="cl"> {&#39;state&#39;: &#39;Oregon&#39;, &#39;numCompanies&#39;: 1}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>What are the cities in California with the most investment firms?</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH p=(:Manager)-[:LOCATED_AT]-&gt;(address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">         WHERE address.state = &#39;California&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN address.city as city, count(address.city) as numManagers
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY numManagers DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;city&#39;: &#39;San Francisco&#39;, &#39;numManagers&#39;: 48},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Los Angeles&#39;, &#39;numManagers&#39;: 44},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;San Diego&#39;, &#39;numManagers&#39;: 17},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Pasadena&#39;, &#39;numManagers&#39;: 13},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Menlo Park&#39;, &#39;numManagers&#39;: 9},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Newport Beach&#39;, &#39;numManagers&#39;: 9},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Irvine&#39;, &#39;numManagers&#39;: 9},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Walnut Creek&#39;, &#39;numManagers&#39;: 8},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Palo Alto&#39;, &#39;numManagers&#39;: 6},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Lafayette&#39;, &#39;numManagers&#39;: 6}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Which city in California has the most companies listed?</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH p=(:Company)-[:LOCATED_AT]-&gt;(address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">         WHERE address.state = &#39;California&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN address.city as city, count(address.city) as numCompanies
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY numCompanies DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;city&#39;: &#39;Santa Clara&#39;, &#39;numCompanies&#39;: 3},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;San Jose&#39;, &#39;numCompanies&#39;: 2},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Sunnyvale&#39;, &#39;numCompanies&#39;: 1},
</span></span><span class="line"><span class="cl"> {&#39;city&#39;: &#39;Cupertino&#39;, &#39;numCompanies&#39;: 1}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>What are top investment firms in San Francisco?</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH p=(mgr:Manager)-[:LOCATED_AT]-&gt;(address:Address),
</span></span></span><span class="line"><span class="cl"><span class="s2">         (mgr)-[owns:OWNS_STOCK_IN]-&gt;(:Company)
</span></span></span><span class="line"><span class="cl"><span class="s2">         WHERE address.city = &#34;San Francisco&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN mgr.managerName, sum(owns.value) as totalInvestmentValue
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY totalInvestmentValue DESC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;Dodge &amp; Cox&#39;</span><span class="p">,</span> <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">3889236092000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;WELLS FARGO &amp; COMPANY/MN&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">2177580039000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;CHARLES SCHWAB INVESTMENT MANAGEMENT INC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">1944847519000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;Parallax Volatility Advisers, L.P.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">694023723000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;PARNASSUS INVESTMENTS, LLC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">211068925000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;Spyglass Capital Management LLC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">98135259000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;Valiant Capital Management, L.P.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">52124040000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;Ensemble Capital Management, LLC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">42355370000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;Woodline Partners LP&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">41497384000.0</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;mgr.managerName&#39;</span><span class="p">:</span> <span class="s1">&#39;Alta Park Capital, LP&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;totalInvestmentValue&#39;</span><span class="p">:</span> <span class="mf">38959909000.0</span><span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>What companies are located in Santa Clara?</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (com:Company)-[:LOCATED_AT]-&gt;(address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">         WHERE address.city = &#34;Santa Clara&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN com.companyName
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;com.companyName&#39;: &#39;PALO ALTO NETWORKS INC&#39;},
</span></span><span class="line"><span class="cl"> {&#39;com.companyName&#39;: &#39;SEAGATE TECHNOLOGY&#39;},
</span></span><span class="line"><span class="cl"> {&#39;com.companyName&#39;: &#39;ATLASSIAN CORP PLC&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>What companies are near Santa Clara?</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (sc:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE sc.city = &#34;Santa Clara&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (com:Company)-[:LOCATED_AT]-&gt;(comAddr:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE point.distance(sc.location, comAddr.location) &lt; 10000
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN com.companyName, com.companyAddress
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[{</span><span class="s1">&#39;com.companyName&#39;</span><span class="p">:</span> <span class="s1">&#39;PALO ALTO NETWORKS INC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;com.companyAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;3000 Tannery Way, Santa Clara, CA 95054, USA&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;com.companyName&#39;</span><span class="p">:</span> <span class="s1">&#39;GSI TECHNOLOGY INC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;com.companyAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;1213 Elko Dr, Sunnyvale, CA 94089, USA&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;com.companyName&#39;</span><span class="p">:</span> <span class="s1">&#39;SEAGATE TECHNOLOGY&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;com.companyAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;2445 Augustine Dr, Santa Clara, CA 95054, USA&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;com.companyName&#39;</span><span class="p">:</span> <span class="s1">&#39;ATLASSIAN CORP PLC&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;com.companyAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;431 El Camino Real, Santa Clara, CA 95050, USA&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span><span class="s1">&#39;com.companyName&#39;</span><span class="p">:</span> <span class="s1">&#39;APPLE INC&#39;</span><span class="p">,</span> <span class="s1">&#39;com.companyAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;Cupertino, CA, USA&#39;</span><span class="p">}]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>What investment firms are near Santa Clara?</li>
<li>Try updating the distance in the query to expand the search radius</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE address.city = &#34;Santa Clara&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(managerAddress:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE point.distance(address.location, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        managerAddress.location) &lt; 10000
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN mgr.managerName, mgr.managerAddress
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mgr.managerName&#39;: &#39;Mine &amp; Arao Wealth Creation &amp; Management, LLC.&#39;,
</span></span><span class="line"><span class="cl">  &#39;mgr.managerAddress&#39;: &#39;901 CAMPISI WAY, SUITE 140, CAMPBELL, CA, 95008&#39;}]
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Which investment firms are near Palo Alto Networks?</li>
<li>Note that full-text search is able to handle typos!</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Which investment firms are near Palo Aalto Networks?</span>
</span></span><span class="line"><span class="cl"><span class="n">kg</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  CALL db.index.fulltext.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;fullTextCompanyNames&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;Palo Aalto Networks&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">         ) YIELD node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH node as com
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (com)-[:LOCATED_AT]-&gt;(comAddress:Address),
</span></span></span><span class="line"><span class="cl"><span class="s2">    (mgr:Manager)-[:LOCATED_AT]-&gt;(mgrAddress:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE point.distance(comAddress.location, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mgrAddress.location) &lt; 10000
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN mgr, 
</span></span></span><span class="line"><span class="cl"><span class="s2">    toInteger(point.distance(comAddress.location, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        mgrAddress.location) / 1000) as distanceKm
</span></span></span><span class="line"><span class="cl"><span class="s2">    ORDER BY distanceKm ASC
</span></span></span><span class="line"><span class="cl"><span class="s2">    LIMIT 10
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[{&#39;mgr&#39;: {&#39;managerCik&#39;: &#39;1802994&#39;,
</span></span><span class="line"><span class="cl">   &#39;managerAddress&#39;: &#39;901 CAMPISI WAY, SUITE 140, CAMPBELL, CA, 95008&#39;,
</span></span><span class="line"><span class="cl">   &#39;location&#39;: POINT(-121.9342655 37.2909459),
</span></span><span class="line"><span class="cl">   &#39;managerName&#39;: &#39;Mine &amp; Arao Wealth Creation &amp; Management, LLC.&#39;},
</span></span><span class="line"><span class="cl">  &#39;distanceKm&#39;: 6}]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="writing-cypher-with-an-llm">Writing Cypher with an LLM<a hidden class="anchor" aria-hidden="true" href="#writing-cypher-with-an-llm">#</a></h3>
<p>In this section, you‚Äôll use few-shot learning to teach an LLM to write Cypher</p>
<ul>
<li>You‚Äôll use the OpenAI‚Äôs GPT 3.5 model</li>
<li>You‚Äôll also use a new Neo4j integration within LangChain called <strong>GraphCypherQAChain</strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">CYPHER_GENERATION_TEMPLATE</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;Task:Generate Cypher statement to 
</span></span></span><span class="line"><span class="cl"><span class="s2">query a graph database.
</span></span></span><span class="line"><span class="cl"><span class="s2">Instructions:
</span></span></span><span class="line"><span class="cl"><span class="s2">Use only the provided relationship types and properties in the 
</span></span></span><span class="line"><span class="cl"><span class="s2">schema. Do not use any other relationship types or properties that 
</span></span></span><span class="line"><span class="cl"><span class="s2">are not provided.
</span></span></span><span class="line"><span class="cl"><span class="s2">Schema:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{schema}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Note: Do not include any explanations or apologies in your responses.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not respond to any questions that might ask anything else than 
</span></span></span><span class="line"><span class="cl"><span class="s2">for you to construct a Cypher statement.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not include any text except the generated Cypher statement.
</span></span></span><span class="line"><span class="cl"><span class="s2">Examples: Here are a few examples of generated Cypher 
</span></span></span><span class="line"><span class="cl"><span class="s2">statements for particular questions:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># What investment firms are in San Francisco?
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(mgrAddress:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE mgrAddress.city = &#39;San Francisco&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mgr.managerName
</span></span></span><span class="line"><span class="cl"><span class="s2">The question is:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{question}</span><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">CYPHER_GENERATION_PROMPT</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;schema&#34;</span><span class="p">,</span> <span class="s2">&#34;question&#34;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">template</span><span class="o">=</span><span class="n">CYPHER_GENERATION_TEMPLATE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypherChain</span> <span class="o">=</span> <span class="n">GraphCypherQAChain</span><span class="o">.</span><span class="n">from_llm</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">graph</span><span class="o">=</span><span class="n">kg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cypher_prompt</span><span class="o">=</span><span class="n">CYPHER_GENERATION_PROMPT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">allow_dangerous_requests</span><span class="o">=</span><span class="kc">True</span>   <span class="c1"># Pay attention to this!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prettyCypherChain</span><span class="p">(</span><span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">cypherChain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettyCypherChain</span><span class="p">(</span><span class="s2">&#34;What investment firms are in San Francisco?&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; Entering new GraphCypherQAChain chain...
</span></span><span class="line"><span class="cl">Generated Cypher:
</span></span><span class="line"><span class="cl">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(mgrAddress:Address)
</span></span><span class="line"><span class="cl">WHERE mgrAddress.city = &#39;San Francisco&#39;
</span></span><span class="line"><span class="cl">RETURN mgr.managerName
</span></span><span class="line"><span class="cl">Full Context:
</span></span><span class="line"><span class="cl">[{&#39;mgr.managerName&#39;: &#39;PARNASSUS INVESTMENTS, LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;SKBA CAPITAL MANAGEMENT LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;ROSENBLUM SILVERMAN SUTTON S F INC /CA&#39;}, {&#39;mgr.managerName&#39;: &#39;CHARLES SCHWAB INVESTMENT MANAGEMENT INC&#39;}, {&#39;mgr.managerName&#39;: &#39;WELLS FARGO &amp; COMPANY/MN&#39;}, {&#39;mgr.managerName&#39;: &#39;Dodge &amp; Cox&#39;}, {&#39;mgr.managerName&#39;: &#39;Strait &amp; Sound Wealth Management LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;Sonoma Private Wealth LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;Fund Management at Engine No. 1 LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;SELDON CAPITAL LP&#39;}]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Finished chain.
</span></span><span class="line"><span class="cl">PARNASSUS INVESTMENTS, LLC, ROSENBLUM SILVERMAN SUTTON S F
</span></span><span class="line"><span class="cl">INC /CA, and Dodge &amp; Cox are investment firms located in San
</span></span><span class="line"><span class="cl">Francisco.
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettyCypherChain</span><span class="p">(</span><span class="s2">&#34;What investment firms are in Menlo Park?&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; Entering new GraphCypherQAChain chain...
</span></span><span class="line"><span class="cl">Generated Cypher:
</span></span><span class="line"><span class="cl">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(mgrAddress:Address)
</span></span><span class="line"><span class="cl">    WHERE mgrAddress.city = &#39;Menlo Park&#39;
</span></span><span class="line"><span class="cl">RETURN mgr.managerName
</span></span><span class="line"><span class="cl">Full Context:
</span></span><span class="line"><span class="cl">[{&#39;mgr.managerName&#39;: &#39;Bordeaux Wealth Advisors LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;Opes Wealth Management LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;Solstein Capital, LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;Stamos Capital Partners, L.P.&#39;}, {&#39;mgr.managerName&#39;: &#39;TIEMANN INVESTMENT ADVISORS, LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;SCGE MANAGEMENT, L.P.&#39;}, {&#39;mgr.managerName&#39;: &#39;Nelson Capital Management, LLC&#39;}, {&#39;mgr.managerName&#39;: &#39;Jasper Ridge Partners, L.P.&#39;}, {&#39;mgr.managerName&#39;: &#39;CROSSLINK CAPITAL INC&#39;}]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Finished chain.
</span></span><span class="line"><span class="cl">Jasper Ridge Partners, L.P. and CROSSLINK CAPITAL INC are
</span></span><span class="line"><span class="cl">investment firms located in Menlo Park.
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettyCypherChain</span><span class="p">(</span><span class="s2">&#34;What companies are in Santa Clara?&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; Entering new GraphCypherQAChain chain...
</span></span><span class="line"><span class="cl">Generated Cypher:
</span></span><span class="line"><span class="cl">MATCH (comp:Company)-[:LOCATED_AT]-&gt;(compAddress:Address)
</span></span><span class="line"><span class="cl">    WHERE compAddress.city = &#39;Santa Clara&#39;
</span></span><span class="line"><span class="cl">RETURN comp.companyName
</span></span><span class="line"><span class="cl">Full Context:
</span></span><span class="line"><span class="cl">[{&#39;comp.companyName&#39;: &#39;PALO ALTO NETWORKS INC&#39;}, {&#39;comp.companyName&#39;: &#39;SEAGATE TECHNOLOGY&#39;}, {&#39;comp.companyName&#39;: &#39;ATLASSIAN CORP PLC&#39;}]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Finished chain.
</span></span><span class="line"><span class="cl">The companies in Santa Clara are PALO ALTO NETWORKS INC,
</span></span><span class="line"><span class="cl">SEAGATE TECHNOLOGY, and ATLASSIAN CORP PLC.
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettyCypherChain</span><span class="p">(</span><span class="s2">&#34;What investment firms are near Santa Clara?&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; Entering new GraphCypherQAChain chain...
</span></span><span class="line"><span class="cl">Generated Cypher:
</span></span><span class="line"><span class="cl">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(mgrAddress:Address)
</span></span><span class="line"><span class="cl">WHERE mgrAddress.city = &#39;Santa Clara&#39;
</span></span><span class="line"><span class="cl">RETURN mgr.managerName
</span></span><span class="line"><span class="cl">Full Context:
</span></span><span class="line"><span class="cl">[]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Finished chain.
</span></span><span class="line"><span class="cl">I don&#39;t know the answer.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="expand-the-prompt-to-teach-the-llm-new-cypher-patterns">Expand the prompt to teach the LLM new Cypher patterns<a hidden class="anchor" aria-hidden="true" href="#expand-the-prompt-to-teach-the-llm-new-cypher-patterns">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">CYPHER_GENERATION_TEMPLATE</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;Task:Generate Cypher statement to query a graph database.
</span></span></span><span class="line"><span class="cl"><span class="s2">Instructions:
</span></span></span><span class="line"><span class="cl"><span class="s2">Use only the provided relationship types and properties in the schema.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not use any other relationship types or properties that are not provided.
</span></span></span><span class="line"><span class="cl"><span class="s2">Schema:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{schema}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Note: Do not include any explanations or apologies in your responses.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not respond to any questions that might ask anything else than for you to construct a Cypher statement.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not include any text except the generated Cypher statement.
</span></span></span><span class="line"><span class="cl"><span class="s2">Examples: Here are a few examples of generated Cypher statements for particular questions:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># What investment firms are in San Francisco?
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(mgrAddress:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE mgrAddress.city = &#39;San Francisco&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mgr.managerName
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># What investment firms are near Santa Clara?
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE address.city = &#34;Santa Clara&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(managerAddress:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE point.distance(address.location, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        managerAddress.location) &lt; 10000
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN mgr.managerName, mgr.managerAddress
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">The question is:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{question}</span><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Update Cypher generation prompt with new template, and re-initialize the Cypher chain to use the new prompt</li>
<li>Rerun this code anytime you make a change to the Cypher generation template!</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">CYPHER_GENERATION_PROMPT</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;schema&#34;</span><span class="p">,</span> <span class="s2">&#34;question&#34;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">template</span><span class="o">=</span><span class="n">CYPHER_GENERATION_TEMPLATE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypherChain</span> <span class="o">=</span> <span class="n">GraphCypherQAChain</span><span class="o">.</span><span class="n">from_llm</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">graph</span><span class="o">=</span><span class="n">kg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cypher_prompt</span><span class="o">=</span><span class="n">CYPHER_GENERATION_PROMPT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">allow_dangerous_requests</span><span class="o">=</span><span class="kc">True</span>   <span class="c1"># Pay attention to this!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prettyCypherChain</span><span class="p">(</span><span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">cypherChain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prettyCypherChain</span><span class="p">(</span><span class="s2">&#34;What investment firms are near Santa Clara?&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; Entering new GraphCypherQAChain chain...
</span></span><span class="line"><span class="cl">Generated Cypher:
</span></span><span class="line"><span class="cl">MATCH (address:Address)
</span></span><span class="line"><span class="cl">    WHERE address.city = &#34;Santa Clara&#34;
</span></span><span class="line"><span class="cl">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(managerAddress:Address)
</span></span><span class="line"><span class="cl">    WHERE point.distance(address.location, managerAddress.location) &lt; 10000
</span></span><span class="line"><span class="cl">RETURN mgr.managerName, mgr.managerAddress
</span></span><span class="line"><span class="cl">Full Context:
</span></span><span class="line"><span class="cl">[{&#39;mgr.managerName&#39;: &#39;Mine &amp; Arao Wealth Creation &amp; Management, LLC.&#39;, &#39;mgr.managerAddress&#39;: &#39;901 CAMPISI WAY, SUITE 140, CAMPBELL, CA, 95008&#39;}]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Finished chain.
</span></span><span class="line"><span class="cl">Mine &amp; Arao Wealth Creation &amp; Management, LLC. is an
</span></span><span class="line"><span class="cl">investment firm near Santa Clara, located at 901 CAMPISI
</span></span><span class="line"><span class="cl">WAY, SUITE 140, CAMPBELL, CA, 95008.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="expand-the-query-to-retrieve-information-from-the-form-10k-chunks">Expand the query to retrieve information from the Form 10K chunks<a hidden class="anchor" aria-hidden="true" href="#expand-the-query-to-retrieve-information-from-the-form-10k-chunks">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">CYPHER_GENERATION_TEMPLATE</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;Task:Generate Cypher statement to query a graph database.
</span></span></span><span class="line"><span class="cl"><span class="s2">Instructions:
</span></span></span><span class="line"><span class="cl"><span class="s2">Use only the provided relationship types and properties in the schema.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not use any other relationship types or properties that are not provided.
</span></span></span><span class="line"><span class="cl"><span class="s2">Schema:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{schema}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">Note: Do not include any explanations or apologies in your responses.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not respond to any questions that might ask anything else than for you to construct a Cypher statement.
</span></span></span><span class="line"><span class="cl"><span class="s2">Do not include any text except the generated Cypher statement.
</span></span></span><span class="line"><span class="cl"><span class="s2">Examples: Here are a few examples of generated Cypher statements for particular questions:
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># What investment firms are in San Francisco?
</span></span></span><span class="line"><span class="cl"><span class="s2">MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(mgrAddress:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE mgrAddress.city = &#39;San Francisco&#39;
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN mgr.managerName
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># What investment firms are near Santa Clara?
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (address:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE address.city = &#34;Santa Clara&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (mgr:Manager)-[:LOCATED_AT]-&gt;(managerAddress:Address)
</span></span></span><span class="line"><span class="cl"><span class="s2">    WHERE point.distance(address.location, 
</span></span></span><span class="line"><span class="cl"><span class="s2">        managerAddress.location) &lt; 10000
</span></span></span><span class="line"><span class="cl"><span class="s2">  RETURN mgr.managerName, mgr.managerAddress
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2"># What does Palo Alto Networks do?
</span></span></span><span class="line"><span class="cl"><span class="s2">  CALL db.index.fulltext.queryNodes(
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;fullTextCompanyNames&#34;, 
</span></span></span><span class="line"><span class="cl"><span class="s2">         &#34;Palo Alto Networks&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">         ) YIELD node, score
</span></span></span><span class="line"><span class="cl"><span class="s2">  WITH node as com
</span></span></span><span class="line"><span class="cl"><span class="s2">  MATCH (com)-[:FILED]-&gt;(f:Form),
</span></span></span><span class="line"><span class="cl"><span class="s2">    (f)-[s:SECTION]-&gt;(c:Chunk)
</span></span></span><span class="line"><span class="cl"><span class="s2">  WHERE s.f10kItem = &#34;item1&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">RETURN c.text
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">The question is:
</span></span></span><span class="line"><span class="cl"><span class="s2"></span><span class="si">{question}</span><span class="s2">&#34;&#34;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">CYPHER_GENERATION_PROMPT</span> <span class="o">=</span> <span class="n">PromptTemplate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;schema&#34;</span><span class="p">,</span> <span class="s2">&#34;question&#34;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">template</span><span class="o">=</span><span class="n">CYPHER_GENERATION_TEMPLATE</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cypherChain</span> <span class="o">=</span> <span class="n">GraphCypherQAChain</span><span class="o">.</span><span class="n">from_llm</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">graph</span><span class="o">=</span><span class="n">kg</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">cypher_prompt</span><span class="o">=</span><span class="n">CYPHER_GENERATION_PROMPT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">allow_dangerous_requests</span><span class="o">=</span><span class="kc">True</span>   <span class="c1"># Pay attention to this!</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prettyCypherChain</span><span class="p">(</span><span class="n">question</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">cypherChain</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">prettyCypherChain</span><span class="p">(</span><span class="s2">&#34;What does Palo Alto Networks do?&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Palo Alto Networks, Inc. is a global cybersecurity provider
</span></span><span class="line"><span class="cl">that empowers enterprises, organizations, service providers,
</span></span><span class="line"><span class="cl">and government entities to protect themselves against
</span></span><span class="line"><span class="cl">sophisticated cyber threats. They offer cybersecurity
</span></span><span class="line"><span class="cl">platforms and services to secure users, networks, clouds,
</span></span><span class="line"><span class="cl">and endpoints with industry-leading artificial intelligence
</span></span><span class="line"><span class="cl">and automation. Their focus is on delivering value in
</span></span><span class="line"><span class="cl">network security, including zero trust solutions for remote
</span></span><span class="line"><span class="cl">workforces and cloud-delivered branches.
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="references">References<a hidden class="anchor" aria-hidden="true" href="#references">#</a></h2>
<p><a href="https://blog.csdn.net/shizheng_Li/article/details/140670172">Âü∫‰∫éNeo4jÂ∞ÜÁü•ËØÜÂõæË∞±Áî®‰∫éÊ£ÄÁ¥¢Â¢ûÂº∫ÁîüÊàêÔºöKnowledge Graphs for RAG</a></p>
<p><a href="https://github.com/aishweta/Neo4j-Knowledge-Graphs-for-RAG">Neo4j-Knowledge-Graphs-for-RAG</a></p>
<p><a href="https://github.com/zach-blumenfeld/neo4j-sec-edgar-form13">neo4j-sec-edgar-form13</a></p>
<p><a href="https://blog.csdn.net/qq_41081716/article/details/132134382">neo4jÊ∏ÖÁ©∫Êï∞ÊçÆÂ∫ì</a></p>
<p><a href="https://blog.csdn.net/weixin_40959890/article/details/137167045">Knowledge Graphs for RAG &ndash;Expanding the SEC Knowledge Graph (Âê¥ÊÅ©Ëææ-Áü•ËØÜÂõæË∞±Âú®RAG‰∏≠ÁöÑÂ∫îÁî® 5)</a></p>
<p><a href="https://www.bilibili.com/video/BV1jtqYYWE8W/?vd_source=d019368b7fa277491d814f856f7fd542">(Ë∂ÖÁàΩ‰∏≠Ëã±ÔºÅ) 2024ÂÖ¨ËÆ§ÊúÄÂ•ΩÁöÑ„ÄêRAGÁü•ËØÜÂõæË∞±„ÄëÁ≥ªÂàóÊïôÁ®ãÔºÅÈôÑËØæ‰ª∂‰ª£Á†Å Knowledge Graphs for RAG</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://rosefinch-midsummer.github.io/zh/tags/ai/">AI</a></li>
      <li><a href="https://rosefinch-midsummer.github.io/zh/tags/llm/">LLM</a></li>
      <li><a href="https://rosefinch-midsummer.github.io/zh/tags/rag/">RAG</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://rosefinch-midsummer.github.io/zh/posts/life/cloudflare-r2%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8%E6%90%AD%E5%BB%BA%E9%AB%98%E9%80%9F%E5%85%8D%E8%B4%B9%E5%9B%BE%E5%BA%8A%E6%8C%87%E5%8D%97/">
    <span class="title">¬´ ‰∏ä‰∏ÄÈ†Å</span>
    <br>
    <span>Cloudflare-R2ÂØπË±°Â≠òÂÇ®Êê≠Âª∫È´òÈÄüÂÖçË¥πÂõæÂ∫äÊåáÂçó</span>
  </a>
  <a class="next" href="https://rosefinch-midsummer.github.io/zh/posts/life/%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E4%BC%98%E7%A7%80%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E6%8F%90%E5%8D%87%E8%87%AA%E5%B7%B1%E7%9A%84go%E5%BC%80%E5%8F%91%E8%83%BD%E5%8A%9B/">
    <span class="title">‰∏ã‰∏ÄÈ†Å ¬ª</span>
    <br>
    <span>Â¶Ç‰ΩïÈÄöËøá‰ºòÁßÄÂºÄÊ∫êÈ°πÁõÆÊèêÂçáËá™Â∑±ÁöÑGoÂºÄÂèëËÉΩÂäõÔºü</span>
  </a>
</nav>

  </footer>
<div>    
    <div class="pagination__title">
        <span class="pagination__title-h" style="font-size: 20px;">ËØÑËÆ∫</span>
        <br/>
    </div>
    <div id="tcomment"></div>
    <script src="https://utteranc.es/client.js"
            repo="Rosefinch-Midsummer/comments_of_blog" 
            issue-term="title"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <script>
        document.getElementById("theme-toggle").addEventListener("click", () => {
            const theme = document.body.className.includes("dark")
            ? "github-light"
            : "photon-dark";
            const message = {
            type: "set-theme",
            theme: theme,
            };
            const utteranc = document.querySelector(".utterances-frame");
            utteranc.contentWindow.postMessage(message, "https://utteranc.es");
        });
    </script>
</div>






</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="https://rosefinch-midsummer.github.io/zh/">Â§©Êº¢Â∏ùÂúãÂæ©ËààÈåÑ</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
  
<div class="busuanzi-footer">
  <span id="busuanzi_container_site_pv">
    Êú¨Á´ôÊÄªËÆøÈóÆÈáè<span id="busuanzi_value_site_pv"></span>Ê¨°
  </span>
  <span id="busuanzi_container_site_uv">
    Êú¨Á´ôËÆøÂÆ¢Êï∞<span id="busuanzi_value_site_uv"></span>‰∫∫Ê¨°
  </span>
</div></footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Ë§áË£Ω';

        function copyingDone() {
            copybutton.innerHTML = 'Â∑≤Ë§áË£ΩÔºÅ';
            setTimeout(() => {
                copybutton.innerHTML = 'Ë§áË£Ω';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>




</body>

</html>
